import{d as k,r as u,l as ne,c as i,o,n as V,z as X,a as d,t as D,p as oe,b as $,e as O,w as z,f as R,i as E,k as w,F as Z,g as W,u as b,_ as K,h as le,D as he,E as ge,G as ve,m as te,j as ae,H as be,x as Q,q as xe,s as ye}from"./style.js";import{p as Y}from"./tools.js";const J=k({__name:"chat-alert",props:{type:{},timeout:{default:0}},setup(l){const e=u(!0);return ne(()=>{l.timeout!==0&&setTimeout(()=>{e.value=!1},l.timeout)}),(t,n)=>(o(),i("div",{class:V(["border-l-4! p-2 rounded bg-white border! text-base",{"border-blue-500! ":t.type==="info","border-orange-500! ":t.type==="warning","border-green-500! ":t.type==="success","border-red-500! ":t.type==="error",hidden:!e.value}]),role:"alert"},[X(t.$slots,"default")],2))}}),Ce=["innerHTML"],se=k({__name:"chat-bot-message",props:{isExpanded:{type:Boolean},message:{}},setup(l){return(e,t)=>(o(),i("div",{class:V(["chat-message text-base gap-4 flex flex-col from-blue-400 to-blue-500 self-end rounded-b-2xl rounded-tl-2xl bg-linear-to-b px-6 pt-1 pb-2 text-white",{"max-w-[700px]":e.isExpanded,"max-w-[414px]":!e.isExpanded}]),innerHTML:e.message},null,10,Ce))}});function re(l,e){for(let t=0;t<l.length;t++)if(!e.includes(l[t]))return!1;return!0}function ie(l){return l.filter(e=>e.isMandatory).map(e=>e.id)}function we(l){return/^[a-zA-Z0-9._+-]+@[a-zA-Z0-9_+-]+\.[a-zA-Z]{2,}$/.test(l)}const _e={class:"flex gap-2 text-black text-sm items-center relative"},$e=["id","name"],ke={href:"#",className:"underline"},de=k({__name:"chat-checkbox",props:{id:{},name:{},isMandatory:{type:Boolean}},emits:["accepted-campaign","update:modal-id-opened"],setup(l,{emit:e}){const t=e;return(n,s)=>(o(),i("label",_e,[d("input",{id:`campaign-${n.id}`,name:`campaign-${n.id}`,type:"checkbox",onChange:s[0]||(s[0]=a=>t("accepted-campaign",n.id)),class:"appearance-none! peer before:hidden! w-4! h-4! border! border-black! rounded-none! bg-white!"},null,40,$e),s[2]||(s[2]=d("svg",{class:"absolute w-4 h-4 hidden peer-checked:block",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[d("polyline",{points:"20 6 9 17 4 12"})],-1)),d("div",{class:"flex gap-2",onClick:s[1]||(s[1]=a=>t("update:modal-id-opened",n.id))},[d("a",ke,D(n.name),1)]),d("span",{class:V({"text-red-500 text-xs":n.isMandatory,hidden:!n.isMandatory})}," (mandatory) ",2)]))}}),Ae=["disabled"],ue=k({__name:"chat-button",props:{disabled:{type:Boolean,default:!1}},emits:["click"],setup(l,{emit:e}){const t=e;return(n,s)=>(o(),i("button",{class:V(`
      text-sm uppercase px-4 py-2 rounded-xl 
      text-white transition-color shadow-button 
      bg-blue-500 hover:bg-blue-600 active:bg-blue-700 no-underline 
      disabled:opacity-50 disabled:cursor-not-allowed
    `),onClick:s[0]||(s[0]=a=>t("click")),disabled:n.disabled},[X(n.$slots,"default")],8,Ae))}}),Fe={key:0,className:"text-xl"},Me={className:"flex justify-end"},ce=k({__name:"chat-form",props:{title:{},disabled:{type:Boolean}},emits:["submit"],setup(l,{emit:e}){const t=e;return(n,s)=>(o(),i("form",{className:"flex flex-col gap-2 text-black",onSubmit:s[0]||(s[0]=oe(a=>t("submit"),["prevent"]))},[n.title?(o(),i("div",Fe,D(n.title),1)):$("",!0),X(n.$slots,"default"),d("div",Me,[O(ue,{disabled:n.disabled,type:"submit"},{default:z(()=>s[1]||(s[1]=[R("Accept")])),_:1},8,["disabled"])])],32))}}),Ie={className:"flex flex-col gap-1"},Ee=k({__name:"chat-campaigns-form",emits:["form-accepted"],setup(l,{emit:e}){const t=E("setModalIdOpen"),n=E("chatGptData");if(!n)throw new Error("chatGptData is undefined");const{aiChatCampaigns:s}=n,a=u([]),r=u(!1),c=e;function B(v){const f=a.value.indexOf(v);f===-1?a.value=[...a.value,v]:a.value.splice(f,1),re(ie(s),a.value.map(M=>M.toString()))?r.value=!0:r.value=!1}function S(){c("form-accepted",a.value)}return(v,f)=>(o(),w(J,{type:"info"},{default:z(()=>[O(ce,{title:"Campaigns From",disabled:!r.value,onSubmit:S},{default:z(()=>[d("div",Ie,[(o(!0),i(Z,null,W(b(s),x=>(o(),w(de,{key:x.id,id:x.id,name:x.name,isMandatory:x.isMandatory,onAcceptedCampaign:B,"onUpdate:modalIdOpened":b(t)},null,8,["id","name","isMandatory","onUpdate:modalIdOpened"]))),128))])]),_:1},8,["disabled"])]),_:1}))}});async function De({ajaxUrl:l,action:e,nonce:t,queryField:n,aiChatterId:s,message:a,prevMessage:r,aiChatId:c,isNewConversation:B,onMessageChunk:S}){const v=new FormData;v.append("action",e),v.append(`data[${n}]`,a),v.append("data[prevMessage]",r),v.append("data[aiChatterId]",s),v.append("data[isNewConversation]",B?"true":"false"),v.append("security",t),c&&v.append("data[aiChatId]",c.toString());try{const f=await fetch(l,{method:"POST",body:v});if(!f.body)throw new Error("No response body.");const x=f.body.getReader(),M=new TextDecoder;for(;;){const{done:I,value:A}=await x.read();if(I)break;const y=M.decode(A,{stream:!0});S(y)}}catch(f){throw console.error("Error en la peticiÃ³n:",f),f}}async function Be({ajaxUrl:l,action:e,nonce:t,aiChatCampaignsField:n,campaignIds:s}){const a=new FormData;return a.append("action",e),a.append(`data[${n}][]`,s.join(",")),a.append("security",t),Y(l,a)}async function Le({ajaxUrl:l,action:e,nonce:t,message:n,aiChatId:s,role:a}){const r=new FormData;return r.append("action",e),r.append("data[aiChatMessage]",JSON.stringify({role:a,content:n})),r.append("data[aiChatId]",(s==null?void 0:s.toString())??""),r.append("security",t),Y(l,r)}async function qe({ajaxUrl:l,action:e,nonce:t,fields:n,campaignIds:s,aiChatterId:a,aiChatId:r}){const c=new FormData;return c.append("action",e),c.append("security",t),c.append("data[fields]",n),c.append("data[campaignIds][]",s.join(",")),c.append("data[aiChatterId]",a),c.append("data[aiChatId]",r),Y(l,c)}const Ne={class:"flex flex-col gap-1 relative pb-4 text-base"},Oe={class:"flex gap-2 items-center"},Se={key:0,class:"text-red-500 text-xs"},je=["type","name","id","aria-errormessage"],ze={key:0,id:"`${id}-error`",class:"text-red-500 text-xs absolute bottom-0"},Ve=k({__name:"chat-input-field",props:{label:{},type:{},id:{},required:{type:Boolean},handleFilledField:{type:Function}},setup(l){const e=u(""),t=u(null);function n(a){const c=a.target.value.trim();e.value=c,s(c)}function s(a){return!a&&l.required?(t.value="This fields is required",l.handleFilledField(l.id,""),!0):l.id==="email"&&!we(a)?(t.value="Please enter a valid email address",l.handleFilledField(l.id,""),!0):(t.value=null,l.handleFilledField(l.id,a),!1)}return(a,r)=>(o(),i("label",Ne,[d("div",Oe,[R(D(a.label)+" ",1),a.required?(o(),i("span",Se,"(required)")):$("",!0)]),d("input",{type:a.type,name:a.id,id:a.id,class:"border border-gray-300 rounded px-2 py-1",onInput:n,"aria-errormessage":`${a.id}-error`},null,40,je),t.value?(o(),i("div",ze,D(t.value),1)):$("",!0)]))}}),Ge={class:"flex flex-col gap-1 relative pb-4 text-base"},He={class:"flex gap-2 items-center"},Te={key:0,class:"text-red-500 text-xs"},Ue=["name","id","aria-errormessage"],Qe=["id"],Ze=k({__name:"chat-textarea-field",props:{id:{},label:{},required:{type:Boolean},handleFilledField:{type:Function}},setup(l){const e=l,t=u(""),n=u(null);function s(r){r.preventDefault();const c=r.target;t.value=c.value}function a(){if(!t.value&&e.required){n.value="This fields is required";return}t.value&&(e.handleFilledField(e.id,t.value),n.value=null)}return(r,c)=>(o(),i("label",Ge,[d("div",He,[R(D(r.label)+" ",1),r.required?(o(),i("span",Te,"(required)")):$("",!0)]),d("textarea",{name:r.id,id:r.id,class:"border border-gray-300 rounded px-2 py-1 min-h-[100px]",onChange:s,onBlur:a,"aria-errormessage":`${r.id}-error`},null,40,Ue),d("div",{id:`${r.id}-error`,class:"text-red-500 text-xs absolute bottom-0"},D(n.value),9,Qe)]))}}),Re={key:1,className:"flex flex-col gap-1"},Pe=k({__name:"chat-contact-form",setup(l){const e=E("chatGptData");if(!e)throw new Error("Missing dependencies");const t=E("setModalIdOpen"),n=E("setAllowChatInput"),s=E("aiChatId"),a=E("setIsAcceptedAiContactForm"),r=E("setErrorMessage"),{aiContactCampaigns:c,formFields:B,ajaxUrl:S,ajaxActionCreateAiContact:v,nonce:f,aiChatterId:x,allowAiContactCampaigns:M,afterFormMessageError:I}=e,A=u([]),y=u(!1),j=u(!1),G=u(null),p=u({name:"",email:"",phone:"",message:""});function C(g){const N=A.value.indexOf(g);N===-1?A.value=[...A.value,g]:A.value.splice(N,1),re(ie(c),A.value.map(U=>U.toString()))?j.value=!0:j.value=!1}function L(g,N){p.value={...p.value,[g]:N},B.filter(U=>U.required&&U.active).every(U=>p.value[U.label.toLowerCase()])?y.value=!0:y.value=!1}async function H(){if(!s)return;const g=await qe({ajaxUrl:S,action:v,nonce:f,fields:JSON.stringify(p),campaignIds:A.value,aiChatterId:x,aiChatId:s});g.success?(G.value=g.data.aiContadId,a(!0),n(!1),r("")):(n(!1),r(I))}const T=B.filter(g=>g.active),P=T.filter(g=>g.type!=="textarea"),q=T.find(g=>g.type==="textarea");return ne(()=>{(c.length===0||!M)&&(j.value=!0)}),(g,N)=>(o(),w(J,{type:"info",class:"mb-4"},{default:z(()=>[O(ce,{title:"Ai Contact Form",disabled:!j.value||!y.value,onSubmit:H},{default:z(()=>[(o(!0),i(Z,null,W(b(P),F=>(o(),w(Ve,{key:F.label,label:F.label,type:F.type,id:F.label.toLowerCase(),required:F.required,handleFilledField:L},null,8,["label","type","id","required"]))),128)),b(q)?(o(),w(Ze,{key:0,label:b(q).label,id:b(q).label.toLowerCase(),required:b(q).required,handleFilledField:L},null,8,["label","id","required"])):$("",!0),b(M)?(o(),i("div",Re,[(o(!0),i(Z,null,W(b(c),F=>(o(),w(de,{key:F.id,id:F.id,name:F.name,isMandatory:F.isMandatory,onAcceptedCampaign:C,"onUpdate:modalIdOpened":b(t)},null,8,["id","name","isMandatory","onUpdate:modalIdOpened"]))),128))])):$("",!0)]),_:1},8,["disabled"])]),_:1}))}}),Je={},We={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor"};function Ke(l,e){return o(),i("svg",We,e[0]||(e[0]=[d("path",{d:"M16.1 260.2c-22.6 12.9-20.5 47.3 3.6 57.3L160 376V479.3c0 18.1 14.6 32.7 32.7 32.7c9.7 0 18.9-4.3 25.1-11.8l62-74.3 123.9 51.6c18.9 7.9 40.8-4.5 43.9-24.7l64-416c1.9-12.1-3.4-24.3-13.5-31.2s-23.3-7.5-34-1.4l-448 256zm52.1 25.5L409.7 90.6 190.1 336l1.2 1L68.2 285.7zM403.3 425.4L236.7 355.9 450.8 116.6 403.3 425.4z"},null,-1)]))}const Xe=K(Je,[["render",Ke]]),Ye=["disabled"],et={class:"w-10 h-10 border rounded-full border-gray-400 flex justify-center items-center bg-white! disabled:opacity-30 disabled:cursor-not-allowed focus:outline-hidden focus:ring-2 focus:ring-blue-500"},tt=k({__name:"chat-footer",props:{allowChatInput:{type:Boolean},aiChatId:{},remainingQuestions:{},isNewConversation:{type:Boolean}},emits:["update:remaining-questions","update:messages","update:error-message","update:is-new-conversation"],setup(l,{emit:e}){const t=E("chatGptData");if(!t)throw new Error("chatGptData is undefined");const n=E("setAllowChatInput");if(!n)throw new Error("setAllowChatInput is undefined");const{ajaxUrl:s,ajaxActionChatBot:a,nonce:r,queryField:c,aiChatterId:B,ajaxActionRecordAiChat:S,limitChat:v}=t,f=l,x=e,M=u(!1),I=u(""),A=u(""),y=u("");async function j(){if(M.value=!0,!!I.value){A.value="",G(I.value,"user");try{await De({ajaxUrl:s,action:a,nonce:r,queryField:c,aiChatterId:B,message:I.value,prevMessage:y.value,aiChatId:f.aiChatId,isNewConversation:f.isNewConversation,onMessageChunk:p=>{A.value+=p,x("update:messages",{message:p,type:"system"})}}),x("update:is-new-conversation",!1),G(A.value,"system"),y.value=A.value}catch(p){const C=p instanceof Error?p.message:"Error sending message";x("update:error-message",C)}finally{M.value=!1,I.value=""}}}async function G(p,C){C==="system"&&x("update:remaining-questions",f.remainingQuestions-1),f.aiChatId&&await Le({ajaxUrl:s,action:S,nonce:r,message:p,aiChatId:f.aiChatId,role:C}),f.remainingQuestions===0&&v&&n(!1),x("update:messages",{message:p,type:C})}return(p,C)=>(o(),i("form",{class:"flex mb-6 sm:mb-0 gap-2",onSubmit:oe(j,["prevent"]),name:"chat-footer"},[le(d("input",{type:"text",id:"message","onUpdate:modelValue":C[0]||(C[0]=L=>I.value=L),disabled:M.value||!p.allowChatInput,class:"grow align-center border-gray-400! flex rounded-full! border! px-6! pt-1! pb-2! text-base! shadow-lg disabled:opacity-30 disabled:cursor-not-allowed focus:outline-hidden focus:ring-2 focus:ring-blue-500"},null,8,Ye),[[he,I.value]]),d("button",et,[O(Xe,{class:"w-6 h-6 text-gray-400"})])],32))}}),at={},st={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 512 512"};function nt(l,e){return o(),i("svg",st,e[0]||(e[0]=[d("path",{d:"M200 32H56C42.7 32 32 42.7 32 56V200c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l40-40 79 79-79 79L73 295c-6.9-6.9-17.2-8.9-26.2-5.2S32 302.3 32 312V456c0 13.3 10.7 24 24 24H200c9.7 0 18.5-5.8 22.2-14.8s1.7-19.3-5.2-26.2l-40-40 79-79 79 79-40 40c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H456c13.3 0 24-10.7 24-24V312c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2l-40 40-79-79 79-79 40 40c6.9 6.9 17.2 8.9 26.2 5.2s14.8-12.5 14.8-22.2V56c0-13.3-10.7-24-24-24H312c-9.7 0-18.5 5.8-22.2 14.8s-1.7 19.3 5.2 26.2l40 40-79 79-79-79 40-40c6.9-6.9 8.9-17.2 5.2-26.2S209.7 32 200 32z"},null,-1)]))}const ot=K(at,[["render",nt]]),lt={},rt={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 512 512"};function it(l,e){return o(),i("svg",rt,e[0]||(e[0]=[d("path",{d:"M456 224H312c-13.3 0-24-10.7-24-24V56c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2l40 40L442.3 5.7C446 2 450.9 0 456 0s10 2 13.7 5.7l36.7 36.7C510 46 512 50.9 512 56s-2 10-5.7 13.7L433 143l40 40c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8zm0 64c9.7 0 18.5 5.8 22.2 14.8s1.7 19.3-5.2 26.2l-40 40 73.4 73.4c3.6 3.6 5.7 8.5 5.7 13.7s-2 10-5.7 13.7l-36.7 36.7C466 510 461.1 512 456 512s-10-2-13.7-5.7L369 433l-40 40c-6.9 6.9-17.2 8.9-26.2 5.2s-14.8-12.5-14.8-22.2V312c0-13.3 10.7-24 24-24H456zm-256 0c13.3 0 24 10.7 24 24V456c0 9.7-5.8 18.5-14.8 22.2s-19.3 1.7-26.2-5.2l-40-40L69.7 506.3C66 510 61.1 512 56 512s-10-2-13.7-5.7L5.7 469.7C2 466 0 461.1 0 456s2-10 5.7-13.7L79 369 39 329c-6.9-6.9-8.9-17.2-5.2-26.2s12.5-14.8 22.2-14.8H200zM56 224c-9.7 0-18.5-5.8-22.2-14.8s-1.7-19.3 5.2-26.2l40-40L5.7 69.7C2 66 0 61.1 0 56s2-10 5.7-13.7L42.3 5.7C46 2 50.9 0 56 0s10 2 13.7 5.7L143 79l40-40c6.9-6.9 17.2-8.9 26.2-5.2s14.8 12.5 14.8 22.2V200c0 13.3-10.7 24-24 24H56z"},null,-1)]))}const dt=K(lt,[["render",it]]),ut=k({__name:"chat-maximize-button",props:{isExpanded:{type:Boolean}},emits:["expand-chat"],setup(l,{emit:e}){const t=e;function n(s){s.stopPropagation(),t("expand-chat")}return(s,a)=>(o(),i("button",{onClick:a[0]||(a[0]=r=>t("expand-chat")),class:"absolute top-2 sm:-top-12 left-0 hidden sm:block"},[O(ot,{onClick:n,class:V(["h-6 w-6 sm:w-10 sm:h-10 text-blue-500",{block:!s.isExpanded,"hidden!":s.isExpanded}])},null,8,["class"]),O(dt,{onClick:n,class:V(["h-6 w-6 sm:w-10 sm:h-10 text-blue-500",{block:s.isExpanded,"hidden!":!s.isExpanded}])},null,8,["class"])]))}}),ct={class:"fixed z-40 inset-0 w-full h-full bg-black justify-center items-center flex bg-opacity-50",tabindex:"-1"},pt={class:"bg-white rounded w-full max-w-lg min-w-md h-96 flex flex-col"},mt={class:"p-4 border-b"},ft=["innerHTML"],ht={class:"flex justify-end border-t p-4"},gt=k({__name:"chat-modal",props:{id:{},name:{},content:{},isVisible:{type:Boolean}},emits:["close-modal"],setup(l,{emit:e}){const t=e;function n(a){t("close-modal",a)}function s(a){return a.replace(/\r?\n/g,"<br>")}return(a,r)=>le((o(),i("div",ct,[d("div",pt,[d("header",mt,D(a.name),1),d("main",{class:"grow p-4 overflow-y-scroll prose",innerHTML:s(a.content)},null,8,ft),d("footer",ht,[O(ue,{onClick:r[0]||(r[0]=c=>n(a.id))},{default:z(()=>r[1]||(r[1]=[R("Close")])),_:1})])])],512)),[[ge,a.isVisible]])}}),vt={},bt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"413",height:"413",viewBox:"0 0 413 413"};function xt(l,e){return o(),i("svg",bt,e[0]||(e[0]=[ve('<defs><linearGradient id="hall-9000-gradient" x1="1" y1="1" x2="0.081" y2="0.124" gradientUnits="objectBoundingBox"><stop offset="0" stop-color="#6d86d6"></stop><stop offset="1" stop-color="#48c4ee"></stop></linearGradient></defs><rect fill="url(#hall-9000-gradient)" width="413" height="413" rx="206.5"></rect><circle fill="#fff" cx="74.189" cy="74.189" r="74.189" transform="translate(131.178 134.023)"></circle><circle fill="#fff" cx="35.382" cy="35.382" r="35.382" transform="translate(278.414 96.358)"></circle><path fill="#fff" d="M132.445,0C61.11,0,2.9,58.209,2.9,129.545S61.11,259.089,132.445,259.089,261.989,200.88,261.989,129.545,203.78,0,132.445,0Zm0,245.393A115.848,115.848,0,1,1,248.293,129.545,115.932,115.932,0,0,1,132.445,245.393Z" transform="translate(72.922 76.955)"></path>',5)]))}const yt=K(vt,[["render",xt]]),Ct=k({__name:"chat-open-button",emits:["open-chat"],setup(l,{emit:e}){const t=e;return(n,s)=>(o(),i("button",{onClick:s[1]||(s[1]=a=>t("open-chat")),class:"fixed bottom-2 right-2 sm:bottom-6 sm:right-6 z-20"},[O(yt,{class:"w-8 h-8 sm:w-16 sm:h-16 rounded-full duration-300 hover:rotate-90",onClick:s[0]||(s[0]=a=>t("open-chat"))})]))}}),wt={class:"absolute sm:-top-12 right-0 items-center justify-center gap-2 rounded-2xl bg-white pl-2 pr-4 shadow-lg hidden sm:flex"},_t={class:"relative -top-1 text-4xl font-bold"},$t=k({__name:"chat-tokens",props:{ramainingQuestions:{}},setup(l){return(e,t)=>(o(),i(Z,null,[d("div",wt,[t[0]||(t[0]=d("div",{class:"bg-blue-500 h-8 w-8 rounded-full"},null,-1)),t[1]||(t[1]=d("div",{class:"relative -top-1 text-2xl"},"tokens left",-1)),d("div",_t,D(e.ramainingQuestions),1)]),t[2]||(t[2]=d("div",{class:"absolute bottom-2 left-4 sm:hidden"}," {ramainingQuestions} tokens left ",-1))],64))}}),kt=["innerHTML"],At=k({__name:"chat-user-message",props:{isExpanded:{type:Boolean},message:{}},setup(l){return(e,t)=>(o(),i("div",{class:V(["from-gray-200 text-base to-gray-300 border-gray-400 text-gray-700 rounded-t-2xl rounded-br-2xl border bg-linear-to-t px-6 pt-1 pb-2",{"max-w-[700px]":e.isExpanded,"max-w-[414px]":!e.isExpanded}]),innerHTML:e.message},null,10,kt))}}),Ft=k({__name:"chat-gpt",setup(l){const e=E("chatGptData");if(!e)throw new Error("chatGptData is undefined");const{isActive:t,initMessage:n,campaigns:s,limitChat:a,hasAiChat:r,ajaxUrl:c,ajaxActionCreateAiChat:B,nonce:S,aiChatCampaignsField:v,beforeFormMessage:f,questionsLimit:x,aiChatCampaigns:M,afterFormMessageSuccess:I,allowAiChatCampaigns:A}=e,y=u(!1),j=u(!0),G=u(null),p=u(!1),C=u(x),L=u(null),H=u(!1),T=u(!1),P=u(!1),q=u([]),g=u(null),N=u(null);Q("aiChatId",L),Q("setAiChatId",m=>L.value=m),Q("setModalIdOpen",m=>G.value=m),Q("setErrorMessage",m=>N.value=m),Q("setIsAcceptedAiChatForm",m=>T.value=m),Q("setIsAcceptedAiContactForm",m=>P.value=m),Q("setAllowChatInput",m=>H.value=m);async function F(m){const h=await Be({ajaxUrl:c,action:B,nonce:S,aiChatCampaignsField:v,campaignIds:m});h.success?(L.value=h.data.aiChatId,T.value=!0,H.value=!0):console.error(h.error)}te(y,()=>{y.value&&!L.value&&r&&!A&&(F([]),H.value=!0),y.value&&!r&&(T.value=!0,H.value=!0)});const U=ae(()=>!T.value&&r&&M.length>0),ee=ae(()=>C.value===0&&!P.value&&a);function me(m){if(m.type==="system"){const h=q.value[q.value.length-1];if(h&&h.type==="system"){if(m.message.includes("[DONE]"))return;h.message+=m.message}else q.value.push({message:m.message,type:"system"})}m.type==="user"&&q.value.push({message:m.message,type:"user"})}function fe(){g.value&&(g.value.scrollTop=g.value.scrollHeight)}return te(C,()=>{C.value===0&&a&&(H.value=!1)}),be(()=>{fe()}),(m,h)=>(o(),i(Z,null,[b(t)?(o(),i("div",{key:0,class:V(["inset-0 w-full h-full bg-black/70 justify-center items-center flex z-20 font-arboria font-normal",{hidden:!y.value,fixed:y.value}])},[d("div",{class:V(["relative flex flex-col text-xl w-full h-full min-h-full p-4 sm:p-6 border-2 sm:border-gray-300 sm:rounded-3xl shadow-card bg-white",{"sm:h-5/6 sm:w-[900px] sm:min-h-[600px] mx-4":p.value,"sm:h-4/6 sm:w-[537px] sm:min-h-[500px]":!p.value}])},[d("div",{class:"flex grow flex-col gap-3 sm:gap-7 overflow-y-auto mb-4",ref_key:"chatContainer",ref:g},[U.value?(o(),w(Ee,{key:0,onFormAccepted:F})):$("",!0),T.value?(o(),w(se,{key:1,message:b(n),isExpanded:p.value},null,8,["message","isExpanded"])):$("",!0),(o(!0),i(Z,null,W(q.value,_=>(o(),i(Z,null,[_.type==="user"?(o(),w(At,{key:0,message:_.message,isExpanded:p.value},null,8,["message","isExpanded"])):(o(),w(se,{key:1,message:_.message,isExpanded:p.value},null,8,["message","isExpanded"]))],64))),256)),ee.value?(o(),w(J,{key:2,type:"warning"},{default:z(()=>[R(D(b(f)),1)]),_:1})):$("",!0),ee.value?(o(),w(Pe,{key:3})):$("",!0),P.value?(o(),w(J,{key:4,type:"success"},{default:z(()=>[R(D(b(I)),1)]),_:1})):$("",!0),N.value?(o(),w(J,{key:5,type:"error"},{default:z(()=>[R(D(N.value),1)]),_:1})):$("",!0)],512),O(tt,{allowChatInput:H.value,aiChatId:L.value,remainingQuestions:C.value,isNewConversation:j.value,"onUpdate:remainingQuestions":h[0]||(h[0]=_=>C.value=_),"onUpdate:messages":me,"onUpdate:errorMessage":h[1]||(h[1]=_=>N.value=_),"onUpdate:isNewConversation":h[2]||(h[2]=_=>j.value=_)},null,8,["allowChatInput","aiChatId","remainingQuestions","isNewConversation"]),b(a)?(o(),w($t,{key:0,ramainingQuestions:C.value},null,8,["ramainingQuestions"])):$("",!0),O(ut,{isExpanded:p.value,onExpandChat:h[3]||(h[3]=_=>p.value=!p.value)},null,8,["isExpanded"])],2)],2)):$("",!0),b(t)?(o(!0),i(Z,{key:1},W(b(s),_=>(o(),w(gt,{name:_.name,content:_.content,id:_.id,isVisible:_.id===G.value,onCloseModal:h[4]||(h[4]=It=>G.value=null)},null,8,["name","content","id","isVisible"]))),256)):$("",!0),b(t)?(o(),w(Ct,{key:2,onClick:h[5]||(h[5]=_=>y.value=!y.value),isOpen:y.value},null,8,["isOpen"])):$("",!0)],64))}});let pe={};pe=window.chat_gpt.data;const Mt=xe({setup(){Q("chatGptData",pe)},render:()=>ye(Ft)});Mt.mount("#maingpt_chat");
