import{d as $,r as c,l as nt,c as r,o as s,n as U,z as X,a as d,t as B,p as st,b as y,e as q,w as G,f as R,i as D,k as _,F as N,g as W,u as m,_ as K,h as it,D as ht,E as ft,G as gt,m as tt,j as et,H as vt,x as T,q as xt,s as bt}from"./style.js";import{p as Y}from"./tools.js";function ot(t,a){for(let e=0;e<t.length;e++)if(!a.includes(t[e]))return!1;return!0}function lt(t){return t.filter(a=>a.isMandatory).map(a=>a.id)}function _t(t){return/^[a-zA-Z0-9._+-]+@[a-zA-Z0-9_+-]+\.[a-zA-Z]{2,}$/.test(t)}const J=$({__name:"chat-alert",props:{type:{type:String,default:"info"},timeout:{type:Number,default:0}},setup(t){const a=t,e=c(!0);return nt(()=>{a.timeout!==0&&setTimeout(()=>{e.value=!1},a.timeout)}),(i,n)=>(s(),r("div",{class:U(["tw:border-l-4 tw:p-2 tw:rounded tw:bg-white tw:border tw:text-base",{"tw:border-blue-500 ":t.type==="info","tw:border-orange-500 ":t.type==="warning","tw:border-green-500 ":t.type==="success","tw:border-red-500 ":t.type==="error","tw:hidden":!e.value}]),role:"alert"},[X(i.$slots,"default")],2))}}),Ct={class:"tw:flex tw:gap-2 tw:text-black tw:text-sm tw:items-center tw:relative"},yt=["id","name"],$t=d("svg",{class:"tw:absolute tw:w-4 tw:h-4 tw:hidden tw:peer-checked:block",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[d("polyline",{points:"20 6 9 17 4 12"})],-1),kt={href:"#",className:"tw:underline"},rt=$({__name:"chat-checkbox",props:{id:String,name:String,isMandatory:Boolean},emits:["accepted-campaign","update:modal-id-opened"],setup(t,{emit:a}){const e=a;return(i,n)=>(s(),r("label",Ct,[d("input",{id:`campaign-${t.id}`,name:`campaign-${t.id}`,type:"checkbox",onChange:n[0]||(n[0]=o=>e("accepted-campaign",t.id)),class:"tw:appearance-none! tw:peer tw:before:hidden! tw:w-4! tw:h-4! tw:border! tw:border-black! tw:rounded-none! tw:bg-white!"},null,40,yt),$t,d("div",{class:"tw:flex tw:gap-2",onClick:n[1]||(n[1]=o=>e("update:modal-id-opened",t.id))},[d("a",kt,B(t.name),1)]),d("span",{class:U({"tw:text-red-500 tw:text-xs":t.isMandatory,"tw:hidden":!t.isMandatory})}," (mandatory) ",2)]))}}),At=["disabled"],dt=$({__name:"chat-button",props:{disabled:Boolean},emits:["click"],setup(t,{emit:a}){const e=a;return(i,n)=>(s(),r("button",{class:"tw:text-sm tw:uppercase tw:px-4 tw:py-3 tw:rounded-xl tw:text-white tw:transition-all tw:duration-300 tw:shadow-button tw:bg-blue-500 tw:hover:bg-blue-600 tw:active:bg-blue-700 tw:no-underline tw:disabled:opacity-50 tw:disabled:cursor-not-allowed",onClick:n[0]||(n[0]=o=>e("click")),disabled:t.disabled},[X(i.$slots,"default")],8,At))}}),Mt=["id","name"],Ft={key:0,className:"tw:text-xl"},It={className:"tw:flex tw:justify-end"},ct=$({__name:"chat-form",props:{title:String,disabled:Boolean,accept:Function,id:String},emits:["submit"],setup(t,{emit:a}){const e=a;return(i,n)=>(s(),r("form",{id:t.id,name:t.id,className:"tw:flex tw:flex-col tw:gap-2 tw:text-black",onSubmit:n[0]||(n[0]=st(o=>e("submit"),["prevent"]))},[t.title?(s(),r("div",Ft,B(t.title),1)):y("",!0),X(i.$slots,"default"),d("div",It,[q(dt,{disabled:t.disabled,type:"submit"},{default:G(()=>[R("Accept")]),_:1},8,["disabled"])])],40,Mt))}}),Et={className:"tw:flex tw:flex-col tw:gap-1"},St=$({__name:"chat-ai-chat-form",emits:["form-accepted"],setup(t,{emit:a}){const e=D("setModalIdOpen"),i=D("chatGptData");if(!i)throw new Error("chatGptData is undefined");const{aiChatCampaigns:n}=i,o=c([]),l=c(!1),u=a;function E(h){const b=o.value.indexOf(h);b===-1?o.value=[...o.value,h]:o.value.splice(b,1),ot(lt(n),o.value.map(A=>A.toString()))?l.value=!0:l.value=!1}function w(){u("form-accepted",o.value)}return(h,b)=>(s(),_(J,{type:"info"},{default:G(()=>[q(ct,{id:"ai-chat-campaigns-form",title:"Ai Chat Campaigns",disabled:!l.value,onSubmit:w},{default:G(()=>[d("div",Et,[(s(!0),r(N,null,W(m(n),k=>(s(),_(rt,{key:k.id,id:k.id,name:k.name,isMandatory:k.isMandatory,onAcceptedCampaign:E,"onUpdate:modalIdOpened":m(e)},null,8,["id","name","isMandatory","onUpdate:modalIdOpened"]))),128))])]),_:1},8,["disabled"])]),_:1}))}}),Dt=async({ajaxUrl:t,action:a,queryField:e,aiChatterId:i,message:n,prevMessage:o,aiChatId:l,nonce:u,onMessageChunk:E})=>{const w=new FormData;w.append("action",a),w.append(`data[${e}]`,n),w.append("data[prevMessage]",o),w.append("data[aiChatterId]",i),w.append("security",u),l&&w.append("data[aiChatId]",l.toString());try{const h=await fetch(t,{method:"POST",body:w});if(!h.body)throw new Error("No response body.");const b=h.body.getReader(),k=new TextDecoder;let A="";for(;;){const{done:L,value:I}=await b.read();if(L)break;const C=k.decode(I,{stream:!0});E(C)}return A}catch(h){throw console.error("Error en la peticiÃ³n:",h),h}};async function Bt({ajaxUrl:t,action:a,nonce:e,aiChatCampaigns:i,campaignIds:n}){const o=new FormData;return o.append("action",a),o.append(`data[${i}][]`,n.join(",")),o.append("security",e),Y(t,o)}async function Lt({ajaxUrl:t,action:a,nonce:e,message:i,aiChatId:n,role:o}){const l=new FormData;return l.append("action",a),l.append("data[aiChatMessage]",JSON.stringify({role:o,content:i})),l.append("data[aiChatId]",(n==null?void 0:n.toString())??""),l.append("security",e),Y(t,l)}async function qt({ajaxUrl:t,action:a,nonce:e,fields:i,campaignIds:n,aiChatterId:o,aiChatId:l}){const u=new FormData;return u.append("action",a),u.append("security",e),u.append("data[fields]",i),u.append("data[campaignIds]",n.join(",")),u.append("data[aiChatterId]",o),u.append("data[aiChatId]",l),Y(t,u)}const Ot={class:"tw:flex tw:flex-col tw:gap-1 tw:relative tw:pb-4 tw:text-base"},jt={class:"tw:flex tw:gap-2 tw:items-center"},zt={key:0,class:"tw:text-red-500 tw:text-xs"},Vt=["type","name","id","aria-errormessage"],Gt={key:0,id:"`${id}-error`",class:"tw:text-red-500 tw:text-xs tw:absolute tw:bottom-0"},Ht=$({__name:"chat-input-field",props:{label:String,type:String,id:String,required:Boolean,handleFilledField:Function},setup(t){const a=t,{handleFilledField:e,id:i,required:n}=a,o=c(""),l=c(null);function u(w){const b=w.target.value.trim();o.value=b,E(b)}function E(w){return!w&&n?(l.value="This fields is required",e(i,""),!0):i==="email"&&!_t(w)?(l.value="Please enter a valid email address",e(i,""),!0):(l.value=null,e(i,w),!1)}return(w,h)=>(s(),r("label",Ot,[d("div",jt,[R(B(t.label)+" ",1),m(n)?(s(),r("span",zt,"(required)")):y("",!0)]),d("input",{type:t.type,name:m(i),id:m(i),class:"tw:border tw:border-gray-300 tw:rounded tw:px-2 tw:py-1",onInput:u,"aria-errormessage":`${m(i)}-error`},null,40,Vt),l.value?(s(),r("div",Gt,B(l.value),1)):y("",!0)]))}}),Tt={class:"tw:flex tw:flex-col tw:gap-1 tw:relative tw:pb-4 tw:text-base"},Nt={class:"tw:flex tw:gap-2 tw:items-center"},Ut={key:0,class:"tw:text-red-500 tw:text-xs"},Qt=["name","id","aria-errormessage"],Rt=["id"],Zt=$({__name:"chat-textarea-field",props:{label:String,id:String,required:Boolean,handleFilledField:Function},setup(t){const a=t,e=c(""),i=c(null);function n(l){l.preventDefault();const u=l.target;e.value=u.value}function o(){if(!e.value&&a.required){i.value="This fields is required";return}e.value&&(a.handleFilledField(a.id,e.value),i.value=null)}return(l,u)=>(s(),r("label",Tt,[d("div",Nt,[R(B(t.label)+" ",1),t.required?(s(),r("span",Ut,"(required)")):y("",!0)]),d("textarea",{name:t.id,id:t.id,class:"tw:border tw:border-gray-300 tw:rounded tw:px-2 tw:py-1 tw:min-h-[100px]",onChange:n,onBlur:o,"aria-errormessage":`${t.id}-error`},null,40,Qt),d("div",{id:`${t.id}-error`,class:"tw:text-red-500 tw:text-xs tw:absolute tw:bottom-0"},B(i.value),9,Rt)]))}}),Pt={key:1,className:"tw:flex tw:flex-col tw:gap-1"},Jt=$({__name:"chat-ai-contact-form",setup(t){const a=D("chatGptData");if(!a)throw new Error("Missing dependencies");const e=D("setModalIdOpen"),i=D("setAllowChatInput"),n=D("aiChatId"),o=D("setIsAcceptedAiContactForm"),l=D("setErrorMessage"),{aiContactCampaigns:u,formFields:E,ajaxUrl:w,ajaxActionCreateAiContact:h,nonce:b,aiChatterId:k,allowAiContactCampaigns:A,afterFormMessageError:L}=a,I=c([]),C=c(!1),S=c(!1),f=c(null),g=c({name:"",email:"",phone:"",message:""});function O(v){const H=I.value.indexOf(v);H===-1?I.value=[...I.value,v]:I.value.splice(H,1),ot(lt(u),I.value.map(V=>V.toString()))?S.value=!0:S.value=!1}function j(v,H){g.value={...g.value,[v]:H},E.filter(V=>V.required&&V.active).every(V=>g.value[V.label.toLowerCase()])?C.value=!0:C.value=!1}async function Q(){if(!n)return;const v=await qt({ajaxUrl:w,action:h,nonce:b,fields:JSON.stringify(g),campaignIds:I.value,aiChatterId:k,aiChatId:n});v.success?(f.value=v.data.aiContadId,o(!0),i(!1),l("")):(i(!1),l(L))}const Z=E.filter(v=>v.active),P=Z.filter(v=>v.type!=="textarea"),z=Z.find(v=>v.type==="textarea");return nt(()=>{(u.length===0||!A)&&(S.value=!0)}),(v,H)=>(s(),_(J,{type:"info",class:"tw:mb-4"},{default:G(()=>[q(ct,{title:"Ai Contact Form",disabled:!S.value||!C.value,onSubmit:Q},{default:G(()=>[(s(!0),r(N,null,W(m(P),M=>(s(),_(Ht,{key:M.label,label:M.label,type:M.type,id:M.label.toLowerCase(),required:M.required,handleFilledField:j},null,8,["label","type","id","required"]))),128)),m(z)?(s(),_(Zt,{key:0,label:m(z).label,id:m(z).label.toLowerCase(),required:m(z).required,handleFilledField:j},null,8,["label","id","required"])):y("",!0),m(A)?(s(),r("div",Pt,[(s(!0),r(N,null,W(m(u),M=>(s(),_(rt,{key:M.id,id:M.id,name:M.name,isMandatory:M.isMandatory,onAcceptedCampaign:O,"onUpdate:modalIdOpened":m(e)},null,8,["id","name","isMandatory","onUpdate:modalIdOpened"]))),128))])):y("",!0)]),_:1},8,["disabled"])]),_:1}))}}),Wt=["innerHTML"],at=$({__name:"chat-bot-message",props:{isExpanded:Boolean,message:String},setup(t){return(a,e)=>(s(),r("div",{class:U(["chat-message tw:text-base tw:gap-4 tw:flex tw:flex-col tw:from-blue-400 tw:to-blue-500 tw:self-end tw:rounded-b-2xl tw:rounded-tl-2xl tw:bg-linear-to-b tw:px-6 tw:pt-1 tw:pb-2 tw:text-white",{"max-w-[700px]":t.isExpanded,"max-w-[414px]":!t.isExpanded}]),innerHTML:t.message},null,10,Wt))}}),Kt={},Xt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor"},Yt=d("path",{d:"M16.1 260.2c-22.6 12.9-20.5 47.3 3.6 57.3L160 376V479.3c0 18.1 14.6 32.7 32.7 32.7c9.7 0 18.9-4.3 25.1-11.8l62-74.3 123.9 51.6c18.9 7.9 40.8-4.5 43.9-24.7l64-416c1.9-12.1-3.4-24.3-13.5-31.2s-23.3-7.5-34-1.4l-448 256zm52.1 25.5L409.7 90.6 190.1 336l1.2 1L68.2 285.7zM403.3 425.4L236.7 355.9 450.8 116.6 403.3 425.4z"},null,-1),te=[Yt];function ee(t,a){return s(),r("svg",Xt,te)}const ae=K(Kt,[["render",ee]]),ne=["disabled"],se={class:"tw:w-10 tw:h-10 tw:border tw:rounded-full tw:border-gray-400 tw:flex tw:justify-center tw:items-center tw:bg-white! tw:disabled:opacity-30 tw:disabled:cursor-not-allowed tw:focus:outline-hidden tw:focus:ring-2 tw:focus:ring-blue-500"},ie=$({__name:"chat-footer",props:{allowChatInput:{type:Boolean},aiChatId:{},remainingQuestions:{}},emits:["update:remaining-questions","update:messages","update:error-message"],setup(t,{emit:a}){const e=D("chatGptData");if(!e)throw new Error("chatGptData is undefined");const i=D("setAllowChatInput");if(!i)throw new Error("setAllowChatInput is undefined");const{ajaxUrl:n,ajaxActionChatBot:o,nonce:l,queryField:u,aiChatterId:E,ajaxActionRecordAiChat:w}=e,h=t,b=a,k=c(!1),A=c(""),L=c(""),I=c("");async function C(){if(k.value=!0,!!A.value){L.value="",S(A.value,"user");try{await Dt({ajaxUrl:n,action:o,queryField:u,aiChatterId:E,message:A.value,prevMessage:I.value,aiChatId:h.aiChatId,nonce:l,onMessageChunk:f=>{L.value+=f,b("update:messages",{message:f,type:"system"})}}),S(L.value,"system"),I.value=L.value}catch(f){const g=f instanceof Error?f.message:"Error sending message";b("update:error-message",g)}finally{k.value=!1,A.value=""}}}async function S(f,g){g==="system"&&b("update:remaining-questions",h.remainingQuestions-1),h.aiChatId&&await Lt({ajaxUrl:n,action:w,nonce:l,message:f,aiChatId:h.aiChatId,role:g}),h.remainingQuestions===0&&i(!1),b("update:messages",{message:f,type:g})}return(f,g)=>(s(),r("form",{class:"tw:flex tw:mb-6 tw:sm:mb-0 tw:gap-2",onSubmit:st(C,["prevent"]),name:"chat-footer"},[it(d("input",{type:"text",id:"message","onUpdate:modelValue":g[0]||(g[0]=O=>A.value=O),disabled:k.value||!f.allowChatInput,class:"tw:grow tw:align-center tw:border-gray-400! tw:flex tw:rounded-full! tw:border! tw:px-6! tw:pt-1! tw:pb-2! tw:text-base! tw:shadow-lg tw:disabled:opacity-30 tw:disabled:cursor-not-allowed tw:focus:outline-hidden tw:focus:ring-2 tw:focus:ring-blue-500"},null,8,ne),[[ht,A.value]]),d("button",se,[q(ae,{class:"tw:w-6 tw:h-6 tw:text-gray-400"})])],32))}}),oe={},le={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 512 512"},re=d("path",{d:"M200 32H56C42.7 32 32 42.7 32 56V200c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l40-40 79 79-79 79L73 295c-6.9-6.9-17.2-8.9-26.2-5.2S32 302.3 32 312V456c0 13.3 10.7 24 24 24H200c9.7 0 18.5-5.8 22.2-14.8s1.7-19.3-5.2-26.2l-40-40 79-79 79 79-40 40c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H456c13.3 0 24-10.7 24-24V312c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2l-40 40-79-79 79-79 40 40c6.9 6.9 17.2 8.9 26.2 5.2s14.8-12.5 14.8-22.2V56c0-13.3-10.7-24-24-24H312c-9.7 0-18.5 5.8-22.2 14.8s-1.7 19.3 5.2 26.2l40 40-79 79-79-79 40-40c6.9-6.9 8.9-17.2 5.2-26.2S209.7 32 200 32z"},null,-1),de=[re];function ce(t,a){return s(),r("svg",le,de)}const ue=K(oe,[["render",ce]]),we={},pe={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 512 512"},me=d("path",{d:"M456 224H312c-13.3 0-24-10.7-24-24V56c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2l40 40L442.3 5.7C446 2 450.9 0 456 0s10 2 13.7 5.7l36.7 36.7C510 46 512 50.9 512 56s-2 10-5.7 13.7L433 143l40 40c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8zm0 64c9.7 0 18.5 5.8 22.2 14.8s1.7 19.3-5.2 26.2l-40 40 73.4 73.4c3.6 3.6 5.7 8.5 5.7 13.7s-2 10-5.7 13.7l-36.7 36.7C466 510 461.1 512 456 512s-10-2-13.7-5.7L369 433l-40 40c-6.9 6.9-17.2 8.9-26.2 5.2s-14.8-12.5-14.8-22.2V312c0-13.3 10.7-24 24-24H456zm-256 0c13.3 0 24 10.7 24 24V456c0 9.7-5.8 18.5-14.8 22.2s-19.3 1.7-26.2-5.2l-40-40L69.7 506.3C66 510 61.1 512 56 512s-10-2-13.7-5.7L5.7 469.7C2 466 0 461.1 0 456s2-10 5.7-13.7L79 369 39 329c-6.9-6.9-8.9-17.2-5.2-26.2s12.5-14.8 22.2-14.8H200zM56 224c-9.7 0-18.5-5.8-22.2-14.8s-1.7-19.3 5.2-26.2l40-40L5.7 69.7C2 66 0 61.1 0 56s2-10 5.7-13.7L42.3 5.7C46 2 50.9 0 56 0s10 2 13.7 5.7L143 79l40-40c6.9-6.9 17.2-8.9 26.2-5.2s14.8 12.5 14.8 22.2V200c0 13.3-10.7 24-24 24H56z"},null,-1),he=[me];function fe(t,a){return s(),r("svg",pe,he)}const ge=K(we,[["render",fe]]),ve=$({__name:"chat-maximize-button",props:{isExpanded:Boolean},emits:["expand-chat"],setup(t,{emit:a}){const e=a;function i(n){n.stopPropagation(),e("expand-chat")}return(n,o)=>(s(),r("button",{onClick:o[0]||(o[0]=l=>e("expand-chat")),class:"tw:absolute tw:top-2 tw:sm:-top-12 tw:left-0 tw:hidden tw:sm:block"},[q(ue,{onClick:i,class:U(["tw:h-6 tw:w-6 tw:sm:w-10 tw:sm:h-10 tw:text-blue-500",{"tw:block":!t.isExpanded,"tw:hidden!":t.isExpanded}])},null,8,["class"]),q(ge,{onClick:i,class:U(["tw:h-6 tw:w-6 tw:sm:w-10 tw:sm:h-10 tw:text-blue-500",{"tw:block":t.isExpanded,"tw:hidden!":!t.isExpanded}])},null,8,["class"])]))}}),xe={class:"tw:fixed tw:z-40 tw:inset-0 tw:w-full tw:h-full tw:bg-black tw:justify-center tw:items-center tw:flex tw:bg-opacity-50",tabindex:"-1"},be={class:"tw:bg-white tw:rounded tw:w-full tw:max-w-lg tw:min-w-md tw:h-96 tw:flex tw:flex-col"},_e={class:"tw:p-4 tw:border-b"},Ce=["innerHTML"],ye={class:"tw:flex tw:justify-end tw:border-t tw:p-4"},$e=$({__name:"chat-modal",props:{id:String,name:String,content:String,isVisible:Boolean},emits:["close-modal"],setup(t,{emit:a}){const e=a;function i(n){e("close-modal",n)}return(n,o)=>it((s(),r("div",xe,[d("div",be,[d("header",_e,B(t.name),1),d("main",{class:"tw:grow tw:p-4 tw:overflow-y-scroll",innerHTML:t.content},null,8,Ce),d("footer",ye,[q(dt,{onClick:o[0]||(o[0]=l=>i(t.id))},{default:G(()=>[R("Close")]),_:1})])])],512)),[[ft,t.isVisible]])}}),ke={},Ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"413",height:"413",viewBox:"0 0 413 413"},Me=gt('<defs><linearGradient id="hall-9000-gradient" x1="1" y1="1" x2="0.081" y2="0.124" gradientUnits="objectBoundingBox"><stop offset="0" stop-color="#6d86d6"></stop><stop offset="1" stop-color="#48c4ee"></stop></linearGradient></defs><rect fill="url(#hall-9000-gradient)" width="413" height="413" rx="206.5"></rect><circle fill="#fff" cx="74.189" cy="74.189" r="74.189" transform="translate(131.178 134.023)"></circle><circle fill="#fff" cx="35.382" cy="35.382" r="35.382" transform="translate(278.414 96.358)"></circle><path fill="#fff" d="M132.445,0C61.11,0,2.9,58.209,2.9,129.545S61.11,259.089,132.445,259.089,261.989,200.88,261.989,129.545,203.78,0,132.445,0Zm0,245.393A115.848,115.848,0,1,1,248.293,129.545,115.932,115.932,0,0,1,132.445,245.393Z" transform="translate(72.922 76.955)"></path>',5),Fe=[Me];function Ie(t,a){return s(),r("svg",Ae,Fe)}const Ee=K(ke,[["render",Ie]]),Se=$({__name:"chat-open-button",props:{isOpen:Boolean},emits:["open-chat"],setup(t,{emit:a}){const e=a;return(i,n)=>(s(),r("button",{onClick:n[1]||(n[1]=o=>e("open-chat")),class:"tw:fixed tw:bottom-2 tw:right-2 tw:sm:bottom-6 tw:sm:right-6 tw:z-20"},[q(Ee,{class:"tw:w-8 tw:h-8 tw:sm:w-16 tw:sm:h-16 tw:rounded-full tw:duration-300 tw:hover:rotate-90",onClick:n[0]||(n[0]=o=>e("open-chat"))})]))}}),De={class:"tw:absolute tw:sm:-top-12 tw:right-0 tw:items-center tw:justify-center tw:gap-2 tw:rounded-2xl tw:bg-white tw:pl-2 tw:pr-4 tw:shadow-lg tw:hidden tw:sm:flex"},Be=d("div",{class:"tw:bg-blue-500 tw:h-8 tw:w-8 tw:rounded-full"},null,-1),Le=d("div",{class:"tw:relative tw:-top-1 tw:text-2xl"},"tokens left",-1),qe={class:"tw:relative tw:-top-1 tw:text-4xl tw:font-bold"},Oe=d("div",{class:"tw:absolute tw:bottom-2 tw:left-4 tw:sm:hidden"}," {ramainingQuestions} tokens left ",-1),je=$({__name:"chat-tokens",props:{ramainingQuestions:Number},setup(t){return(a,e)=>(s(),r(N,null,[d("div",De,[Be,Le,d("div",qe,B(t.ramainingQuestions),1)]),Oe],64))}}),ze=["innerHTML"],Ve=$({__name:"chat-user-message",props:{isExpanded:Boolean,message:String},setup(t){return(a,e)=>(s(),r("div",{class:U(["tw:from-gray-200 tw:text-base tw:to-gray-300 tw:border-gray-400 tw:text-gray-700 tw:rounded-t-2xl tw:rounded-br-2xl tw:border tw:bg-linear-to-t tw:px-6 tw:pt-1 tw:pb-2",{"max-w-[700px]":t.isExpanded,"max-w-[414px]":!t.isExpanded}]),innerHTML:t.message},null,10,ze))}}),Ge=$({__name:"chat-gpt",setup(t){const a=D("chatGptData");if(!a)throw new Error("chatGptData is undefined");const{isActive:e,initMessage:i,campaigns:n,limitChat:o,hasAiChat:l,ajaxUrl:u,ajaxActionCreateAiChat:E,nonce:w,aiChatCampaignsField:h,beforeFormMessage:b,questionsLimit:k,aiChatCampaigns:A,afterFormMessageSuccess:L,allowAiChatCampaigns:I}=a,C=c(!1),S=c(null),f=c(!1),g=c(k),O=c(null),j=c(!1),Q=c(!1),Z=c(!1),P=c([]),z=c(null),v=c(null);T("aiChatId",O),T("setAiChatId",p=>{O.value=p}),T("setModalIdOpen",p=>{S.value=p}),T("setIsAcceptedAiChatForm",p=>{Q.value=p}),T("setIsAcceptedAiContactForm",p=>{Z.value=p}),T("setAllowChatInput",p=>{j.value=p}),T("setErrorMessage",p=>{v.value=p});async function H(p){const x=await Bt({ajaxUrl:u,action:E,nonce:w,aiChatCampaigns:h,campaignIds:p});x.success?(O.value=x.data.aiChatId,Q.value=!0,j.value=!0):console.error(x.error)}tt(C,()=>{C.value&&!O.value&&l&&!I&&(H([]),j.value=!0),C.value&&!l&&(Q.value=!0,j.value=!0)});const M=et(()=>!Q.value&&l&&A.length>0),V=et(()=>g.value===0&&!Z.value&&o);function wt(p){H(p)}function pt(p){if(!p.message.includes("[DONE]"))if(p.type==="system"){const x=P.value.at(-1);x&&x.type==="system"?x.message+=p.message:P.value.push({message:p.message,type:"system"})}else P.value.push({message:p.message,type:"user"})}function mt(){z.value&&(z.value.scrollTop=z.value.scrollHeight)}return tt(g,()=>{g.value===0&&(j.value=!1)}),vt(()=>{mt()}),(p,x)=>(s(),r(N,null,[m(e)?(s(),r("div",{key:0,class:U(["tw:inset-0 tw:w-full tw:h-full tw:bg-black/70 tw:justify-center tw:items-center tw:flex tw:z-20",{"tw:hidden":!C.value,"tw:fixed":C.value}])},[d("div",{class:U(["tw:relative tw:flex tw:flex-col tw:text-xl tw:w-full tw:h-full tw:min-h-full tw:p-4 tw:sm:p-6 tw:border-2 tw:sm:border-gray-300 tw:sm:rounded-3xl tw:shadow-card tw:bg-white",{"tw:sm:h-5/6 tw:sm:w-[900px] tw:sm:min-h-[600px] tw:mx-4":f.value,"tw:sm:h-4/6 tw:sm:w-[537px] tw:sm:min-h-[500px]":!f.value}])},[d("main",{class:"tw:flex tw:grow tw:flex-col tw:gap-3 tw:sm:gap-7 tw:overflow-y-auto tw:mb-4",ref_key:"chatContainer",ref:z},[M.value?(s(),_(St,{key:0,onFormAccepted:wt})):y("",!0),Q.value?(s(),_(at,{key:1,message:m(i),isExpanded:f.value},null,8,["message","isExpanded"])):y("",!0),(s(!0),r(N,null,W(P.value,F=>(s(),r(N,null,[F.type==="user"?(s(),_(Ve,{key:0,message:F.message},null,8,["message"])):(s(),_(at,{key:1,message:F.message,isExpanded:f.value},null,8,["message","isExpanded"]))],64))),256)),V.value?(s(),_(J,{key:2,type:"warning"},{default:G(()=>[R(B(m(b)),1)]),_:1})):y("",!0),V.value?(s(),_(Jt,{key:3})):y("",!0),Z.value?(s(),_(J,{key:4,type:"success"},{default:G(()=>[R(B(m(L)),1)]),_:1})):y("",!0),v.value?(s(),_(J,{key:5,type:"error"},{default:G(()=>[R(B(v.value),1)]),_:1})):y("",!0)],512),q(ie,{allowChatInput:j.value,aiChatId:O.value,remainingQuestions:g.value,"onUpdate:remainingQuestions":x[0]||(x[0]=F=>g.value=F),"onUpdate:messages":pt,"onUpdate:errorMessage":x[1]||(x[1]=F=>v.value=F)},null,8,["allowChatInput","aiChatId","remainingQuestions"]),m(o)?(s(),_(je,{key:0,ramainingQuestions:g.value},null,8,["ramainingQuestions"])):y("",!0),q(ve,{isExpanded:f.value,onExpandChat:x[2]||(x[2]=F=>f.value=!f.value)},null,8,["isExpanded"])],2)],2)):y("",!0),m(e)?(s(!0),r(N,{key:1},W(m(n),F=>(s(),_($e,{name:F.name,content:F.content,id:F.id,isVisible:F.id===S.value,onCloseModal:x[3]||(x[3]=Te=>S.value=null)},null,8,["name","content","id","isVisible"]))),256)):y("",!0),m(e)?(s(),_(Se,{key:2,onClick:x[4]||(x[4]=F=>C.value=!C.value),isOpen:C.value},null,8,["isOpen"])):y("",!0)],64))}});let ut={};ut=window.chat_gpt.data;const He=xt({setup(){T("chatGptData",ut)},render:()=>bt(Ge)});He.mount("#main_chat_gpt");
