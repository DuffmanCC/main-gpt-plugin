import{d as C,r as u,l as se,c as r,o as l,n as U,z as X,a as d,t as B,p as ne,b as y,e as O,w as G,f as R,i as D,k as b,F as N,g as W,u as v,_ as K,h as le,D as fe,E as he,G as ge,m as ee,j as te,H as ve,x as T,q as be,s as xe}from"./style.js";import{p as Y}from"./tools.js";function oe(o,e){for(let t=0;t<o.length;t++)if(!e.includes(o[t]))return!1;return!0}function ie(o){return o.filter(e=>e.isMandatory).map(e=>e.id)}function ye(o){return/^[a-zA-Z0-9._+-]+@[a-zA-Z0-9_+-]+\.[a-zA-Z]{2,}$/.test(o)}const J=C({__name:"chat-alert",props:{type:{},timeout:{default:0}},setup(o){const e=u(!0);return se(()=>{o.timeout!==0&&setTimeout(()=>{e.value=!1},o.timeout)}),(t,n)=>(l(),r("div",{class:U(["tw:border-l-4 tw:p-2 tw:rounded tw:bg-white tw:border tw:text-base",{"tw:border-blue-500 ":t.type==="info","tw:border-orange-500 ":t.type==="warning","tw:border-green-500 ":t.type==="success","tw:border-red-500 ":t.type==="error","tw:hidden":!e.value}]),role:"alert"},[X(t.$slots,"default")],2))}}),Ce={class:"tw:flex tw:gap-2 tw:text-black tw:text-sm tw:items-center tw:relative"},_e=["id","name"],$e={href:"#",className:"tw:underline"},re=C({__name:"chat-checkbox",props:{id:{},name:{},isMandatory:{type:Boolean}},emits:["accepted-campaign","update:modal-id-opened"],setup(o,{emit:e}){const t=e;return(n,a)=>(l(),r("label",Ce,[d("input",{id:`campaign-${n.id}`,name:`campaign-${n.id}`,type:"checkbox",onChange:a[0]||(a[0]=s=>t("accepted-campaign",n.id)),class:"tw:appearance-none! tw:peer tw:before:hidden! tw:w-4! tw:h-4! tw:border! tw:border-black! tw:rounded-none! tw:bg-white!"},null,40,_e),a[2]||(a[2]=d("svg",{class:"tw:absolute tw:w-4 tw:h-4 tw:hidden tw:peer-checked:block",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[d("polyline",{points:"20 6 9 17 4 12"})],-1)),d("div",{class:"tw:flex tw:gap-2",onClick:a[1]||(a[1]=s=>t("update:modal-id-opened",n.id))},[d("a",$e,B(n.name),1)]),d("span",{class:U({"tw:text-red-500 tw:text-xs":n.isMandatory,"tw:hidden":!n.isMandatory})}," (mandatory) ",2)]))}}),ke=["disabled"],de=C({__name:"chat-button",props:{disabled:{type:Boolean,default:!1}},emits:["click"],setup(o,{emit:e}){const t=e;return(n,a)=>(l(),r("button",{class:"tw:text-sm tw:uppercase tw:px-4 tw:py-3 tw:rounded-xl tw:text-white tw:transition-all tw:duration-300 tw:shadow-button tw:bg-blue-500 tw:hover:bg-blue-600 tw:active:bg-blue-700 tw:no-underline tw:disabled:opacity-50 tw:disabled:cursor-not-allowed",onClick:a[0]||(a[0]=s=>t("click")),disabled:n.disabled},[X(n.$slots,"default")],8,ke))}}),Ae={key:0,className:"tw:text-xl"},Fe={className:"tw:flex tw:justify-end"},ue=C({__name:"chat-form",props:{title:{},disabled:{type:Boolean}},emits:["submit"],setup(o,{emit:e}){const t=e;return(n,a)=>(l(),r("form",{className:"tw:flex tw:flex-col tw:gap-2 tw:text-black",onSubmit:a[0]||(a[0]=ne(s=>t("submit"),["prevent"]))},[n.title?(l(),r("div",Ae,B(n.title),1)):y("",!0),X(n.$slots,"default"),d("div",Fe,[O(de,{disabled:n.disabled,type:"submit"},{default:G(()=>a[1]||(a[1]=[R("Accept")])),_:1},8,["disabled"])])],32))}}),Me={className:"tw:flex tw:flex-col tw:gap-1"},Ie=C({__name:"chat-ai-chat-form",emits:["form-accepted"],setup(o,{emit:e}){const t=D("setModalIdOpen"),n=D("chatGptData");if(!n)throw new Error("chatGptData is undefined");const{aiChatCampaigns:a}=n,s=u([]),i=u(!1),c=e;function L(f){const A=s.value.indexOf(f);A===-1?s.value=[...s.value,f]:s.value.splice(A,1),oe(ie(a),s.value.map(k=>k.toString()))?i.value=!0:i.value=!1}function _(){c("form-accepted",s.value)}return(f,A)=>(l(),b(J,{type:"info"},{default:G(()=>[O(ue,{id:"ai-chat-campaigns-form",title:"Ai Chat Campaigns",disabled:!i.value,onSubmit:_},{default:G(()=>[d("div",Me,[(l(!0),r(N,null,W(v(a),$=>(l(),b(re,{key:$.id,id:$.id,name:$.name,isMandatory:$.isMandatory,onAcceptedCampaign:L,"onUpdate:modalIdOpened":v(t)},null,8,["id","name","isMandatory","onUpdate:modalIdOpened"]))),128))])]),_:1},8,["disabled"])]),_:1}))}}),Ee=async({ajaxUrl:o,action:e,queryField:t,aiChatterId:n,message:a,prevMessage:s,aiChatId:i,nonce:c,onMessageChunk:L})=>{const _=new FormData;_.append("action",e),_.append(`data[${t}]`,a),_.append("data[prevMessage]",s),_.append("data[aiChatterId]",n),_.append("security",c),i&&_.append("data[aiChatId]",i.toString());try{const f=await fetch(o,{method:"POST",body:_});if(!f.body)throw new Error("No response body.");const A=f.body.getReader(),$=new TextDecoder;let k="";for(;;){const{done:q,value:I}=await A.read();if(q)break;const x=$.decode(I,{stream:!0});L(x)}return k}catch(f){throw console.error("Error en la peticiÃ³n:",f),f}};async function De({ajaxUrl:o,action:e,nonce:t,aiChatCampaigns:n,campaignIds:a}){const s=new FormData;return s.append("action",e),s.append(`data[${n}][]`,a.join(",")),s.append("security",t),Y(o,s)}async function Be({ajaxUrl:o,action:e,nonce:t,message:n,aiChatId:a,role:s}){const i=new FormData;return i.append("action",e),i.append("data[aiChatMessage]",JSON.stringify({role:s,content:n})),i.append("data[aiChatId]",(a==null?void 0:a.toString())??""),i.append("security",t),Y(o,i)}async function Le({ajaxUrl:o,action:e,nonce:t,fields:n,campaignIds:a,aiChatterId:s,aiChatId:i}){const c=new FormData;return c.append("action",e),c.append("security",t),c.append("data[fields]",n),c.append("data[campaignIds]",a.join(",")),c.append("data[aiChatterId]",s),c.append("data[aiChatId]",i),Y(o,c)}const qe={class:"tw:flex tw:flex-col tw:gap-1 tw:relative tw:pb-4 tw:text-base"},Oe={class:"tw:flex tw:gap-2 tw:items-center"},Se={key:0,class:"tw:text-red-500 tw:text-xs"},je=["type","name","id","aria-errormessage"],ze={key:0,id:"`${id}-error`",class:"tw:text-red-500 tw:text-xs tw:absolute tw:bottom-0"},Ve=C({__name:"chat-input-field",props:{label:{},type:{},id:{},required:{type:Boolean},handleFilledField:{type:Function}},setup(o){const e=u(""),t=u(null);function n(s){const c=s.target.value.trim();e.value=c,a(c)}function a(s){return!s&&o.required?(t.value="This fields is required",o.handleFilledField(o.id,""),!0):o.id==="email"&&!ye(s)?(t.value="Please enter a valid email address",o.handleFilledField(o.id,""),!0):(t.value=null,o.handleFilledField(o.id,s),!1)}return(s,i)=>(l(),r("label",qe,[d("div",Oe,[R(B(s.label)+" ",1),s.required?(l(),r("span",Se,"(required)")):y("",!0)]),d("input",{type:s.type,name:s.id,id:s.id,class:"tw:border tw:border-gray-300 tw:rounded tw:px-2 tw:py-1",onInput:n,"aria-errormessage":`${s.id}-error`},null,40,je),t.value?(l(),r("div",ze,B(t.value),1)):y("",!0)]))}}),Ge={class:"tw:flex tw:flex-col tw:gap-1 tw:relative tw:pb-4 tw:text-base"},He={class:"tw:flex tw:gap-2 tw:items-center"},Te={key:0,class:"tw:text-red-500 tw:text-xs"},Ne=["name","id","aria-errormessage"],Ue=["id"],Qe=C({__name:"chat-textarea-field",props:{id:{},label:{},required:{type:Boolean},handleFilledField:{type:Function}},setup(o){const e=o,t=u(""),n=u(null);function a(i){i.preventDefault();const c=i.target;t.value=c.value}function s(){if(!t.value&&e.required){n.value="This fields is required";return}t.value&&(e.handleFilledField(e.id,t.value),n.value=null)}return(i,c)=>(l(),r("label",Ge,[d("div",He,[R(B(i.label)+" ",1),i.required?(l(),r("span",Te,"(required)")):y("",!0)]),d("textarea",{name:i.id,id:i.id,class:"tw:border tw:border-gray-300 tw:rounded tw:px-2 tw:py-1 tw:min-h-[100px]",onChange:a,onBlur:s,"aria-errormessage":`${i.id}-error`},null,40,Ne),d("div",{id:`${i.id}-error`,class:"tw:text-red-500 tw:text-xs tw:absolute tw:bottom-0"},B(n.value),9,Ue)]))}}),Re={key:1,className:"tw:flex tw:flex-col tw:gap-1"},Ze=C({__name:"chat-ai-contact-form",setup(o){const e=D("chatGptData");if(!e)throw new Error("Missing dependencies");const t=D("setModalIdOpen"),n=D("setAllowChatInput"),a=D("aiChatId"),s=D("setIsAcceptedAiContactForm"),i=D("setErrorMessage"),{aiContactCampaigns:c,formFields:L,ajaxUrl:_,ajaxActionCreateAiContact:f,nonce:A,aiChatterId:$,allowAiContactCampaigns:k,afterFormMessageError:q}=e,I=u([]),x=u(!1),E=u(!1),p=u(null),m=u({name:"",email:"",phone:"",message:""});function S(h){const H=I.value.indexOf(h);H===-1?I.value=[...I.value,h]:I.value.splice(H,1),oe(ie(c),I.value.map(V=>V.toString()))?E.value=!0:E.value=!1}function j(h,H){m.value={...m.value,[h]:H},L.filter(V=>V.required&&V.active).every(V=>m.value[V.label.toLowerCase()])?x.value=!0:x.value=!1}async function Q(){if(!a)return;const h=await Le({ajaxUrl:_,action:f,nonce:A,fields:JSON.stringify(m),campaignIds:I.value,aiChatterId:$,aiChatId:a});h.success?(p.value=h.data.aiContadId,s(!0),n(!1),i("")):(n(!1),i(q))}const Z=L.filter(h=>h.active),P=Z.filter(h=>h.type!=="textarea"),z=Z.find(h=>h.type==="textarea");return se(()=>{(c.length===0||!k)&&(E.value=!0)}),(h,H)=>(l(),b(J,{type:"info",class:"tw:mb-4"},{default:G(()=>[O(ue,{title:"Ai Contact Form",disabled:!E.value||!x.value,onSubmit:Q},{default:G(()=>[(l(!0),r(N,null,W(v(P),F=>(l(),b(Ve,{key:F.label,label:F.label,type:F.type,id:F.label.toLowerCase(),required:F.required,handleFilledField:j},null,8,["label","type","id","required"]))),128)),v(z)?(l(),b(Qe,{key:0,label:v(z).label,id:v(z).label.toLowerCase(),required:v(z).required,handleFilledField:j},null,8,["label","id","required"])):y("",!0),v(k)?(l(),r("div",Re,[(l(!0),r(N,null,W(v(c),F=>(l(),b(re,{key:F.id,id:F.id,name:F.name,isMandatory:F.isMandatory,onAcceptedCampaign:S,"onUpdate:modalIdOpened":v(t)},null,8,["id","name","isMandatory","onUpdate:modalIdOpened"]))),128))])):y("",!0)]),_:1},8,["disabled"])]),_:1}))}}),Pe=["innerHTML"],ae=C({__name:"chat-bot-message",props:{isExpanded:{type:Boolean},message:{}},setup(o){return(e,t)=>(l(),r("div",{class:U(["chat-message tw:text-base tw:gap-4 tw:flex tw:flex-col tw:from-blue-400 tw:to-blue-500 tw:self-end tw:rounded-b-2xl tw:rounded-tl-2xl tw:bg-linear-to-b tw:px-6 tw:pt-1 tw:pb-2 tw:text-white",{"max-w-[700px]":e.isExpanded,"max-w-[414px]":!e.isExpanded}]),innerHTML:e.message},null,10,Pe))}}),Je={},We={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor"};function Ke(o,e){return l(),r("svg",We,e[0]||(e[0]=[d("path",{d:"M16.1 260.2c-22.6 12.9-20.5 47.3 3.6 57.3L160 376V479.3c0 18.1 14.6 32.7 32.7 32.7c9.7 0 18.9-4.3 25.1-11.8l62-74.3 123.9 51.6c18.9 7.9 40.8-4.5 43.9-24.7l64-416c1.9-12.1-3.4-24.3-13.5-31.2s-23.3-7.5-34-1.4l-448 256zm52.1 25.5L409.7 90.6 190.1 336l1.2 1L68.2 285.7zM403.3 425.4L236.7 355.9 450.8 116.6 403.3 425.4z"},null,-1)]))}const Xe=K(Je,[["render",Ke]]),Ye=["disabled"],et={class:"tw:w-10 tw:h-10 tw:border tw:rounded-full tw:border-gray-400 tw:flex tw:justify-center tw:items-center tw:bg-white! tw:disabled:opacity-30 tw:disabled:cursor-not-allowed tw:focus:outline-hidden tw:focus:ring-2 tw:focus:ring-blue-500"},tt=C({__name:"chat-footer",props:{allowChatInput:{type:Boolean},aiChatId:{},remainingQuestions:{}},emits:["update:remaining-questions","update:messages","update:error-message"],setup(o,{emit:e}){const t=D("chatGptData");if(!t)throw new Error("chatGptData is undefined");const n=D("setAllowChatInput");if(!n)throw new Error("setAllowChatInput is undefined");const{ajaxUrl:a,ajaxActionChatBot:s,nonce:i,queryField:c,aiChatterId:L,ajaxActionRecordAiChat:_}=t,f=o,A=e,$=u(!1),k=u(""),q=u(""),I=u("");async function x(){if($.value=!0,!!k.value){q.value="",E(k.value,"user");try{await Ee({ajaxUrl:a,action:s,queryField:c,aiChatterId:L,message:k.value,prevMessage:I.value,aiChatId:f.aiChatId,nonce:i,onMessageChunk:p=>{q.value+=p,A("update:messages",{message:p,type:"system"})}}),E(q.value,"system"),I.value=q.value}catch(p){const m=p instanceof Error?p.message:"Error sending message";A("update:error-message",m)}finally{$.value=!1,k.value=""}}}async function E(p,m){m==="system"&&A("update:remaining-questions",f.remainingQuestions-1),f.aiChatId&&await Be({ajaxUrl:a,action:_,nonce:i,message:p,aiChatId:f.aiChatId,role:m}),f.remainingQuestions===0&&n(!1),A("update:messages",{message:p,type:m})}return(p,m)=>(l(),r("form",{class:"tw:flex tw:mb-6 tw:sm:mb-0 tw:gap-2",onSubmit:ne(x,["prevent"]),name:"chat-footer"},[le(d("input",{type:"text",id:"message","onUpdate:modelValue":m[0]||(m[0]=S=>k.value=S),disabled:$.value||!p.allowChatInput,class:"tw:grow tw:align-center tw:border-gray-400! tw:flex tw:rounded-full! tw:border! tw:px-6! tw:pt-1! tw:pb-2! tw:text-base! tw:shadow-lg tw:disabled:opacity-30 tw:disabled:cursor-not-allowed tw:focus:outline-hidden tw:focus:ring-2 tw:focus:ring-blue-500"},null,8,Ye),[[fe,k.value]]),d("button",et,[O(Xe,{class:"tw:w-6 tw:h-6 tw:text-gray-400"})])],32))}}),at={},st={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 512 512"};function nt(o,e){return l(),r("svg",st,e[0]||(e[0]=[d("path",{d:"M200 32H56C42.7 32 32 42.7 32 56V200c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l40-40 79 79-79 79L73 295c-6.9-6.9-17.2-8.9-26.2-5.2S32 302.3 32 312V456c0 13.3 10.7 24 24 24H200c9.7 0 18.5-5.8 22.2-14.8s1.7-19.3-5.2-26.2l-40-40 79-79 79 79-40 40c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H456c13.3 0 24-10.7 24-24V312c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2l-40 40-79-79 79-79 40 40c6.9 6.9 17.2 8.9 26.2 5.2s14.8-12.5 14.8-22.2V56c0-13.3-10.7-24-24-24H312c-9.7 0-18.5 5.8-22.2 14.8s-1.7 19.3 5.2 26.2l40 40-79 79-79-79 40-40c6.9-6.9 8.9-17.2 5.2-26.2S209.7 32 200 32z"},null,-1)]))}const lt=K(at,[["render",nt]]),ot={},it={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 512 512"};function rt(o,e){return l(),r("svg",it,e[0]||(e[0]=[d("path",{d:"M456 224H312c-13.3 0-24-10.7-24-24V56c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2l40 40L442.3 5.7C446 2 450.9 0 456 0s10 2 13.7 5.7l36.7 36.7C510 46 512 50.9 512 56s-2 10-5.7 13.7L433 143l40 40c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8zm0 64c9.7 0 18.5 5.8 22.2 14.8s1.7 19.3-5.2 26.2l-40 40 73.4 73.4c3.6 3.6 5.7 8.5 5.7 13.7s-2 10-5.7 13.7l-36.7 36.7C466 510 461.1 512 456 512s-10-2-13.7-5.7L369 433l-40 40c-6.9 6.9-17.2 8.9-26.2 5.2s-14.8-12.5-14.8-22.2V312c0-13.3 10.7-24 24-24H456zm-256 0c13.3 0 24 10.7 24 24V456c0 9.7-5.8 18.5-14.8 22.2s-19.3 1.7-26.2-5.2l-40-40L69.7 506.3C66 510 61.1 512 56 512s-10-2-13.7-5.7L5.7 469.7C2 466 0 461.1 0 456s2-10 5.7-13.7L79 369 39 329c-6.9-6.9-8.9-17.2-5.2-26.2s12.5-14.8 22.2-14.8H200zM56 224c-9.7 0-18.5-5.8-22.2-14.8s-1.7-19.3 5.2-26.2l40-40L5.7 69.7C2 66 0 61.1 0 56s2-10 5.7-13.7L42.3 5.7C46 2 50.9 0 56 0s10 2 13.7 5.7L143 79l40-40c6.9-6.9 17.2-8.9 26.2-5.2s14.8 12.5 14.8 22.2V200c0 13.3-10.7 24-24 24H56z"},null,-1)]))}const dt=K(ot,[["render",rt]]),ut=C({__name:"chat-maximize-button",props:{isExpanded:{type:Boolean}},emits:["expand-chat"],setup(o,{emit:e}){const t=e;function n(a){a.stopPropagation(),t("expand-chat")}return(a,s)=>(l(),r("button",{onClick:s[0]||(s[0]=i=>t("expand-chat")),class:"tw:absolute tw:top-2 tw:sm:-top-12 tw:left-0 tw:hidden tw:sm:block"},[O(lt,{onClick:n,class:U(["tw:h-6 tw:w-6 tw:sm:w-10 tw:sm:h-10 tw:text-blue-500",{"tw:block":!a.isExpanded,"tw:hidden!":a.isExpanded}])},null,8,["class"]),O(dt,{onClick:n,class:U(["tw:h-6 tw:w-6 tw:sm:w-10 tw:sm:h-10 tw:text-blue-500",{"tw:block":a.isExpanded,"tw:hidden!":!a.isExpanded}])},null,8,["class"])]))}}),ct={class:"tw:fixed tw:z-40 tw:inset-0 tw:w-full tw:h-full tw:bg-black tw:justify-center tw:items-center tw:flex tw:bg-opacity-50",tabindex:"-1"},wt={class:"tw:bg-white tw:rounded tw:w-full tw:max-w-lg tw:min-w-md tw:h-96 tw:flex tw:flex-col"},pt={class:"tw:p-4 tw:border-b"},mt=["innerHTML"],ft={class:"tw:flex tw:justify-end tw:border-t tw:p-4"},ht=C({__name:"chat-modal",props:{id:{},name:{},content:{},isVisible:{type:Boolean}},emits:["close-modal"],setup(o,{emit:e}){const t=e;function n(a){t("close-modal",a)}return(a,s)=>le((l(),r("div",ct,[d("div",wt,[d("header",pt,B(a.name),1),d("main",{class:"tw:grow tw:p-4 tw:overflow-y-scroll",innerHTML:a.content},null,8,mt),d("footer",ft,[O(de,{onClick:s[0]||(s[0]=i=>n(a.id))},{default:G(()=>s[1]||(s[1]=[R("Close")])),_:1})])])],512)),[[he,a.isVisible]])}}),gt={},vt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"413",height:"413",viewBox:"0 0 413 413"};function bt(o,e){return l(),r("svg",vt,e[0]||(e[0]=[ge('<defs><linearGradient id="hall-9000-gradient" x1="1" y1="1" x2="0.081" y2="0.124" gradientUnits="objectBoundingBox"><stop offset="0" stop-color="#6d86d6"></stop><stop offset="1" stop-color="#48c4ee"></stop></linearGradient></defs><rect fill="url(#hall-9000-gradient)" width="413" height="413" rx="206.5"></rect><circle fill="#fff" cx="74.189" cy="74.189" r="74.189" transform="translate(131.178 134.023)"></circle><circle fill="#fff" cx="35.382" cy="35.382" r="35.382" transform="translate(278.414 96.358)"></circle><path fill="#fff" d="M132.445,0C61.11,0,2.9,58.209,2.9,129.545S61.11,259.089,132.445,259.089,261.989,200.88,261.989,129.545,203.78,0,132.445,0Zm0,245.393A115.848,115.848,0,1,1,248.293,129.545,115.932,115.932,0,0,1,132.445,245.393Z" transform="translate(72.922 76.955)"></path>',5)]))}const xt=K(gt,[["render",bt]]),yt=C({__name:"chat-open-button",emits:["open-chat"],setup(o,{emit:e}){const t=e;return(n,a)=>(l(),r("button",{onClick:a[1]||(a[1]=s=>t("open-chat")),class:"tw:fixed tw:bottom-2 tw:right-2 tw:sm:bottom-6 tw:sm:right-6 tw:z-20"},[O(xt,{class:"tw:w-8 tw:h-8 tw:sm:w-16 tw:sm:h-16 tw:rounded-full tw:duration-300 tw:hover:rotate-90",onClick:a[0]||(a[0]=s=>t("open-chat"))})]))}}),Ct={class:"tw:absolute tw:sm:-top-12 tw:right-0 tw:items-center tw:justify-center tw:gap-2 tw:rounded-2xl tw:bg-white tw:pl-2 tw:pr-4 tw:shadow-lg tw:hidden tw:sm:flex"},_t={class:"tw:relative tw:-top-1 tw:text-4xl tw:font-bold"},$t=C({__name:"chat-tokens",props:{ramainingQuestions:{}},setup(o){return(e,t)=>(l(),r(N,null,[d("div",Ct,[t[0]||(t[0]=d("div",{class:"tw:bg-blue-500 tw:h-8 tw:w-8 tw:rounded-full"},null,-1)),t[1]||(t[1]=d("div",{class:"tw:relative tw:-top-1 tw:text-2xl"},"tokens left",-1)),d("div",_t,B(e.ramainingQuestions),1)]),t[2]||(t[2]=d("div",{class:"tw:absolute tw:bottom-2 tw:left-4 tw:sm:hidden"}," {ramainingQuestions} tokens left ",-1))],64))}}),kt=["innerHTML"],At=C({__name:"chat-user-message",props:{isExpanded:{type:Boolean},message:{}},setup(o){return(e,t)=>(l(),r("div",{class:U(["tw:from-gray-200 tw:text-base tw:to-gray-300 tw:border-gray-400 tw:text-gray-700 tw:rounded-t-2xl tw:rounded-br-2xl tw:border tw:bg-linear-to-t tw:px-6 tw:pt-1 tw:pb-2",{"max-w-[700px]":e.isExpanded,"max-w-[414px]":!e.isExpanded}]),innerHTML:e.message},null,10,kt))}}),Ft=C({__name:"chat-gpt",setup(o){const e=D("chatGptData");if(!e)throw new Error("chatGptData is undefined");const{isActive:t,initMessage:n,campaigns:a,limitChat:s,hasAiChat:i,ajaxUrl:c,ajaxActionCreateAiChat:L,nonce:_,aiChatCampaignsField:f,beforeFormMessage:A,questionsLimit:$,aiChatCampaigns:k,afterFormMessageSuccess:q,allowAiChatCampaigns:I}=e,x=u(!1),E=u(null),p=u(!1),m=u($),S=u(null),j=u(!1),Q=u(!1),Z=u(!1),P=u([]),z=u(null),h=u(null);T("aiChatId",S),T("setAiChatId",w=>{S.value=w}),T("setModalIdOpen",w=>{E.value=w}),T("setIsAcceptedAiChatForm",w=>{Q.value=w}),T("setIsAcceptedAiContactForm",w=>{Z.value=w}),T("setAllowChatInput",w=>{j.value=w}),T("setErrorMessage",w=>{h.value=w});async function H(w){const g=await De({ajaxUrl:c,action:L,nonce:_,aiChatCampaigns:f,campaignIds:w});g.success?(S.value=g.data.aiChatId,Q.value=!0,j.value=!0):console.error(g.error)}ee(x,()=>{x.value&&!S.value&&i&&!I&&(H([]),j.value=!0),x.value&&!i&&(Q.value=!0,j.value=!0)});const F=te(()=>!Q.value&&i&&k.length>0),V=te(()=>m.value===0&&!Z.value&&s);function we(w){H(w)}function pe(w){if(!w.message.includes("[DONE]"))if(w.type==="system"){const g=P.value.at(-1);g&&g.type==="system"?g.message+=w.message:P.value.push({message:w.message,type:"system"})}else P.value.push({message:w.message,type:"user"})}function me(){z.value&&(z.value.scrollTop=z.value.scrollHeight)}return ee(m,()=>{m.value===0&&(j.value=!1)}),ve(()=>{me()}),(w,g)=>(l(),r(N,null,[v(t)?(l(),r("div",{key:0,class:U(["tw:inset-0 tw:w-full tw:h-full tw:bg-black/70 tw:justify-center tw:items-center tw:flex tw:z-20",{"tw:hidden":!x.value,"tw:fixed":x.value}])},[d("div",{class:U(["tw:relative tw:flex tw:flex-col tw:text-xl tw:w-full tw:h-full tw:min-h-full tw:p-4 tw:sm:p-6 tw:border-2 tw:sm:border-gray-300 tw:sm:rounded-3xl tw:shadow-card tw:bg-white",{"tw:sm:h-5/6 tw:sm:w-[900px] tw:sm:min-h-[600px] tw:mx-4":p.value,"tw:sm:h-4/6 tw:sm:w-[537px] tw:sm:min-h-[500px]":!p.value}])},[d("main",{class:"tw:flex tw:grow tw:flex-col tw:gap-3 tw:sm:gap-7 tw:overflow-y-auto tw:mb-4",ref_key:"chatContainer",ref:z},[F.value?(l(),b(Ie,{key:0,onFormAccepted:we})):y("",!0),Q.value?(l(),b(ae,{key:1,message:v(n),isExpanded:p.value},null,8,["message","isExpanded"])):y("",!0),(l(!0),r(N,null,W(P.value,M=>(l(),r(N,null,[M.type==="user"?(l(),b(At,{key:0,message:M.message,isExpanded:p.value},null,8,["message","isExpanded"])):(l(),b(ae,{key:1,message:M.message,isExpanded:p.value},null,8,["message","isExpanded"]))],64))),256)),V.value?(l(),b(J,{key:2,type:"warning"},{default:G(()=>[R(B(v(A)),1)]),_:1})):y("",!0),V.value?(l(),b(Ze,{key:3})):y("",!0),Z.value?(l(),b(J,{key:4,type:"success"},{default:G(()=>[R(B(v(q)),1)]),_:1})):y("",!0),h.value?(l(),b(J,{key:5,type:"error"},{default:G(()=>[R(B(h.value),1)]),_:1})):y("",!0)],512),O(tt,{allowChatInput:j.value,aiChatId:S.value,remainingQuestions:m.value,"onUpdate:remainingQuestions":g[0]||(g[0]=M=>m.value=M),"onUpdate:messages":pe,"onUpdate:errorMessage":g[1]||(g[1]=M=>h.value=M)},null,8,["allowChatInput","aiChatId","remainingQuestions"]),v(s)?(l(),b($t,{key:0,ramainingQuestions:m.value},null,8,["ramainingQuestions"])):y("",!0),O(ut,{isExpanded:p.value,onExpandChat:g[2]||(g[2]=M=>p.value=!p.value)},null,8,["isExpanded"])],2)],2)):y("",!0),v(t)?(l(!0),r(N,{key:1},W(v(a),M=>(l(),b(ht,{name:M.name,content:M.content,id:M.id,isVisible:M.id===E.value,onCloseModal:g[3]||(g[3]=It=>E.value=null)},null,8,["name","content","id","isVisible"]))),256)):y("",!0),v(t)?(l(),b(yt,{key:2,onClick:g[4]||(g[4]=M=>x.value=!x.value),isOpen:x.value},null,8,["isOpen"])):y("",!0)],64))}});let ce={};ce=window.chat_gpt.data;const Mt=be({setup(){T("chatGptData",ce)},render:()=>xe(Ft)});Mt.mount("#main_chat_gpt");
