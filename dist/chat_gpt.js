import{d as $,r as u,l as se,c as i,o,n as z,z as K,a as d,t as D,p as ne,b as _,e as O,w as j,f as Z,i as E,k as y,F as Q,g as J,u as v,_ as W,h as oe,D as fe,E as he,G as ge,m as ee,j as te,H as ve,x as U,q as be,s as xe}from"./style.js";import{p as X}from"./tools.js";const P=$({__name:"chat-alert",props:{type:{},timeout:{default:0}},setup(l){const e=u(!0);return se(()=>{l.timeout!==0&&setTimeout(()=>{e.value=!1},l.timeout)}),(t,n)=>(o(),i("div",{class:z(["border-l-4! p-2 rounded bg-white border! text-base",{"border-blue-500! ":t.type==="info","border-orange-500! ":t.type==="warning","border-green-500! ":t.type==="success","border-red-500! ":t.type==="error",hidden:!e.value}]),role:"alert"},[K(t.$slots,"default")],2))}}),ye=["innerHTML"],ae=$({__name:"chat-bot-message",props:{isExpanded:{type:Boolean},message:{}},setup(l){return(e,t)=>(o(),i("div",{class:z(["chat-message text-base gap-4 flex flex-col from-blue-400 to-blue-500 self-end rounded-b-2xl rounded-tl-2xl bg-linear-to-b px-6 pt-1 pb-2 text-white",{"max-w-[700px]":e.isExpanded,"max-w-[414px]":!e.isExpanded}]),innerHTML:e.message},null,10,ye))}});function le(l,e){for(let t=0;t<l.length;t++)if(!e.includes(l[t]))return!1;return!0}function re(l){return l.filter(e=>e.isMandatory).map(e=>e.id)}function Ce(l){return/^[a-zA-Z0-9._+-]+@[a-zA-Z0-9_+-]+\.[a-zA-Z]{2,}$/.test(l)}const we={class:"flex gap-2 text-black text-sm items-center relative"},_e=["id","name"],$e={href:"#",className:"underline"},ie=$({__name:"chat-checkbox",props:{id:{},name:{},isMandatory:{type:Boolean}},emits:["accepted-campaign","update:modal-id-opened"],setup(l,{emit:e}){const t=e;return(n,s)=>(o(),i("label",we,[d("input",{id:`campaign-${n.id}`,name:`campaign-${n.id}`,type:"checkbox",onChange:s[0]||(s[0]=a=>t("accepted-campaign",n.id)),class:"appearance-none! peer before:hidden! w-4! h-4! border! border-black! rounded-none! bg-white!"},null,40,_e),s[2]||(s[2]=d("svg",{class:"absolute w-4 h-4 hidden peer-checked:block",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[d("polyline",{points:"20 6 9 17 4 12"})],-1)),d("div",{class:"flex gap-2",onClick:s[1]||(s[1]=a=>t("update:modal-id-opened",n.id))},[d("a",$e,D(n.name),1)]),d("span",{class:z({"text-red-500 text-xs":n.isMandatory,hidden:!n.isMandatory})}," (mandatory) ",2)]))}}),ke=["disabled"],de=$({__name:"chat-button",props:{disabled:{type:Boolean,default:!1}},emits:["click"],setup(l,{emit:e}){const t=e;return(n,s)=>(o(),i("button",{class:z(`
      text-sm uppercase px-4 py-2 rounded-xl 
      text-white transition-color shadow-button 
      bg-blue-500 hover:bg-blue-600 active:bg-blue-700 no-underline 
      disabled:opacity-50 disabled:cursor-not-allowed
    `),onClick:s[0]||(s[0]=a=>t("click")),disabled:n.disabled},[K(n.$slots,"default")],8,ke))}}),Ae={key:0,className:"text-xl"},Fe={className:"flex justify-end"},ue=$({__name:"chat-form",props:{title:{},disabled:{type:Boolean}},emits:["submit"],setup(l,{emit:e}){const t=e;return(n,s)=>(o(),i("form",{className:"flex flex-col gap-2 text-black",onSubmit:s[0]||(s[0]=ne(a=>t("submit"),["prevent"]))},[n.title?(o(),i("div",Ae,D(n.title),1)):_("",!0),K(n.$slots,"default"),d("div",Fe,[O(de,{disabled:n.disabled,type:"submit"},{default:j(()=>s[1]||(s[1]=[Z("Accept")])),_:1},8,["disabled"])])],32))}}),Me={className:"flex flex-col gap-1"},Ie=$({__name:"chat-campaigns-form",emits:["form-accepted"],setup(l,{emit:e}){const t=E("setModalIdOpen"),n=E("chatGptData");if(!n)throw new Error("chatGptData is undefined");const{aiChatCampaigns:s}=n,a=u([]),r=u(!1),g=e;function B(m){const A=a.value.indexOf(m);A===-1?a.value=[...a.value,m]:a.value.splice(A,1),le(re(s),a.value.map(I=>I.toString()))?r.value=!0:r.value=!1}function k(){g("form-accepted",a.value)}return(m,A)=>(o(),y(P,{type:"info"},{default:j(()=>[O(ue,{title:"Campaigns From",disabled:!r.value,onSubmit:k},{default:j(()=>[d("div",Me,[(o(!0),i(Q,null,J(v(s),C=>(o(),y(ie,{key:C.id,id:C.id,name:C.name,isMandatory:C.isMandatory,onAcceptedCampaign:B,"onUpdate:modalIdOpened":v(t)},null,8,["id","name","isMandatory","onUpdate:modalIdOpened"]))),128))])]),_:1},8,["disabled"])]),_:1}))}});async function Ee({ajaxUrl:l,action:e,queryField:t,aiChatterId:n,message:s,prevMessage:a,aiChatId:r,isNewConversation:g,onMessageChunk:B}){const k=new FormData;k.append("action",e),k.append(`data[${t}]`,s),k.append("data[prevMessage]",a),k.append("data[aiChatterId]",n),k.append("data[isNewConversation]",g?"true":"false"),r&&k.append("data[aiChatId]",r.toString());try{const m=await fetch(l,{method:"POST",body:k});if(!m.body)throw new Error("No response body.");const A=m.body.getReader(),C=new TextDecoder;for(;;){const{done:I,value:F}=await A.read();if(I)break;const b=C.decode(F,{stream:!0});B(b)}}catch(m){throw console.error("Error en la peticiÃ³n:",m),m}}async function De({ajaxUrl:l,action:e,aiChatCampaignsField:t,campaignIds:n}){const s=new FormData;return s.append("action",e),s.append(`data[${t}][]`,n.join(",")),X(l,s)}async function Be({ajaxUrl:l,action:e,message:t,aiChatId:n,role:s}){const a=new FormData;return a.append("action",e),a.append("data[aiChatMessage]",JSON.stringify({role:s,content:t})),a.append("data[aiChatId]",(n==null?void 0:n.toString())??""),X(l,a)}async function Le({ajaxUrl:l,action:e,fields:t,campaignIds:n,aiChatterId:s,aiChatId:a}){const r=new FormData;return r.append("action",e),r.append("data[fields]",t),r.append("data[campaignIds][]",n.join(",")),r.append("data[aiChatterId]",s),r.append("data[aiChatId]",a),X(l,r)}const qe={class:"flex flex-col gap-1 relative pb-4 text-base"},Ne={class:"flex gap-2 items-center"},Oe={key:0,class:"text-red-500 text-xs"},Se=["type","name","id","aria-errormessage"],je={key:0,id:"`${id}-error`",class:"text-red-500 text-xs absolute bottom-0"},ze=$({__name:"chat-input-field",props:{label:{},type:{},id:{},required:{type:Boolean},handleFilledField:{type:Function}},setup(l){const e=u(""),t=u(null);function n(a){const g=a.target.value.trim();e.value=g,s(g)}function s(a){return!a&&l.required?(t.value="This fields is required",l.handleFilledField(l.id,""),!0):l.id==="email"&&!Ce(a)?(t.value="Please enter a valid email address",l.handleFilledField(l.id,""),!0):(t.value=null,l.handleFilledField(l.id,a),!1)}return(a,r)=>(o(),i("label",qe,[d("div",Ne,[Z(D(a.label)+" ",1),a.required?(o(),i("span",Oe,"(required)")):_("",!0)]),d("input",{type:a.type,name:a.id,id:a.id,class:"border border-gray-300 rounded px-2 py-1",onInput:n,"aria-errormessage":`${a.id}-error`},null,40,Se),t.value?(o(),i("div",je,D(t.value),1)):_("",!0)]))}}),Ve={class:"flex flex-col gap-1 relative pb-4 text-base"},Ge={class:"flex gap-2 items-center"},He={key:0,class:"text-red-500 text-xs"},Te=["name","id","aria-errormessage"],Ue=["id"],Qe=$({__name:"chat-textarea-field",props:{id:{},label:{},required:{type:Boolean},handleFilledField:{type:Function}},setup(l){const e=l,t=u(""),n=u(null);function s(r){r.preventDefault();const g=r.target;t.value=g.value}function a(){if(!t.value&&e.required){n.value="This fields is required";return}t.value&&(e.handleFilledField(e.id,t.value),n.value=null)}return(r,g)=>(o(),i("label",Ve,[d("div",Ge,[Z(D(r.label)+" ",1),r.required?(o(),i("span",He,"(required)")):_("",!0)]),d("textarea",{name:r.id,id:r.id,class:"border border-gray-300 rounded px-2 py-1 min-h-[100px]",onChange:s,onBlur:a,"aria-errormessage":`${r.id}-error`},null,40,Te),d("div",{id:`${r.id}-error`,class:"text-red-500 text-xs absolute bottom-0"},D(n.value),9,Ue)]))}}),Ze={key:1,className:"flex flex-col gap-1"},Re=$({__name:"chat-contact-form",setup(l){const e=E("chatGptData");if(!e)throw new Error("Missing dependencies");const t=E("setModalIdOpen"),n=E("setAllowChatInput"),s=E("aiChatId"),a=E("setIsAcceptedAiContactForm"),r=E("setErrorMessage"),{aiContactCampaigns:g,formFields:B,ajaxUrl:k,ajaxActionCreateAiContact:m,aiChatterId:A,allowAiContactCampaigns:C,afterFormMessageError:I}=e,F=u([]),b=u(!1),S=u(!1),V=u(null),c=u({name:"",email:"",phone:"",message:""});function x(h){const N=F.value.indexOf(h);N===-1?F.value=[...F.value,h]:F.value.splice(N,1),le(re(g),F.value.map(T=>T.toString()))?S.value=!0:S.value=!1}function L(h,N){c.value={...c.value,[h]:N},B.filter(T=>T.required&&T.active).every(T=>c.value[T.label.toLowerCase()])?b.value=!0:b.value=!1}async function G(){if(!s)return;const h=await Le({ajaxUrl:k,action:m,fields:JSON.stringify(c),campaignIds:F.value,aiChatterId:A,aiChatId:s});h.success?(V.value=h.data.aiContadId,a(!0),n(!1),r("")):(n(!1),r(I))}const H=B.filter(h=>h.active),R=H.filter(h=>h.type!=="textarea"),q=H.find(h=>h.type==="textarea");return se(()=>{(g.length===0||!C)&&(S.value=!0)}),(h,N)=>(o(),y(P,{type:"info",class:"mb-4"},{default:j(()=>[O(ue,{title:"Ai Contact Form",disabled:!S.value||!b.value,onSubmit:G},{default:j(()=>[(o(!0),i(Q,null,J(v(R),M=>(o(),y(ze,{key:M.label,label:M.label,type:M.type,id:M.label.toLowerCase(),required:M.required,handleFilledField:L},null,8,["label","type","id","required"]))),128)),v(q)?(o(),y(Qe,{key:0,label:v(q).label,id:v(q).label.toLowerCase(),required:v(q).required,handleFilledField:L},null,8,["label","id","required"])):_("",!0),v(C)?(o(),i("div",Ze,[(o(!0),i(Q,null,J(v(g),M=>(o(),y(ie,{key:M.id,id:M.id,name:M.name,isMandatory:M.isMandatory,onAcceptedCampaign:x,"onUpdate:modalIdOpened":v(t)},null,8,["id","name","isMandatory","onUpdate:modalIdOpened"]))),128))])):_("",!0)]),_:1},8,["disabled"])]),_:1}))}}),Pe={},Je={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor"};function We(l,e){return o(),i("svg",Je,e[0]||(e[0]=[d("path",{d:"M16.1 260.2c-22.6 12.9-20.5 47.3 3.6 57.3L160 376V479.3c0 18.1 14.6 32.7 32.7 32.7c9.7 0 18.9-4.3 25.1-11.8l62-74.3 123.9 51.6c18.9 7.9 40.8-4.5 43.9-24.7l64-416c1.9-12.1-3.4-24.3-13.5-31.2s-23.3-7.5-34-1.4l-448 256zm52.1 25.5L409.7 90.6 190.1 336l1.2 1L68.2 285.7zM403.3 425.4L236.7 355.9 450.8 116.6 403.3 425.4z"},null,-1)]))}const Ke=W(Pe,[["render",We]]),Xe=["disabled"],Ye={class:"w-10 h-10 border rounded-full border-gray-400 flex justify-center items-center bg-white! disabled:opacity-30 disabled:cursor-not-allowed focus:outline-hidden focus:ring-2 focus:ring-blue-500"},et=$({__name:"chat-footer",props:{allowChatInput:{type:Boolean},aiChatId:{},remainingQuestions:{},isNewConversation:{type:Boolean}},emits:["update:remaining-questions","update:messages","update:error-message","update:is-new-conversation"],setup(l,{emit:e}){const t=E("chatGptData");if(!t)throw new Error("chatGptData is undefined");const n=E("setAllowChatInput");if(!n)throw new Error("setAllowChatInput is undefined");const{ajaxUrl:s,ajaxActionChatBot:a,queryField:r,aiChatterId:g,ajaxActionRecordAiChat:B,limitChat:k}=t,m=l,A=e,C=u(!1),I=u(""),F=u(""),b=u("");async function S(){if(C.value=!0,!!I.value){F.value="",V(I.value,"user");try{await Ee({ajaxUrl:s,action:a,queryField:r,aiChatterId:g,message:I.value,prevMessage:b.value,aiChatId:m.aiChatId,isNewConversation:m.isNewConversation,onMessageChunk:c=>{F.value+=c,A("update:messages",{message:c,type:"system"})}}),A("update:is-new-conversation",!1),V(F.value,"system"),b.value=F.value}catch(c){const x=c instanceof Error?c.message:"Error sending message";A("update:error-message",x)}finally{C.value=!1,I.value=""}}}async function V(c,x){x==="system"&&A("update:remaining-questions",m.remainingQuestions-1),m.aiChatId&&await Be({ajaxUrl:s,action:B,message:c,aiChatId:m.aiChatId,role:x}),m.remainingQuestions===0&&k&&n(!1),A("update:messages",{message:c,type:x})}return(c,x)=>(o(),i("form",{class:"flex mb-6 sm:mb-0 gap-2",onSubmit:ne(S,["prevent"]),name:"chat-footer"},[oe(d("input",{type:"text",id:"message","onUpdate:modelValue":x[0]||(x[0]=L=>I.value=L),disabled:C.value||!c.allowChatInput,class:"grow align-center border-gray-400! flex rounded-full! border! px-6! pt-1! pb-2! text-base! shadow-lg disabled:opacity-30 disabled:cursor-not-allowed focus:outline-hidden focus:ring-2 focus:ring-blue-500"},null,8,Xe),[[fe,I.value]]),d("button",Ye,[O(Ke,{class:"w-6 h-6 text-gray-400"})])],32))}}),tt={},at={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 512 512"};function st(l,e){return o(),i("svg",at,e[0]||(e[0]=[d("path",{d:"M200 32H56C42.7 32 32 42.7 32 56V200c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l40-40 79 79-79 79L73 295c-6.9-6.9-17.2-8.9-26.2-5.2S32 302.3 32 312V456c0 13.3 10.7 24 24 24H200c9.7 0 18.5-5.8 22.2-14.8s1.7-19.3-5.2-26.2l-40-40 79-79 79 79-40 40c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H456c13.3 0 24-10.7 24-24V312c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2l-40 40-79-79 79-79 40 40c6.9 6.9 17.2 8.9 26.2 5.2s14.8-12.5 14.8-22.2V56c0-13.3-10.7-24-24-24H312c-9.7 0-18.5 5.8-22.2 14.8s-1.7 19.3 5.2 26.2l40 40-79 79-79-79 40-40c6.9-6.9 8.9-17.2 5.2-26.2S209.7 32 200 32z"},null,-1)]))}const nt=W(tt,[["render",st]]),ot={},lt={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 512 512"};function rt(l,e){return o(),i("svg",lt,e[0]||(e[0]=[d("path",{d:"M456 224H312c-13.3 0-24-10.7-24-24V56c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2l40 40L442.3 5.7C446 2 450.9 0 456 0s10 2 13.7 5.7l36.7 36.7C510 46 512 50.9 512 56s-2 10-5.7 13.7L433 143l40 40c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8zm0 64c9.7 0 18.5 5.8 22.2 14.8s1.7 19.3-5.2 26.2l-40 40 73.4 73.4c3.6 3.6 5.7 8.5 5.7 13.7s-2 10-5.7 13.7l-36.7 36.7C466 510 461.1 512 456 512s-10-2-13.7-5.7L369 433l-40 40c-6.9 6.9-17.2 8.9-26.2 5.2s-14.8-12.5-14.8-22.2V312c0-13.3 10.7-24 24-24H456zm-256 0c13.3 0 24 10.7 24 24V456c0 9.7-5.8 18.5-14.8 22.2s-19.3 1.7-26.2-5.2l-40-40L69.7 506.3C66 510 61.1 512 56 512s-10-2-13.7-5.7L5.7 469.7C2 466 0 461.1 0 456s2-10 5.7-13.7L79 369 39 329c-6.9-6.9-8.9-17.2-5.2-26.2s12.5-14.8 22.2-14.8H200zM56 224c-9.7 0-18.5-5.8-22.2-14.8s-1.7-19.3 5.2-26.2l40-40L5.7 69.7C2 66 0 61.1 0 56s2-10 5.7-13.7L42.3 5.7C46 2 50.9 0 56 0s10 2 13.7 5.7L143 79l40-40c6.9-6.9 17.2-8.9 26.2-5.2s14.8 12.5 14.8 22.2V200c0 13.3-10.7 24-24 24H56z"},null,-1)]))}const it=W(ot,[["render",rt]]),dt=$({__name:"chat-maximize-button",props:{isExpanded:{type:Boolean}},emits:["expand-chat"],setup(l,{emit:e}){const t=e;function n(s){s.stopPropagation(),t("expand-chat")}return(s,a)=>(o(),i("button",{onClick:a[0]||(a[0]=r=>t("expand-chat")),class:"absolute top-2 sm:-top-12 left-0 hidden sm:block"},[O(nt,{onClick:n,class:z(["h-6 w-6 sm:w-10 sm:h-10 text-blue-500",{block:!s.isExpanded,"hidden!":s.isExpanded}])},null,8,["class"]),O(it,{onClick:n,class:z(["h-6 w-6 sm:w-10 sm:h-10 text-blue-500",{block:s.isExpanded,"hidden!":!s.isExpanded}])},null,8,["class"])]))}}),ut={class:"fixed z-40 inset-0 w-full h-full bg-black justify-center items-center flex bg-opacity-50",tabindex:"-1"},ct={class:"bg-white rounded w-full max-w-lg min-w-md h-96 flex flex-col"},pt={class:"p-4 border-b"},mt=["innerHTML"],ft={class:"flex justify-end border-t p-4"},ht=$({__name:"chat-modal",props:{id:{},name:{},content:{},isVisible:{type:Boolean}},emits:["close-modal"],setup(l,{emit:e}){const t=e;function n(a){t("close-modal",a)}function s(a){return a.replace(/\r?\n/g,"<br>")}return(a,r)=>oe((o(),i("div",ut,[d("div",ct,[d("header",pt,D(a.name),1),d("main",{class:"grow p-4 overflow-y-scroll prose",innerHTML:s(a.content)},null,8,mt),d("footer",ft,[O(de,{onClick:r[0]||(r[0]=g=>n(a.id))},{default:j(()=>r[1]||(r[1]=[Z("Close")])),_:1})])])],512)),[[he,a.isVisible]])}}),gt={},vt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"413",height:"413",viewBox:"0 0 413 413"};function bt(l,e){return o(),i("svg",vt,e[0]||(e[0]=[ge('<defs><linearGradient id="hall-9000-gradient" x1="1" y1="1" x2="0.081" y2="0.124" gradientUnits="objectBoundingBox"><stop offset="0" stop-color="#6d86d6"></stop><stop offset="1" stop-color="#48c4ee"></stop></linearGradient></defs><rect fill="url(#hall-9000-gradient)" width="413" height="413" rx="206.5"></rect><circle fill="#fff" cx="74.189" cy="74.189" r="74.189" transform="translate(131.178 134.023)"></circle><circle fill="#fff" cx="35.382" cy="35.382" r="35.382" transform="translate(278.414 96.358)"></circle><path fill="#fff" d="M132.445,0C61.11,0,2.9,58.209,2.9,129.545S61.11,259.089,132.445,259.089,261.989,200.88,261.989,129.545,203.78,0,132.445,0Zm0,245.393A115.848,115.848,0,1,1,248.293,129.545,115.932,115.932,0,0,1,132.445,245.393Z" transform="translate(72.922 76.955)"></path>',5)]))}const xt=W(gt,[["render",bt]]),yt=$({__name:"chat-open-button",emits:["open-chat"],setup(l,{emit:e}){const t=e;return(n,s)=>(o(),i("button",{onClick:s[1]||(s[1]=a=>t("open-chat")),class:"fixed bottom-2 right-2 sm:bottom-6 sm:right-6 z-20"},[O(xt,{class:"w-8 h-8 sm:w-16 sm:h-16 rounded-full duration-300 hover:rotate-90",onClick:s[0]||(s[0]=a=>t("open-chat"))})]))}}),Ct={class:"absolute sm:-top-12 right-0 items-center justify-center gap-2 rounded-2xl bg-white pl-2 pr-4 shadow-lg hidden sm:flex"},wt={class:"relative -top-1 text-4xl font-bold"},_t=$({__name:"chat-tokens",props:{ramainingQuestions:{}},setup(l){return(e,t)=>(o(),i(Q,null,[d("div",Ct,[t[0]||(t[0]=d("div",{class:"bg-blue-500 h-8 w-8 rounded-full"},null,-1)),t[1]||(t[1]=d("div",{class:"relative -top-1 text-2xl"},"tokens left",-1)),d("div",wt,D(e.ramainingQuestions),1)]),t[2]||(t[2]=d("div",{class:"absolute bottom-2 left-4 sm:hidden"}," {ramainingQuestions} tokens left ",-1))],64))}}),$t=["innerHTML"],kt=$({__name:"chat-user-message",props:{isExpanded:{type:Boolean},message:{}},setup(l){return(e,t)=>(o(),i("div",{class:z(["from-gray-200 text-base to-gray-300 border-gray-400 text-gray-700 rounded-t-2xl rounded-br-2xl border bg-linear-to-t px-6 pt-1 pb-2",{"max-w-[700px]":e.isExpanded,"max-w-[414px]":!e.isExpanded}]),innerHTML:e.message},null,10,$t))}}),At=$({__name:"chat-gpt",setup(l){const e=E("chatGptData");if(!e)throw new Error("chatGptData is undefined");const{isActive:t,initMessage:n,campaigns:s,limitChat:a,hasAiChat:r,ajaxUrl:g,ajaxActionCreateAiChat:B,aiChatCampaignsField:k,beforeFormMessage:m,questionsLimit:A,aiChatCampaigns:C,afterFormMessageSuccess:I,allowAiChatCampaigns:F}=e,b=u(!1),S=u(!0),V=u(null),c=u(!1),x=u(A),L=u(null),G=u(!1),H=u(!1),R=u(!1),q=u([]),h=u(null),N=u(null);U("aiChatId",L),U("setAiChatId",p=>L.value=p),U("setModalIdOpen",p=>V.value=p),U("setErrorMessage",p=>N.value=p),U("setIsAcceptedAiChatForm",p=>H.value=p),U("setIsAcceptedAiContactForm",p=>R.value=p),U("setAllowChatInput",p=>G.value=p);async function M(p){const f=await De({ajaxUrl:g,action:B,aiChatCampaignsField:k,campaignIds:p});f.success?(L.value=f.data.aiChatId,H.value=!0,G.value=!0):console.error(f.error)}ee(b,()=>{b.value&&!L.value&&r&&!F&&(M([]),G.value=!0),b.value&&!r&&(H.value=!0,G.value=!0)});const T=te(()=>!H.value&&r&&C.length>0),Y=te(()=>x.value===0&&!R.value&&a);function pe(p){if(p.type==="system"){const f=q.value[q.value.length-1];if(f&&f.type==="system"){if(p.message.includes("[DONE]"))return;f.message+=p.message}else q.value.push({message:p.message,type:"system"})}p.type==="user"&&q.value.push({message:p.message,type:"user"})}function me(){h.value&&(h.value.scrollTop=h.value.scrollHeight)}return ee(x,()=>{x.value===0&&a&&(G.value=!1)}),ve(()=>{me()}),(p,f)=>(o(),i(Q,null,[v(t)?(o(),i("div",{key:0,class:z(["inset-0 w-full h-full bg-black/70 justify-center items-center flex z-20 font-arboria font-normal",{hidden:!b.value,fixed:b.value}])},[d("div",{class:z(["relative flex flex-col text-xl w-full h-full min-h-full p-4 sm:p-6 border-2 sm:border-gray-300 sm:rounded-3xl shadow-card bg-white",{"sm:h-5/6 sm:w-[900px] sm:min-h-[600px] mx-4":c.value,"sm:h-4/6 sm:w-[537px] sm:min-h-[500px]":!c.value}])},[d("div",{class:"flex grow flex-col gap-3 sm:gap-7 overflow-y-auto mb-4",ref_key:"chatContainer",ref:h},[T.value?(o(),y(Ie,{key:0,onFormAccepted:M})):_("",!0),H.value?(o(),y(ae,{key:1,message:v(n),isExpanded:c.value},null,8,["message","isExpanded"])):_("",!0),(o(!0),i(Q,null,J(q.value,w=>(o(),i(Q,null,[w.type==="user"?(o(),y(kt,{key:0,message:w.message,isExpanded:c.value},null,8,["message","isExpanded"])):(o(),y(ae,{key:1,message:w.message,isExpanded:c.value},null,8,["message","isExpanded"]))],64))),256)),Y.value?(o(),y(P,{key:2,type:"warning"},{default:j(()=>[Z(D(v(m)),1)]),_:1})):_("",!0),Y.value?(o(),y(Re,{key:3})):_("",!0),R.value?(o(),y(P,{key:4,type:"success"},{default:j(()=>[Z(D(v(I)),1)]),_:1})):_("",!0),N.value?(o(),y(P,{key:5,type:"error"},{default:j(()=>[Z(D(N.value),1)]),_:1})):_("",!0)],512),O(et,{allowChatInput:G.value,aiChatId:L.value,remainingQuestions:x.value,isNewConversation:S.value,"onUpdate:remainingQuestions":f[0]||(f[0]=w=>x.value=w),"onUpdate:messages":pe,"onUpdate:errorMessage":f[1]||(f[1]=w=>N.value=w),"onUpdate:isNewConversation":f[2]||(f[2]=w=>S.value=w)},null,8,["allowChatInput","aiChatId","remainingQuestions","isNewConversation"]),v(a)?(o(),y(_t,{key:0,ramainingQuestions:x.value},null,8,["ramainingQuestions"])):_("",!0),O(dt,{isExpanded:c.value,onExpandChat:f[3]||(f[3]=w=>c.value=!c.value)},null,8,["isExpanded"])],2)],2)):_("",!0),v(t)?(o(!0),i(Q,{key:1},J(v(s),w=>(o(),y(ht,{name:w.name,content:w.content,id:w.id,isVisible:w.id===V.value,onCloseModal:f[4]||(f[4]=Mt=>V.value=null)},null,8,["name","content","id","isVisible"]))),256)):_("",!0),v(t)?(o(),y(yt,{key:2,onClick:f[5]||(f[5]=w=>b.value=!b.value),isOpen:b.value},null,8,["isOpen"])):_("",!0)],64))}});let ce={};ce=window.chat_gpt.data;const Ft=be({setup(){U("chatGptData",ce)},render:()=>xe(At)});Ft.mount("#maingpt_chat");
