import{d as W,r as l,o as c,c as h,a,b,w as N,e as U,t as V,F as K,f as X,g as fe,v as ye,h as j,n as q,i as se,j as oe,k as O,l as re,m as J,p as ge,u as te,q as he,s as xe,x as _e}from"./wug-style.js";import{m as de,_ as ie}from"./metabox-body.js";import{a as be,_ as me,b as pe,c as we}from"./a-text.vue_vue_type_script_setup_true_lang.js";import{_ as G,c as $e,a as ae,u as ke,g as ce,t as Pe,e as Me,b as Te}from"./a-select.vue_vue_type_script_setup_true_lang.js";import{p as Ce}from"./constants.js";import{a as E}from"./tools.js";const Ie={class:"tw:flex tw:gap-6 tw:items-center"},Se=["name","value","aria-describedby","disabled"],Ae=["id","innerHTML"],De=W({__name:"a-radio-button",props:{options:{type:Array,default:()=>[{label:"",value:""}],required:!0},selectedOption:{type:[String,Number],default:"",required:!0},label:{type:String,default:""},classes:{type:String,default:""},help:{type:String,default:""},id:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["select-option"],setup(w,{emit:$}){const y=w,M=$,d=l(y.selectedOption);function p(x){const o=x.target.value;d.value=o,M("select-option",o)}const m=`tw:flex tw:flex-col tw:gap-2 ${y.classes}`;return(x,v)=>(c(),h("fieldset",{class:q([m,"tw:disabled:cursor-not-allowed"])},[a("legend",null,[b(be,null,{default:N(()=>[U(V(w.label),1)]),_:1})]),a("div",Ie,[(c(!0),h(K,null,X(w.options,o=>(c(),h("label",{key:o.value,class:"tw:flex tw:items-center tw:gap-2"},[fe(a("input",{type:"radio",name:w.id,value:o.value,"onUpdate:modelValue":v[0]||(v[0]=i=>d.value=i),onChange:v[1]||(v[1]=i=>p(i)),"aria-describedby":`${w.id}_help`,disabled:w.disabled,class:"tw:top-0.5 tw:relative"},null,40,Se),[[ye,d.value]]),U(" "+V(o.label),1)]))),128))]),w.help?(c(),h("div",{key:0,id:`${w.id}_help`,class:"tw:font-light tw:text-brand-gray-dark tw:text-sm tw:max-w-xl",innerHTML:w.help},null,8,Ae)):j("",!0)]))}}),Ee={class:"tw:flex tw:flex-col tw:gap-2"},Re={class:"tw:flex tw:gap-8 tw:items-start tw:mb-4"},Ne={class:"tw:flex tw:flex-col tw:gap-4 tw:w-1/4"},Oe=a("p",{class:"tw:font-light tw:text-brand-gray-dark tw:text-sm tw:max-w-xl"},[U(" More info "),a("a",{href:"https://www.pinecone.io/learn/vector-similarity/",class:"tw:text-blue-500 tw:hover:text-blue-700 tw:underline",target:"_blank"},"Vector Similarity Explained")],-1),je=W({__name:"ai-memory-create",emits:["createPineconIndexSuccess","createPineconIndexError"],setup(w,{emit:$}){const y=se("aiMemoryData");if(!y)throw new Error("aiMemoryData is undefined");const{ajaxActionConnectOrCreateIndex:M,ajaxUrl:d,postId:p,aiMemory:m,apiRestNonce:x}=y,v=$,o=l([]),i=l(""),k=l(m.metric),A=async()=>{try{const g=await $e(d,M,x,i.value,JSON.stringify(B.value),p);v("createPineconIndexSuccess",g.indexName),E(o,"success",`${g.message}: ${g.indexName}`)}catch(g){const u=g instanceof Error?g.message:"Error creating index";E(o,"error",u,0),v("createPineconIndexError","error")}finally{i.value=""}},B=oe(()=>({metric:k.value})),P=oe(()=>Ce.map(g=>({value:g,label:g})));function F(g){o.value=o.value.filter(u=>u.id!==g)}return(g,u)=>(c(),O(de,null,{default:N(()=>[b(pe,{class:"tw:top-2"},{default:N(()=>[(c(!0),h(K,null,X(o.value,f=>(c(),O(me,{key:f.id,type:f.type,message:f.message,time:f.time,onClose:D=>F(f.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),a("div",Ee,[a("div",Re,[b(we,{id:"index_name",label:"Index name",help:"Index name must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character.",modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=f=>i.value=f),value:i.value,onEnter:A,onInput:u[1]||(u[1]=f=>i.value=f)},null,8,["modelValue","value"]),b(G,{onClick:A,disabled:!i.value,class:"tw:relative tw:top-8"},{default:N(()=>[U("Create")]),_:1},8,["disabled"])]),a("div",Ne,[b(De,{id:"metric",label:"Metric",options:P.value,selectedOption:k.value,onSelectOption:u[2]||(u[2]=f=>k.value=f),help:"The distance metric to be used for similarity search. You can use 'euclidean', 'cosine', or 'dotproduct'."},null,8,["options","selectedOption"]),Oe])])]),_:1}))}}),Ve={class:"tw:inline-flex tw:items-center tw:justify-center tw:overflow-hidden tw:rounded-full"},Be={class:"tw:w-20 tw:h-20"},Ue=a("circle",{class:"tw:text-gray-200","stroke-width":"5",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40"},null,-1),Fe=["stroke-dashoffset"],ze={class:"tw:absolute tw:text-xs tw:text-blue-700"},ue=W({__name:"a-progress",props:{percent:{type:Number,default:50}},setup(w){const $=2*Math.PI*30;return(y,M)=>(c(),h("div",Ve,[(c(),h("svg",Be,[Ue,a("circle",{class:"tw:text-blue-500","stroke-width":"5","stroke-dasharray":$,"stroke-dashoffset":$-w.percent/100*$,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40"},null,8,Fe)])),a("span",ze,V(w.percent)+"%",1)]))}}),Le={class:"tw:grid tw:grid-cols-1 tw:@xl:grid-cols-2 tw:gap-4"},He={class:"tw:flex tw:flex-col gap-2 tw:w-full"},qe={class:"tw:grid tw:grid-cols-3 tw:gap-4"},We={class:"tw:rounded-md tw:h-72 tw:overflow-y-auto tw:border tw:border-gray-300 tw:shadow"},Ye={id:"select-posts"},Je={class:"tw:px-2 tw:py-1 tw:font-bold"},Ke=["onClick","innerHTML"],Xe={class:"tw:rounded-md tw:h-72 tw:overflow-y-auto tw:border tw:border-gray-300 tw:shadow"},Ge={id:"selected-posts"},Qe=["innerHTML"],Ze=["onClick"],et=a("span",{class:"tw:relative tw:w-8 tw:bottom-0.5"},"-",-1),tt=[et],at=W({__name:"a-relationship",props:{selectedPostsDefault:{type:Array,default:()=>[]},restUrl:String,postTypes:{type:Array,default:()=>[]},apiRestNonce:String},emits:["add-posts","remove-post","remove-all-posts"],setup(w,{emit:$}){const y=w,M=$,d=l(""),p=l("posts"),m=l(""),x=l(""),v=l([]),o=l([]),i=l(y.selectedPostsDefault),k=l(1),A=l([]),B=l([]),P=l(!1),F=l(null),g={category:{label:"Categories",value:"category",termsByTaxonomy:"categories"},post_tag:{label:"Tags",value:"post_tag",termsByTaxonomy:"tags"},product_brand:{label:"Brands",value:"product_brand",termsByTaxonomy:"product_brand"},product_cat:{label:"Product categories",value:"product_cat",termsByTaxonomy:"product_cat"},product_tag:{label:"Product tags",value:"product_tag",termsByTaxonomy:"product_tag"}};function u(s){return s.map(e=>({label:e.name+` (${e.count})`,value:e.slug}))}function f(s){return s.map(e=>({label:g[e].label,value:g[e].value}))}let D=null;function z(s,e,C){if(C.shiftKey&&D!==null){const n=Math.min(D,e),I=Math.max(D,e);for(let S=n;S<=I;S++){const t=v.value[S];!Y(t)&&!H(t)&&o.value.push(t)}}else{if(Y(s)||H(s))return;o.value.push(s),D=e}}function L(s){i.value=i.value.filter(e=>e.id!==s.id),M("remove-post",{id:s.id})}function Y(s){return i.value.find(e=>e.id===s.id)}function H(s){return o.value.find(e=>e.id===s.id)}function _(s){return i.value.find(e=>e.id===s.id)?"tw:text-gray-400 tw:cursor-default":o.value.find(e=>e.id===s.id)?"tw:cursor-default tw:bg-blue-400 tw:text-white tw:font-normal":"tw:cursor-pointer tw:text-gray-700 tw:hover:bg-blue-400 tw:hover:text-white tw:font-normal"}async function T({type:s="posts",perPage:e=10,page:C=1,taxonomy:n="",term:I="",search:S=""}){P.value=!0;let t=`${y.restUrl}${s}?page=${C}&per_page=${e}&search=${S}`;n&&I&&(t+=`&${n}=${I}`);try{const ne=(await(await fetch(t,{headers:{"X-WP-Nonce":y.apiRestNonce}})).json()).map(le=>({id:le.id,title:le.title.rendered}));v.value=[...v.value,...ne],k.value++}catch(r){console.error(r)}finally{P.value=!1}}async function Z(s){const e=g[s].termsByTaxonomy;let C=[],n=[],I=1;do try{n=await(await fetch(`${y.restUrl}${e}?per_page=100&page=${I}`)).json(),C=[...C,...n],I++}catch(S){return console.error(S),[]}while(n.length>0);return C}function Q(s){return s==="product"?["product_cat","product_tag","product_brand"]:s==="posts"?["category","post_tag"]:[]}function ee(){i.value=[...i.value,...o.value],M("add-posts",o.value),o.value=[]}return re(()=>{T({}),A.value=Q(p.value)}),re(()=>{const s=new IntersectionObserver(e=>{e[0].isIntersecting&&!P.value&&T({type:p.value,perPage:12,page:k.value,taxonomy:m.value,term:x.value})});F.value&&s.observe(F.value)}),J([d,p,m,x],()=>{v.value=[],k.value=1,T({type:p.value,perPage:12,page:k.value,taxonomy:m.value,term:x.value,search:d.value})}),J(m,async()=>{m.value&&(B.value=[],B.value=await Z(m.value))}),J(p,()=>{p.value&&(x.value="",m.value="",A.value=[],A.value=Q(p.value))}),(s,e)=>{var C;return c(),h("div",Le,[a("label",He,[b(we,{label:"Search",type:"text",onInput:e[0]||(e[0]=n=>d.value=n)})]),a("div",qe,[b(ae,{id:"post-type",options:y.postTypes,label:"Post type",selectedOption:p.value,onSelectOption:e[1]||(e[1]=n=>p.value=n),disabled:p.value===""||w.postTypes.length===0},null,8,["options","selectedOption","disabled"]),b(ae,{id:"taxonomy",options:f(A.value),label:"Taxonomy",selectedOption:m.value,onSelectOption:e[2]||(e[2]=n=>m.value=n),disabled:p.value===""||A.value.length===0},null,8,["options","selectedOption","disabled"]),b(ae,{id:"term",options:u(B.value),label:"Term",selectedOption:x.value,onSelectOption:e[3]||(e[3]=n=>x.value=n),disabled:m.value===""||B.value.length===0},null,8,["options","selectedOption","disabled"])]),a("div",We,[a("ul",Ye,[a("li",null,[a("span",Je,V((C=w.postTypes.find(n=>n.value===p.value))==null?void 0:C.label),1),a("ul",null,[(c(!0),h(K,null,X(v.value,(n,I)=>(c(),h("li",{key:n.id,onClick:S=>z(n,I,S),onMousedown:e[4]||(e[4]=ge(()=>{},["prevent"])),class:q(["tw:pl-6 tw:pr-2 tw:py-1 tw:m-0!",_(n)]),innerHTML:n.title},null,42,Ke))),128)),a("li",{ref_key:"sentinel",ref:F},null,512)])])])]),a("div",Xe,[a("ul",Ge,[(c(!0),h(K,null,X(i.value,n=>(c(),h("li",{key:n.id,class:"tw:px-2 tw:min-h-7 tw:py-1 tw:m-0! tw:flex tw:justify-between tw:items-center tw:hover:bg-blue-400 tw:hover:text-white tw:group"},[a("span",{innerHTML:n.title},null,8,Qe),a("button",{onClick:I=>L(n),class:"tw:hidden tw:group-hover:flex tw:w-5 tw:h-5 tw:justify-center tw:items-center tw:rounded-full tw:bg-gray-700 tw:text-white tw:hover:bg-red-600"},tt,8,Ze)]))),128))])]),a("div",null,[b(G,{onClick:ee,disabled:o.value.length===0},{default:N(()=>[U("Add selected posts ("+V(o.value.length)+")",1)]),_:1},8,["disabled"])]),a("div",null,[b(G,{onClick:e[5]||(e[5]=()=>{i.value=[],M("remove-all-posts")}),disabled:i.value.length===0},{default:N(()=>[U("Clean all selected posts ("+V(i.value.length)+")",1)]),_:1},8,["disabled"])])])}}}),st=a("p",{class:"tw:text-lg! tw:m-0!"}," Search and Add WordPress posts to train this memory. ",-1),nt={class:"tw:flex tw:flex-col tw:gap-4"},lt=a("p",{class:"tw:text-lg! tw:m-0!"},"Create content from PDFs",-1),ot={class:"tw:flex tw:gap-2 tw:flex-wrap tw:max-w-[40rem]"},rt={class:"tw:flex tw:grow tw:font-semibold"},it=a("div",{class:"tw:w-36 tw:bg-gray-500 tw:text-white tw:text-center tw:py-3 tw:rounded-l-lg tw:text-sm tw:transition-all tw:duration-300 tw:shadow-button tw:no-underline tw:cursor-pointer tw:hover:bg-gray-600"}," Choose a file: ",-1),ct={class:"tw:w-full tw:border tw:border-gray-500 tw:bg-white tw:rounded-r-lg"},ut={class:"tw:flex tw:items-center tw:h-full tw:pl-4"},dt={class:"tw:text-lg! tw:m-0! tw:font-normal"},mt={class:"tw:flex tw:items-center tw:justify-end tw:gap-4"},pt={key:0,class:"tw:text-lg! tw:m-0!"},wt={key:1,class:"tw:text-lg! tw:m-0!"},vt=W({__name:"ai-memory-train",props:{indexMemory:String},emits:["upsertedVectorSuccess"],setup(w,{emit:$}){const y=se("aiMemoryData");if(!y)throw new Error("aiMemoryData is undefined");const{restUrl:M,ajaxUrl:d,ajaxActionTokenizePosts:p,ajaxActionEmbedData:m,ajaxActionEmbeddingPercentage:x,ajaxActionTokenizingPercentage:v,ajaxUpsertVector:o,ajaxActionUploadFile:i,postId:k,addedPosts:A,postTypes:B,apiRestNonce:P}=y,F=w,g=$,u=l(Array.isArray(A)?A:[]),f=l(!1),D=l(!1),z=l(0),L=l(0),Y=l(""),H=l(null),_=l([]),T=l("");async function Z(){if(u.value.length!==0){f.value=!0,L.value=0;try{T.value="tokenizing posts...";const t=await Pe(d,p,P,k,u.value);E(_,"success",t.message,0),f.value=!1}catch(t){const r=t instanceof Error?t.message:"Error embedding data";E(_,"error",r,0),f.value=!1}}}async function Q(){D.value=!0,z.value=0;try{T.value="embedding data...";const t=await Me(d,m,P,k);E(_,"success",t.message,0),D.value=!1}catch(t){const r=t instanceof Error?t.message:"Error embedding data";E(_,"error",r,0),D.value=!1}}async function ee(){try{T.value="upserting vectors to the database...";const t=await Te(d,o,P,F.indexMemory,k);E(_,"success",t.message,0),g("upsertedVectorSuccess","trained"),T.value="memory trained"}catch(t){const r=t instanceof Error?t.message:"Error embedding data";E(_,"error",r,0)}}async function s(){_.value=[],await Z(),await Q(),await ee()}function e(t){const r=t.target;Y.value=r.value.split("\\").pop()||"",r.files&&(H.value=r.files[0])}async function C(){if(!H.value){E(_,"warning","no file selected",0);return}try{const t=await ke(d,i,P,H.value);E(_,"success",t.message,0)}catch(t){const r=t instanceof Error?t.message:"Error embedding data";E(_,"error",r,0)}}function n(t){u.value=[...u.value,...t]}function I(t){u.value=u.value.filter(r=>r.id!==t.id)}function S(t){_.value=_.value.filter(r=>r.id!==t)}return J(()=>f.value,t=>{if(!t)return;const r=setInterval(async()=>{if(L.value===100){f.value=!1,clearInterval(r);return}try{const R=await ce(d,v,P,k);L.value=parseInt(R.progress)}catch{clearInterval(r);return}},1e3)}),J(()=>D.value,t=>{if(!t)return;const r=setInterval(async()=>{if(z.value===100){D.value=!1,clearInterval(r);return}try{const R=await ce(d,x,P,k);z.value=parseInt(R.progress)}catch{clearInterval(r);return}},1e3)}),(t,r)=>(c(),O(de,null,{default:N(()=>[b(pe,{class:"tw:top-2"},{default:N(()=>[(c(!0),h(K,null,X(_.value,R=>(c(),O(me,{key:R.id,type:R.type,message:R.message,time:R.time,onClose:ne=>S(R.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),st,a("div",nt,[lt,a("div",ot,[a("label",rt,[it,a("div",ct,[a("div",ut,V(Y.value),1)]),a("input",{class:"tw:hidden",id:"from_pdf",name:"file",type:"file",onChange:e},null,32)]),b(G,{onClick:C},{default:N(()=>[U("Upload")]),_:1})])]),b(at,{onAddPosts:n,onRemovePost:I,onRemoveAllPosts:r[0]||(r[0]=()=>u.value=[]),selectedPostsDefault:u.value,restUrl:te(M),postTypes:te(B),apiRestNonce:te(P)},null,8,["selectedPostsDefault","restUrl","postTypes","apiRestNonce"]),a("p",dt," You have selected "+V(u.value.length===1?"1 post.":`${u.value.length} posts.`),1),a("div",mt,[T.value!=="memory trained"?(c(),h("p",pt," It takes some time, be patient ")):j("",!0),u.value.length!==0?(c(),h("p",wt,V(T.value),1)):j("",!0),T.value==="tokenizing posts..."?(c(),O(ue,{key:2,percent:L.value},null,8,["percent"])):j("",!0),T.value==="embedding data..."?(c(),O(ue,{key:3,percent:z.value},null,8,["percent"])):j("",!0),b(G,{onClick:s,disabled:u.value.length===0},{default:N(()=>[U("Start training memory")]),_:1},8,["disabled"])])]),_:1}))}}),ft={class:"tw:font-arboria"},yt=W({__name:"ai-memory",setup(w){const $=se("aiMemoryData");if(!$)throw new Error("aiMemoryData is undefined");const{indexName:y,indexStatus:M}=$,d=l(y!=="undefined"?y:""),p=l(M),m=l(!1);function x(v){setTimeout(()=>{d.value=v,p.value="connected"},3e3),setTimeout(()=>{m.value=!0},2500),setTimeout(()=>{m.value=!1},3e3)}return(v,o)=>(c(),h("div",ft,[d.value?j("",!0):(c(),O(ie,{key:0,class:q(["tw:transition tw:duration-500",m.value?"tw:opacity-0":"tw:opacity-100"]),title:"Create Pinecone Index",hasAdvanced:!1},null,8,["class"])),d.value?(c(),O(ie,{key:1,class:q(["tw:transition tw:duration-500",m.value?"tw:opacity-0":"tw:opacity-100"]),title:d.value,status:p.value},null,8,["class","title","status"])):j("",!0),d.value?j("",!0):(c(),O(je,{key:2,class:q(["tw:transition tw:duration-500",m.value?"tw:opacity-0":"tw:opacity-100"]),onCreatePineconIndexSuccess:x},null,8,["class"])),d.value?(c(),O(vt,{key:3,class:q(["tw:transition tw:duration-500",m.value?"tw:opacity-0":"tw:opacity-100"]),indexMemory:d.value,onUpsertedVectorSuccess:o[0]||(o[0]=i=>p.value=i)},null,8,["class","indexMemory"])):j("",!0)]))}});let ve={};ve=window.ai_memory.data;const gt=he({setup(){_e("aiMemoryData",ve)},render:()=>xe(yt)});gt.mount("#main_ai_memory");
