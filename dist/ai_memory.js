import{d as K,r as n,o as i,c as x,a as t,b,w as j,e as F,t as B,F as Z,f as ee,g as he,v as xe,h as V,n as J,i as ie,j as ce,k as U,l as ue,m as X,p as _e,u as be,q as $e,s as Pe,x as ke}from"./wug-style.js";import{m as pe,_ as de}from"./metabox-body.js";import{a as Me,_ as ve,b as fe,c as ye}from"./a-text.vue_vue_type_script_setup_true_lang.js";import{_ as te,c as Ce,a as re,u as Ie,g as we,t as Te,e as Se,b as Ae}from"./a-select.vue_vue_type_script_setup_true_lang.js";import{p as De}from"./constants.js";import{a as T,e as Q}from"./tools.js";const Oe={class:"tw:flex tw:gap-6 tw:items-center"},je=["name","value","aria-describedby","disabled"],Ue=["id","innerHTML"],Ve=K({__name:"a-radio-button",props:{options:{type:Array,default:()=>[{label:"",value:""}],required:!0},selectedOption:{type:[String,Number],default:"",required:!0},label:{type:String,default:""},classes:{type:String,default:""},help:{type:String,default:""},id:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["select-option"],setup(v,{emit:$}){const f=v,M=$,u=n(f.selectedOption);function w(_){const l=_.target.value;u.value=l,M("select-option",l)}const d=`tw:flex tw:flex-col tw:gap-2 ${f.classes}`;return(_,p)=>(i(),x("fieldset",{class:J([d,"tw:disabled:cursor-not-allowed"])},[t("legend",null,[b(Me,null,{default:j(()=>[F(B(v.label),1)]),_:1})]),t("div",Oe,[(i(!0),x(Z,null,ee(v.options,l=>(i(),x("label",{key:l.value,class:"tw:flex tw:items-center tw:gap-2"},[he(t("input",{type:"radio",name:v.id,value:l.value,"onUpdate:modelValue":p[0]||(p[0]=r=>u.value=r),onChange:p[1]||(p[1]=r=>w(r)),"aria-describedby":`${v.id}_help`,disabled:v.disabled,class:"tw:top-0.5 tw:relative"},null,40,je),[[xe,u.value]]),F(" "+B(l.label),1)]))),128))]),v.help?(i(),x("div",{key:0,id:`${v.id}_help`,class:"tw:font-light tw:text-brand-gray-dark tw:text-sm tw:max-w-xl",innerHTML:v.help},null,8,Ue)):V("",!0)]))}}),Be={class:"tw:flex tw:flex-col tw:gap-2"},Re={class:"tw:flex tw:gap-8 tw:items-start tw:mb-4"},Ee={class:"tw:flex tw:flex-col tw:gap-4 tw:w-1/4"},Ne=t("p",{class:"tw:font-light tw:text-brand-gray-dark tw:text-sm tw:max-w-xl"},[F(" More info "),t("a",{href:"https://www.pinecone.io/learn/vector-similarity/",class:"tw:text-blue-500 tw:hover:text-blue-700 tw:underline",target:"_blank"},"Vector Similarity Explained")],-1),Fe=K({__name:"ai-memory-create",emits:["createPineconIndexSuccess","createPineconIndexError"],setup(v,{emit:$}){const f=ie("aiMemoryData");if(!f)throw new Error("aiMemoryData is undefined");const{ajaxActionConnectOrCreateIndex:M,ajaxUrl:u,nonceConnectOrCreateIndex:w,postId:d,aiMemory:_}=f,p=$,l=n([]),r=n(""),S=n(_.metric),A=async()=>{try{const g=await Ce(u,M,w,r.value,JSON.stringify(R.value),d);p("createPineconIndexSuccess",g.indexName),T(l,"success",`${g.message}: ${g.indexName}`)}catch(g){const m=Q(g);T(l,"error",m,0),p("createPineconIndexError","error")}finally{r.value=""}},R=ce(()=>({metric:S.value})),z=ce(()=>De.map(g=>({value:g,label:g})));function L(g){l.value=l.value.filter(m=>m.id!==g)}return(g,m)=>(i(),U(pe,null,{default:j(()=>[b(fe,{class:"tw:top-2"},{default:j(()=>[(i(!0),x(Z,null,ee(l.value,h=>(i(),U(ve,{key:h.id,type:h.type,message:h.message,time:h.time,onClose:ae=>L(h.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),t("div",Be,[t("div",Re,[b(ye,{id:"index_name",label:"Index name",help:"Index name must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character.",modelValue:r.value,"onUpdate:modelValue":m[0]||(m[0]=h=>r.value=h),value:r.value,onEnter:A,onInput:m[1]||(m[1]=h=>r.value=h)},null,8,["modelValue","value"]),b(te,{onClick:A,disabled:!r.value,class:"tw:relative tw:top-8"},{default:j(()=>[F("Create")]),_:1},8,["disabled"])]),t("div",Ee,[b(Ve,{id:"metric",label:"Metric",options:z.value,selectedOption:S.value,onSelectOption:m[2]||(m[2]=h=>S.value=h),help:"The distance metric to be used for similarity search. You can use 'euclidean', 'cosine', or 'dotproduct'."},null,8,["options","selectedOption"]),Ne])])]),_:1}))}}),ze={class:"tw:inline-flex tw:items-center tw:justify-center tw:overflow-hidden tw:rounded-full"},Le={class:"tw:w-20 tw:h-20"},He=t("circle",{class:"tw:text-gray-200","stroke-width":"5",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40"},null,-1),qe=["stroke-dashoffset"],We={class:"tw:absolute tw:text-xs tw:text-blue-700"},me=K({__name:"a-progress",props:{percent:{type:Number,default:50}},setup(v){const $=2*Math.PI*30;return(f,M)=>(i(),x("div",ze,[(i(),x("svg",Le,[He,t("circle",{class:"tw:text-blue-500","stroke-width":"5","stroke-dasharray":$,"stroke-dashoffset":$-v.percent/100*$,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40"},null,8,qe)])),t("span",We,B(v.percent)+"%",1)]))}}),Ye={class:"tw:grid tw:grid-cols-1 tw:@xl:grid-cols-2 tw:gap-4"},Ge={class:"tw:flex tw:flex-col gap-2 tw:w-full"},Je={class:"tw:grid tw:grid-cols-3 tw:gap-4"},Ke={class:"tw:rounded-md tw:h-72 tw:overflow-y-auto tw:border tw:border-gray-300 tw:shadow"},Qe={id:"select-posts"},Xe={class:"tw:px-2 tw:py-1 tw:font-bold"},Ze=["onClick","innerHTML"],et={class:"tw:rounded-md tw:h-72 tw:overflow-y-auto tw:border tw:border-gray-300 tw:shadow"},tt={id:"selected-posts"},at=["innerHTML"],st=["onClick"],nt=t("div",{class:"tw:relative tw:w-8 tw:bottom-0.5"},"-",-1),lt=[nt],ot=K({__name:"a-relationship",props:{selectedPostsDefault:{type:Array,default:()=>[]},restUrl:String},emits:["add-posts","remove-post","remove-all-posts"],setup(v,{emit:$}){const f=v,M=$,u=n(""),w=n("post"),d=n(""),_=n(""),p=n([]),l=n([]),r=n(f.selectedPostsDefault),S=n(1),A=n([]),R=n([]),z=n(!1),L=n(null),g=[{value:"post",label:"Posts"},{value:"page",label:"Pages"},{value:"product",label:"Products"}],m={category:{label:"Categories",value:"category",termsByTaxonomy:"categories"},post_tag:{label:"Tags",value:"post_tag",termsByTaxonomy:"tags"},product_brand:{label:"Brands",value:"product_brand",termsByTaxonomy:"product_brand"},product_cat:{label:"Product categories",value:"product_cat",termsByTaxonomy:"product_cat"},product_tag:{label:"Product tags",value:"product_tag",termsByTaxonomy:"product_tag"}};function h(a){return a.map(e=>({label:e.name+` (${e.count})`,value:e.slug}))}function ae(a){return a.map(e=>({label:m[e].label,value:m[e].value}))}let W=null;function P(a,e,o){if(o.shiftKey&&W!==null){const k=Math.min(W,e),C=Math.max(W,e);for(let O=k;O<=C;O++){const N=p.value[O];!E(N)&&!q(N)&&l.value.push(N)}}else{if(E(a)||q(a))return;l.value.push(a),W=e}}function H(a){r.value=r.value.filter(e=>e.id!==a.id),M("remove-post",{id:a.id})}function E(a){return r.value.find(e=>e.id===a.id)}function q(a){return l.value.find(e=>e.id===a.id)}function Y(a){return r.value.find(e=>e.id===a.id)?"tw:text-gray-400 tw:cursor-default":l.value.find(e=>e.id===a.id)?"tw:cursor-default tw:bg-blue-400 tw:text-white tw:font-normal":"tw:cursor-pointer tw:text-gray-700 tw:hover:bg-blue-400 tw:hover:text-white tw:font-normal"}function se(a){return a==="product"?"Products":a==="pages"?"Pages":"Posts"}function G(a){return a==="product"?"product":a==="page"?"pages":"posts"}async function y({type:a="posts",perPage:e=10,page:o=1,taxonomy:k="",term:C="",search:O=""}){z.value=!0;let N=`${f.restUrl}${a}?page=${o}&per_page=${e}&search=${O}`;k&&C&&(N+=`&${k}=${C}`);try{const I=(await(await fetch(N)).json()).map(oe=>({id:oe.id,title:oe.title.rendered}));p.value=[...p.value,...I],S.value++}catch(s){console.error(s)}finally{z.value=!1}}async function D(a){const e=m[a].termsByTaxonomy;let o=[],k=[],C=1;do try{k=await(await fetch(`${f.restUrl}${e}?per_page=100&page=${C}`)).json(),o=[...o,...k],C++}catch(O){return console.error(O),[]}while(k.length>0);return o}async function ne(a){try{return(await(await fetch(`${f.restUrl}types/${a}`)).json()).taxonomies}catch(e){return console.error(e),[]}}function le(){r.value=[...r.value,...l.value],M("add-posts",l.value),l.value=[]}return ue(async()=>{y({}),A.value=await ne(w.value)}),ue(()=>{const a=new IntersectionObserver(e=>{e[0].isIntersecting&&!z.value&&y({type:G(w.value),perPage:10,page:S.value,taxonomy:d.value,term:_.value})});L.value&&a.observe(L.value)}),X([u,w,d,_],()=>{p.value=[],S.value=1,y({type:G(w.value),perPage:10,page:S.value,taxonomy:d.value,term:_.value,search:u.value})}),X(d,async()=>{d.value&&(R.value=[],R.value=await D(d.value))}),X(w,async()=>{w.value&&(_.value="",d.value="",A.value=[],A.value=await ne(w.value))}),(a,e)=>(i(),x("div",Ye,[t("label",Ge,[b(ye,{label:"Search",type:"text",onInput:e[0]||(e[0]=o=>u.value=o)})]),t("div",Je,[b(re,{id:"post-type",options:g,label:"Post type",selectedOption:w.value,onSelectOption:e[1]||(e[1]=o=>w.value=o),disabled:w.value===""||g.length===0},null,8,["selectedOption","disabled"]),b(re,{id:"taxonomy",options:ae(A.value),label:"Taxonomy",selectedOption:d.value,onSelectOption:e[2]||(e[2]=o=>d.value=o),disabled:w.value===""||A.value.length===0},null,8,["options","selectedOption","disabled"]),b(re,{id:"term",options:h(R.value),label:"Term",selectedOption:_.value,onSelectOption:e[3]||(e[3]=o=>_.value=o),disabled:d.value===""||R.value.length===0},null,8,["options","selectedOption","disabled"])]),t("div",Ke,[t("ul",Qe,[t("li",null,[t("div",Xe,B(se(w.value)),1),t("ul",null,[(i(!0),x(Z,null,ee(p.value,(o,k)=>(i(),x("li",{key:o.id,onClick:C=>P(o,k,C),onMousedown:e[4]||(e[4]=_e(()=>{},["prevent"])),class:J(["tw:pl-6 tw:pr-2 tw:py-1 tw:m-0",Y(o)]),innerHTML:o.title},null,42,Ze))),128)),t("li",{ref_key:"sentinel",ref:L,class:"sentinel"},null,512)])])])]),t("div",et,[t("ul",tt,[(i(!0),x(Z,null,ee(r.value,o=>(i(),x("li",{key:o.id,class:"tw:px-2 tw:py-1 tw:m-0 tw:flex tw:justify-between tw:items-start tw:hover:bg-blue-400 tw:hover:text-white tw:group"},[t("div",{innerHTML:o.title},null,8,at),t("button",{onClick:k=>H(o),class:"tw:hidden tw:group-hover:flex tw:w-5 tw:h-5 tw:justify-center tw:items-center tw:rounded-full tw:bg-gray-700 tw:text-white tw:hover:bg-red-600"},lt,8,st)]))),128))])]),t("div",null,[b(te,{onClick:le,disabled:l.value.length===0},{default:j(()=>[F("Add selected posts ("+B(l.value.length)+")",1)]),_:1},8,["disabled"])]),t("div",null,[b(te,{onClick:e[5]||(e[5]=()=>{r.value=[],M("remove-all-posts")}),disabled:r.value.length===0},{default:j(()=>[F("Clean all selected posts ("+B(r.value.length)+")",1)]),_:1},8,["disabled"])])]))}}),rt=t("p",{class:"tw:text-lg! tw:m-0!"}," Search and Add WordPress posts to train this memory. ",-1),it={class:"tw:flex tw:flex-col tw:gap-4"},ct=t("p",{class:"tw:text-lg! tw:m-0!"},"Create content from PDFs",-1),ut={class:"tw:flex tw:gap-2 tw:flex-wrap tw:max-w-[40rem]"},dt={class:"tw:flex tw:grow tw:font-semibold"},wt=t("div",{class:"tw:w-36 tw:bg-gray-500 tw:text-white tw:text-center tw:py-3 tw:rounded-l-lg tw:text-sm tw:transition-all tw:duration-300 tw:shadow-button tw:no-underline tw:cursor-pointer tw:hover:bg-gray-600"}," Choose a file: ",-1),mt={class:"tw:w-full tw:border tw:border-gray-500 tw:bg-white tw:rounded-r-lg"},pt={class:"tw:flex tw:items-center tw:h-full tw:pl-4"},vt={class:"tw:text-lg! tw:m-0! tw:font-normal"},ft={class:"tw:flex tw:items-center tw:justify-end tw:gap-4"},yt={key:0,class:"tw:text-lg! tw:m-0!"},gt={key:1,class:"tw:text-lg! tw:m-0!"},ht=K({__name:"ai-memory-train",props:{indexMemory:String},emits:["upsertedVectorSuccess"],setup(v,{emit:$}){const f=ie("aiMemoryData");if(!f)throw new Error("aiMemoryData is undefined");const{restUrl:M,ajaxUrl:u,ajaxActionTokenizePosts:w,ajaxActionEmbedData:d,ajaxActionEmbeddingPercentage:_,ajaxActionTokenizingPercentage:p,ajaxUpsertVector:l,ajaxActionUploadFile:r,nonceTokenizePosts:S,nonceEmbedData:A,nonceEmbeddingPercentage:R,nonceTokenizingPercentage:z,nonceUpsertVector:L,nonceUploadFile:g,postId:m,addedPosts:h}=f,ae=v,W=$,P=n(Array.isArray(h)?h:[]),H=n(!1),E=n(!1),q=n(0),Y=n(0),se=n(""),G=n(null),y=n([]),D=n("");async function ne(){if(P.value.length!==0){H.value=!0,Y.value=0;try{D.value="tokenizing posts...";const s=await Te(u,w,S,m,P.value);T(y,"success",s.message,0),H.value=!1}catch(s){const c=Q(s);T(y,"error",c,0),H.value=!1}}}async function le(){E.value=!0,q.value=0;try{D.value="embedding data...";const s=await Se(u,d,A,m);T(y,"success",s.message,0),E.value=!1}catch(s){const c=Q(s);T(y,"error",c,0),E.value=!1}}async function a(){try{D.value="upserting vectors to the database...";const s=await Ae(u,l,L,ae.indexMemory,m);T(y,"success",s.message,0),W("upsertedVectorSuccess","trained"),D.value="memory trained"}catch(s){const c=Q(s);T(y,"error",c,0)}}async function e(){y.value=[],await ne(),await le(),await a()}function o(s){const c=s.target;se.value=c.value.split("\\").pop()||"",c.files&&(G.value=c.files[0])}async function k(){if(!G.value){T(y,"warning","no file selected",0);return}try{const s=await Ie(u,r,g,G.value);T(y,"success",s.message,0)}catch(s){const c=Q(s);T(y,"error",c,0)}}function C(s){P.value=[...P.value,...s]}function O(s){P.value=P.value.filter(c=>c.id!==s.id)}function N(s){y.value=y.value.filter(c=>c.id!==s)}return X(()=>H.value,s=>{if(!s)return;const c=setInterval(async()=>{if(Y.value===100){H.value=!1,clearInterval(c);return}try{const I=await we(u,p,z,m);Y.value=parseInt(I.progress)}catch{clearInterval(c);return}},1e3)}),X(()=>E.value,s=>{if(!s)return;const c=setInterval(async()=>{if(q.value===100){E.value=!1,clearInterval(c);return}try{const I=await we(u,_,R,m);q.value=parseInt(I.progress)}catch{clearInterval(c);return}},1e3)}),(s,c)=>(i(),U(pe,null,{default:j(()=>[b(fe,{class:"tw:top-2"},{default:j(()=>[(i(!0),x(Z,null,ee(y.value,I=>(i(),U(ve,{key:I.id,type:I.type,message:I.message,time:I.time,onClose:oe=>N(I.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),rt,t("div",it,[ct,t("div",ut,[t("label",dt,[wt,t("div",mt,[t("div",pt,B(se.value),1)]),t("input",{class:"tw:hidden",id:"from_pdf",name:"file",type:"file",onChange:o},null,32)]),b(te,{onClick:k},{default:j(()=>[F("Upload")]),_:1})])]),b(ot,{onAddPosts:C,onRemovePost:O,onRemoveAllPosts:c[0]||(c[0]=()=>P.value=[]),selectedPostsDefault:P.value,restUrl:be(M)},null,8,["selectedPostsDefault","restUrl"]),t("p",vt," You have selected "+B(P.value.length===1?"1 post.":`${P.value.length} posts.`),1),t("div",ft,[D.value!=="memory trained"?(i(),x("p",yt," It takes some time, be patient ")):V("",!0),P.value.length!==0?(i(),x("p",gt,B(D.value),1)):V("",!0),D.value==="tokenizing posts..."?(i(),U(me,{key:2,percent:Y.value},null,8,["percent"])):V("",!0),D.value==="embedding data..."?(i(),U(me,{key:3,percent:q.value},null,8,["percent"])):V("",!0),b(te,{onClick:e,disabled:P.value.length===0},{default:j(()=>[F("Start training memory")]),_:1},8,["disabled"])])]),_:1}))}}),xt={class:"tw:font-arboria"},_t=K({__name:"ai-memory",setup(v){const $=ie("aiMemoryData");if(!$)throw new Error("aiMemoryData is undefined");const{indexName:f,indexStatus:M}=$,u=n(f!=="undefined"?f:""),w=n(M),d=n(!1);function _(p){setTimeout(()=>{u.value=p,w.value="connected"},3e3),setTimeout(()=>{d.value=!0},2500),setTimeout(()=>{d.value=!1},3e3)}return(p,l)=>(i(),x("div",xt,[u.value?V("",!0):(i(),U(de,{key:0,class:J(["tw:transition tw:duration-500",d.value?"tw:opacity-0":"tw:opacity-100"]),title:"Create Pinecone Index",hasAdvanced:!1},null,8,["class"])),u.value?(i(),U(de,{key:1,class:J(["tw:transition tw:duration-500",d.value?"tw:opacity-0":"tw:opacity-100"]),title:u.value,status:w.value},null,8,["class","title","status"])):V("",!0),u.value?V("",!0):(i(),U(Fe,{key:2,class:J(["tw:transition tw:duration-500",d.value?"tw:opacity-0":"tw:opacity-100"]),onCreatePineconIndexSuccess:_},null,8,["class"])),u.value?(i(),U(ht,{key:3,class:J(["tw:transition tw:duration-500",d.value?"tw:opacity-0":"tw:opacity-100"]),indexMemory:u.value,onUpsertedVectorSuccess:l[0]||(l[0]=r=>w.value=r)},null,8,["class","indexMemory"])):V("",!0)]))}});let ge={};ge=window.ai_memory.data;const bt=$e({setup(){ke("aiMemoryData",ge)},render:()=>Pe(_t)});bt.mount("#main_ai_memory");
