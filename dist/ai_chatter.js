import{d as k,r as $,c as g,o as u,n as I,e as i,h as Q,b as F,w as h,f as A,t as w,y as X,a as n,F as O,g as L,p as Z,z as ee,i as z,A as P,m as te,k as E,u as f,l as ae,q as se,s as oe,x as le}from"./style.js";import{a as ie,b as ne,_ as re,c as M}from"./a-text.vue_vue_type_script_setup_true_lang.js";import{a as V,_ as de,s as me}from"./a-select.vue_vue_type_script_setup_true_lang.js";import{_ as N}from"./a-checkbox.vue_vue_type_script_setup_true_lang.js";import{_ as K}from"./a-switch.vue_vue_type_script_setup_true_lang.js";import{_ as S}from"./a-textarea.vue_vue_type_script_setup_true_lang.js";import{m as T,_ as ue}from"./metabox-body.js";import{v as j,a as x}from"./tools.js";const pe=["id","name","disabled","aria-errormessage"],ce=["value"],ge=["id"],fe=["id"],G=k({__name:"a-select-multi",props:{options:{default:()=>[{label:"",value:""}]},selectedOptions:{default:()=>[]},label:{default:""},id:{default:""},help:{default:""},disabled:{type:Boolean,default:!1},atLeastOne:{type:Boolean,default:!1}},emits:["selected-options"],setup(y,{emit:v}){const p=v,m=$(y.selectedOptions),c=$(""),l=r=>{const o=r.target,a=Array.from(o.selectedOptions);y.atLeastOne&&a.length===0?c.value="Please select at least one option":c.value="",m.value=a.map(b=>parseInt(b.value)),p("selected-options",m.value)};return(r,o)=>(u(),g("label",{class:I(["flex flex-col gap-2 text-sm relative pb-6",{"opacity-50 cursor-not-allowed":r.disabled}])},[i(ie,null,{default:h(()=>[A(w(r.label),1)]),_:1}),Q(n("select",{id:r.id,name:r.id,class:"leading-normal! w-full border border-gray-300! rounded-md! p-2! shadow! disabled:border-gray-200 disabled:cursor-not-allowed","onUpdate:modelValue":o[0]||(o[0]=a=>m.value=a),multiple:"",disabled:r.disabled,onChange:l,"aria-errormessage":`${r.id}_error`},[(u(!0),g(O,null,L(r.options,a=>(u(),g("option",{key:a.value,value:a.value},w(a.label),9,ce))),128))],40,pe),[[X,m.value]]),r.help?(u(),g("div",{key:0,id:`${r.id}_help`,class:"font-light text-brand-gray-dark text-sm max-w-xl"},w(r.help),9,ge)):F("",!0),c.value?(u(),g("div",{key:1,id:`${r.id}_error`,class:"text-red-500 font-medium text-sm absolute bottom-0"},w(c.value),9,fe)):F("",!0)],2))}}),be={class:"relative group"},he=["disabled"],ve={key:0,class:"relative -top-px uppercase"},Ce=["id","name","value"],we={class:"absolute z-10 p-2 text-xs bg-gray-100 border border-gray-100 rounded-md w-32 bottom-10 text-black hidden group-hover:block!"},D=k({__name:"a-tooltip",props:{id:{},value:{type:Boolean,default:!1},symbol:{},disabled:{type:Boolean,default:!1}},emits:["activateTooltip"],setup(y,{emit:v}){const p=v,m=$(y.value),c=()=>{m.value=!m.value,p("activateTooltip",m.value)};return(l,r)=>(u(),g("div",be,[n("button",{class:I(["cursor-pointer flex justify-center items-center text-xl h-8 w-8 rounded-full text-white transition-all duration-300 disabled:cursor-not-allowed disabled:opacity-30",{"bg-green-500":m.value,"bg-gray-500":!m.value}]),onClick:Z(c,["prevent"]),disabled:l.disabled},[l.symbol?(u(),g("span",ve,w(l.symbol),1)):F("",!0),n("input",{type:"hidden",id:l.id,name:l.id,value:m.value,onInput:c},null,40,Ce)],10,he),n("div",we,[ee(l.$slots,"default")])]))}}),ye={class:"grid grid-cols-3 flex-col gap-2 max-w-xs items-center"},xe={class:"flex flex-col gap-4"},Ae=k({__name:"contact-form",emits:["contact-form"],setup(y,{emit:v}){const p=z("aiChatterData");if(!p)throw new Error("aiChatterData is undefined");const m=v;function c(r,o,a,b){l.formFields=[...l.formFields.map(_=>_.label===r?{label:r,type:o,active:a,required:b}:_)]}const l=P({formFields:p.aiChat.formFields,showContactForm:p.aiChat.showContactForm,allowAiContactCampaigns:p.aiChat.allowAiContactCampaigns,aiContactCampaigns:p.aiChat.aiContactCampaigns,afterFormMessageSuccess:p.aiChat.afterFormMessageSuccess,afterFormMessageError:p.aiChat.afterFormMessageError});return te(l,r=>m("contact-form",r)),(r,o)=>(u(),g("section",null,[n("header",{class:I(["bg-white p-6 border rounded-t-xl border-gray-200",{"rounded-b-xl":!l.showContactForm}])},[i(N,{id:"show-contact-form",label:"Show contact form",value:l.showContactForm,onChange:o[0]||(o[0]=a=>l.showContactForm=a),help:"If checked, after the limit message will be shown a contact form"},null,8,["value"])],2),l.showContactForm?(u(),E(T,{key:0,class:"border border-t-0 border-gray-200"},{default:h(()=>[o[10]||(o[10]=n("p",{class:"font-light text-gray-700 uppercase text-sm mb-2"},"Form Fields",-1)),n("div",ye,[o[5]||(o[5]=n("div",{class:"uppercase"},"Active",-1)),o[6]||(o[6]=n("div",{class:"uppercase"},"Mandatory",-1)),o[7]||(o[7]=n("div",{class:"uppercase"},"Field name",-1)),(u(!0),g(O,null,L(l.formFields,a=>(u(),g(O,{key:a.label},[i(K,{value:a.active,id:`active_${a.label}`,onSwitch:b=>c(a.label,a.type,b,a.required)},null,8,["value","id","onSwitch"]),i(N,{value:a.required,id:`required_${a.label}`,onChange:b=>c(a.label,a.type,a.active,b),disabled:!a.active},null,8,["value","id","onChange","disabled"]),n("div",null,w(a.label),1)],64))),128))]),n("div",xe,[i(D,{symbol:"g",id:"is_ai_contact_campaigns",onActivateTooltip:o[1]||(o[1]=a=>l.allowAiContactCampaigns=a),value:l.allowAiContactCampaigns},{default:h(()=>o[8]||(o[8]=[A(" If activated allow you to select a AI Campaigns for you contact form ")])),_:1},8,["value"]),i(G,{label:"AiContact Campaigns",id:"ai_contact_campaigns",class:"max-w-lg",options:f(p).gdprCampaigns.map(a=>({label:a.title,value:a.id.toString()})),selectedOptions:l.aiContactCampaigns,disabled:!l.allowAiContactCampaigns,onSelectedOptions:o[2]||(o[2]=a=>l.aiContactCampaigns=a)},null,8,["options","selectedOptions","disabled"]),i(S,{label:"Success after message",value:l.afterFormMessageSuccess,help:"The message shown after the form has been submitted.",size:"sm",onInput:o[3]||(o[3]=a=>l.afterFormMessageSuccess=a)},null,8,["value"]),i(S,{label:"Error after message",value:l.afterFormMessageError,help:"The message shown after the form failed to submit.",size:"sm",onInput:o[4]||(o[4]=a=>l.afterFormMessageError=a)},null,8,["value"]),o[9]||(o[9]=n("a",{href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank",class:"underline text-brand-blue"},"Create Campaign?",-1))])]),_:1})):F("",!0)]))}}),Fe={class:"font-arboria"},_e=["name","value"],$e={class:"flex flex-col gap-4"},Oe={class:"flex gap-4 items-center"},Se={class:"flex gap-4"},ke={class:"bg-gray-100 rounded-xl p-2! text-center w-96 font-mono text-base"},Ie={class:"flex items-center"},Me=k({__name:"ai-chatter",setup(y){const v=z("aiChatterData");if(!v)throw new Error("aiChatterData is undefined");const{fieldName:p,modelNameValues:m,aiMemoriesValues:c,gdprCampaigns:l,aiChat:r,gdprSemaphore:o,shortcode:a,ajaxUrl:b,ajaxAction:_,ajaxNonce:R,postId:U}=v,C=$([]),s=P(r);async function Y(){const d=j(s,o);if(d.length>0){d.forEach(t=>{x(C,"error",t,0)});return}const e=await me(b,_,R,JSON.stringify(s),U);e.success?(x(C,"success",e.data.message),navigator.clipboard.writeText(a),x(C,"success","Shortcode copied to clipboard")):x(C,"error",e.error,0)}function W(d){s.showContactForm=d.showContactForm,s.formFields=d.formFields,s.allowAiContactCampaigns=d.allowAiContactCampaigns,s.aiContactCampaigns=d.aiContactCampaigns,s.afterFormMessageSuccess=d.afterFormMessageSuccess,s.afterFormMessageError=d.afterFormMessageError}function B(d,e){return d==="never"?!1:d==="always"?!0:e}ae(()=>{const d=document.getElementById("publish");d&&d.addEventListener("click",function(e){const t=j(s,o);t.length>0&&(e.preventDefault(),t.forEach(q=>{x(C,"error",q,0)}))})});function H(d){C.value=C.value.filter(e=>e.id!==d)}return(d,e)=>(u(),g("div",Fe,[n("input",{type:"hidden",name:f(p),value:JSON.stringify(s)},null,8,_e),i(ue,{title:"AI Chatter"}),i(T,null,{default:h(()=>[i(ne,{class:"top-2"},{default:h(()=>[(u(!0),g(O,null,L(C.value,t=>(u(),E(re,{key:t.id,type:t.type,message:t.message,time:t.time,onClose:q=>H(t.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),i(K,{label:"Is active",id:"is-active",value:s.isActive,help:"Activate the chatter in the frontend.",onSwitch:e[0]||(e[0]=t=>s.isActive=t)},null,8,["value"]),i(V,{label:"Open AI model",class:"max-w-lg",id:"model",options:f(m).map(t=>({label:t,value:t})),selectedOption:s.modelName,onSelectOption:e[1]||(e[1]=t=>s.modelName=t)},null,8,["options","selectedOption"]),i(V,{label:"AI memory",class:"max-w-lg",options:f(c).map(t=>({label:t.name,value:t.name})),selectedOption:s.pineconeIndex,help:"One of your trained database indexes created in Pinecone.",onSelectOption:e[2]||(e[2]=t=>s.pineconeIndex=t)},null,8,["options","selectedOption"]),i(M,{label:"TopK",type:"number",class:"max-w-lg",value:s.topK,help:"The number of most similar responses to retrieve from the vector database for each query.",onInput:e[3]||(e[3]=t=>s.topK=Number(t)),onEnter:e[4]||(e[4]=t=>s.topK=Number(t))},null,8,["value"]),i(S,{label:"Primer prompt",class:"max-w-lg",value:s.primerPrompt,help:"Your prompt to start the conversation.",onInput:e[5]||(e[5]=t=>s.primerPrompt=t)},null,8,["value"]),i(M,{label:"Initail message",class:"max-w-lg",value:s.initMessage,help:"Your initial message.",onInput:e[6]||(e[6]=t=>s.initMessage=t),onEnter:e[7]||(e[7]=t=>s.initMessage=t)},null,8,["value"]),n("div",$e,[n("div",Oe,[i(D,{symbol:"h",onActivateTooltip:e[8]||(e[8]=t=>s.hasAiChat=t),value:s.hasAiChat},{default:h(()=>e[16]||(e[16]=[A(" If selected, the AiChat will store the content of the messages ")])),_:1},8,["value"]),i(D,{symbol:"g",onActivateTooltip:e[9]||(e[9]=t=>s.allowAiChatCampaigns=t),value:B(f(o),s.allowAiChatCampaigns),disabled:f(o)==="never"||f(o)==="always"},{default:h(()=>e[17]||(e[17]=[A(" If selected, before to proceed with the chat the user will be request to accept the selected AI Campaigns ")])),_:1},8,["value","disabled"])]),i(G,{id:"ai-chat-campaigns",class:"max-w-lg",label:"Gdpr campaigns",options:f(l).map(t=>({label:t.title,value:t.id.toString()})),selectedOptions:s.aiChatCampaigns,disabled:!B(f(o),s.allowAiChatCampaigns),atLeastOne:f(o)==="always",help:"Select the GDPR campaigns that the user will be requested to accept before to proceed with the chat.",onSelectedOptions:e[10]||(e[10]=t=>s.aiChatCampaigns=t)},null,8,["options","selectedOptions","disabled","atLeastOne"]),e[18]||(e[18]=n("a",{class:"underline text-blue-500",href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank"}," Create Campaign? ",-1))]),n("section",null,[n("header",{class:I(["bg-white p-6 border rounded-t-xl border-gray-200",{"rounded-b-xl":!s.limitChat}])},[i(N,{id:"limit-chat",label:"Limit chat messages",value:s.limitChat,onChange:e[11]||(e[11]=t=>s.limitChat=t),help:"To avoid over expensive chat, or to drive the customer to an action, you can select this checkbox to limit the amount of messages of a chat"},null,8,["value"])],2),s.limitChat?(u(),E(T,{key:0,class:"border border-t-0 border-gray-200"},{default:h(()=>[i(M,{label:"Number of messages",type:"number",min:1,value:s.questionsLimit,help:"After this amount of messages will be shown the limit message.",onInput:e[12]||(e[12]=t=>s.questionsLimit=Number(t)),onEnter:e[13]||(e[13]=t=>s.questionsLimit=Number(t))},null,8,["value"]),i(S,{label:"Limit message",value:s.beforeFormMessage,help:"The message shown when the number of messages is reached.",size:"sm",onInput:e[14]||(e[14]=t=>s.beforeFormMessage=t)},null,8,["value"]),i(Ae,{onContactForm:e[15]||(e[15]=t=>W(t))})]),_:1})):F("",!0)]),n("div",null,[e[20]||(e[20]=n("p",{class:"font-light text-brand-gray-dark text-sm max-w-xl mb-4"}," After making any changes, don't forget to update the AiChatter by copying the shortcode below again or updating the AiChatter custom post type. ",-1)),n("div",Se,[n("code",ke,w(f(a)),1),n("div",Ie,[i(de,{onClick:Y},{default:h(()=>e[19]||(e[19]=[A("Save and copy to clipboard")])),_:1})])])])]),_:1})]))}});let J={};J=window.ai_chatter.data;const Ee=se({setup(){le("aiChatterData",J)},render:()=>oe(Me)});Ee.mount("#main_ai_chatter");
