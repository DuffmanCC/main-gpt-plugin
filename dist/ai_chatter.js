import{d as L,r as k,c,o as d,n as S,e as l,h as G,b as O,w as p,f as y,t as w,y as H,a as i,F as $,g as q,z as Q,i as V,A as z,m as X,k as E,u as v,l as Z,q as ee,s as te,x as ae}from"./style.js";import{a as se,b as oe,_ as le,c as _}from"./a-text.vue_vue_type_script_setup_true_lang.js";import{_ as ie,s as ne}from"./requests.js";import{_ as N}from"./a-checkbox.vue_vue_type_script_setup_true_lang.js";import{_ as j}from"./a-select.vue_vue_type_script_setup_true_lang.js";import{_ as A}from"./a-switch.vue_vue_type_script_setup_true_lang.js";import{_ as M}from"./a-textarea.vue_vue_type_script_setup_true_lang.js";import{m as D,_ as re}from"./metabox-body.js";import{v as P,a as x}from"./tools.js";const me=["id","name","disabled","aria-errormessage"],de=["value"],ue=["id"],pe=["id"],K=L({__name:"a-select-multi",props:{options:{default:()=>[{label:"",value:""}]},selectedOptions:{default:()=>[]},label:{default:""},id:{default:""},help:{},disabled:{type:Boolean,default:!1},atLeastOne:{type:Boolean,default:!1}},emits:["selected-options"],setup(F,{emit:C}){const u=C,h=k(F.selectedOptions),g=k(""),n=r=>{const o=r.target,s=Array.from(o.selectedOptions);F.atLeastOne&&s.length===0?g.value="Please select at least one option":g.value="",h.value=s.map(f=>parseInt(f.value)),u("selected-options",h.value)};return(r,o)=>(d(),c("label",{class:S(["flex flex-col gap-2 text-sm relative pb-6",{"opacity-50 cursor-not-allowed":r.disabled}])},[l(se,null,{default:p(()=>[y(w(r.label),1)]),_:1}),G(i("select",{id:r.id,name:r.id,class:"leading-normal! w-full border border-gray-300! rounded-md! p-2! shadow! disabled:border-gray-200 disabled:cursor-not-allowed","onUpdate:modelValue":o[0]||(o[0]=s=>h.value=s),multiple:"",disabled:r.disabled,onChange:n,"aria-errormessage":`${r.id}_error`},[(d(!0),c($,null,q(r.options,s=>(d(),c("option",{key:s.value,value:s.value},w(s.label),9,de))),128))],40,me),[[H,h.value]]),r.$slots.default?(d(),c("div",{key:0,id:`${r.id}_help`,class:"font-light text-brand-gray-dark text-sm max-w-xl"},[Q(r.$slots,"default")],8,ue)):O("",!0),g.value?(d(),c("div",{key:1,id:`${r.id}_error`,class:"text-red-500 font-medium text-sm absolute bottom-0"},w(g.value),9,pe)):O("",!0)],2))}}),ce={class:"grid grid-cols-3 flex-col gap-2 max-w-xs items-center"},ge={class:"flex flex-col gap-4"},fe=L({__name:"contact-form",emits:["contact-form"],setup(F,{emit:C}){const u=V("aiChatterData");if(!u)throw new Error("aiChatterData is undefined");const h=C;function g(r,o,s,f){n.formFields=[...n.formFields.map(I=>I.label===r?{label:r,type:o,active:s,required:f}:I)]}const n=z({formFields:u.aiChat.formFields,showContactForm:u.aiChat.showContactForm,allowAiContactCampaigns:u.aiChat.allowAiContactCampaigns,aiContactCampaigns:u.aiChat.aiContactCampaigns,afterFormMessageSuccess:u.aiChat.afterFormMessageSuccess,afterFormMessageError:u.aiChat.afterFormMessageError});return X(n,r=>h("contact-form",r)),(r,o)=>(d(),c("section",null,[i("header",{class:S(["bg-white p-6 border rounded-t-xl border-gray-200",{"rounded-b-xl":!n.showContactForm}])},[l(N,{id:"show-contact-form",label:"Show contact form",value:n.showContactForm,onChange:o[0]||(o[0]=s=>n.showContactForm=s),help:"If checked, after the limit message will be shown a contact form"},null,8,["value"])],2),n.showContactForm?(d(),E(D,{key:0,class:"border border-t-0 border-gray-200"},{default:p(()=>[o[9]||(o[9]=i("p",{class:"font-light text-gray-700 uppercase text-sm mb-2"},"Form Fields",-1)),i("div",ce,[o[5]||(o[5]=i("div",{class:"uppercase"},"Active",-1)),o[6]||(o[6]=i("div",{class:"uppercase"},"Mandatory",-1)),o[7]||(o[7]=i("div",{class:"uppercase"},"Field name",-1)),(d(!0),c($,null,q(n.formFields,s=>(d(),c($,{key:s.label},[l(A,{value:s.active,id:`active_${s.label}`,onSwitch:f=>g(s.label,s.type,f,s.required)},null,8,["value","id","onSwitch"]),l(N,{value:s.required,id:`required_${s.label}`,onChange:f=>g(s.label,s.type,s.active,f),disabled:!s.active},null,8,["value","id","onChange","disabled"]),i("div",null,w(s.label),1)],64))),128))]),i("div",ge,[l(A,{id:"allow_ai_contact_campaigns",label:"Allow AI Contact Campaigns",value:n.allowAiContactCampaigns,onSwitch:o[1]||(o[1]=s=>n.allowAiContactCampaigns=s),help:"If activated allow you to select a AI Campaigns for you AI Contact form"},null,8,["value"]),l(K,{label:"AI Contact Campaigns",id:"ai_contact_campaigns",class:"max-w-lg",options:v(u).gdprCampaigns.map(s=>({label:s.title,value:s.id.toString()})),selectedOptions:n.aiContactCampaigns,disabled:!n.allowAiContactCampaigns,onSelectedOptions:o[2]||(o[2]=s=>n.aiContactCampaigns=s)},{default:p(()=>o[8]||(o[8]=[i("a",{href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank",class:"text-blue-500 hover:text-blue-700"}," Create Campaign? ",-1)])),_:1},8,["options","selectedOptions","disabled"]),l(M,{label:"Success after message",value:n.afterFormMessageSuccess,help:"The message shown after the form has been submitted.",size:"xs",onInput:o[3]||(o[3]=s=>n.afterFormMessageSuccess=s)},null,8,["value"]),l(M,{label:"Error after message",value:n.afterFormMessageError,help:"The message shown after the form failed to submit.",size:"xs",onInput:o[4]||(o[4]=s=>n.afterFormMessageError=s)},null,8,["value"])])]),_:1})):O("",!0)]))}}),he={class:"font-arboria"},be=["name","value"],Ce={class:"flex flex-col gap-4"},ve={class:"flex gap-4"},we={class:"bg-gray-100 rounded-xl px-4! py-2! font-mono text-lg! flex items-center justify-center"},xe={class:"flex items-center"},ye=L({__name:"ai-chatter",setup(F){const C=V("aiChatterData");if(!C)throw new Error("aiChatterData is undefined");const{fieldName:u,modelNameValues:h,aiMemoriesValues:g,gdprCampaigns:n,aiChat:r,shortcode:o,ajaxUrl:s,ajaxAction:f,ajaxNonce:I,postId:R}=C,b=k([]),a=z(r);async function U(){const m=P(a);if(m.length>0){m.forEach(t=>{x(b,"error",t,0)});return}const e=await ne(s,f,I,JSON.stringify(a),R);e.success?(x(b,"success",e.data.message),navigator.clipboard.writeText(o),x(b,"success","Shortcode copied to clipboard")):x(b,"error",e.error,0)}function Y(m){a.showContactForm=m.showContactForm,a.formFields=m.formFields,a.allowAiContactCampaigns=m.allowAiContactCampaigns,a.aiContactCampaigns=m.aiContactCampaigns,a.afterFormMessageSuccess=m.afterFormMessageSuccess,a.afterFormMessageError=m.afterFormMessageError}Z(()=>{const m=document.getElementById("publish");m&&m.addEventListener("click",function(e){const t=P(a);t.length>0&&(e.preventDefault(),t.forEach(T=>{x(b,"error",T,0)}))})});function W(m){b.value=b.value.filter(e=>e.id!==m)}const B={"gpt-4.1":8,"gpt-4.1-mini":1.6,"gpt-4.1-nano":.4,"gpt-4.5-preview":150,"gpt-4o":10,"gpt-4o-mini":.6};return(m,e)=>(d(),c("div",he,[i("input",{type:"hidden",name:v(u),value:JSON.stringify(a)},null,8,be),l(re,{title:"AI Chatter"}),l(D,null,{default:p(()=>[l(oe,{class:"top-2"},{default:p(()=>[(d(!0),c($,null,q(b.value,t=>(d(),E(le,{key:t.id,type:t.type,message:t.message,time:t.time,onClose:T=>W(t.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),l(A,{label:"Is active",id:"is-active",value:a.isActive,help:"Activate the chatter in the frontend.",onSwitch:e[0]||(e[0]=t=>a.isActive=t)},null,8,["value"]),l(j,{label:"Open AI model",class:"max-w-lg",id:"model",options:v(h).map(t=>({label:t,value:t})),selectedOption:a.modelName,onSelectOption:e[1]||(e[1]=t=>a.modelName=t)},{default:p(()=>[e[16]||(e[16]=y(" Select the OpenAI model to use for AI chat.")),e[17]||(e[17]=i("br",null,null,-1)),i("span",{class:S(["font-semibold text-xl mr-2",{"text-red-500":B[a.modelName]>5}])}," $"+w(B[a.modelName]),3),e[18]||(e[18]=i("span",null,"(Price per 1M tokens). 1 token â‰ˆ 0.75 words in english.",-1)),e[19]||(e[19]=i("a",{href:"https://platform.openai.com/docs/pricing",target:"_blank",class:"text-blue-500 hover:text-blue-700"}," More info ",-1))]),_:1},8,["options","selectedOption"]),l(j,{label:"AI memory",class:"max-w-lg",options:v(g).map(t=>({label:t.name,value:t.name})),selectedOption:a.pineconeIndex,onSelectOption:e[2]||(e[2]=t=>a.pineconeIndex=t)},{default:p(()=>e[20]||(e[20]=[y(" One of your trained database indexes created in Pinecone. ")])),_:1},8,["options","selectedOption"]),l(_,{label:"TopK",type:"number",class:"max-w-lg",value:a.topK,help:"The number of most similar responses to retrieve from the vector database for each query.",onInput:e[3]||(e[3]=t=>a.topK=Number(t)),onEnter:e[4]||(e[4]=t=>a.topK=Number(t))},null,8,["value"]),l(M,{label:"Primer prompt",class:"max-w-lg",value:a.primerPrompt,help:"Your prompt to start the conversation.",onInput:e[5]||(e[5]=t=>a.primerPrompt=t)},null,8,["value"]),l(_,{label:"Initail message",class:"max-w-lg",value:a.initMessage,help:"Your initial message.",onInput:e[6]||(e[6]=t=>a.initMessage=t),onEnter:e[7]||(e[7]=t=>a.initMessage=t)},null,8,["value"]),i("div",Ce,[l(A,{id:"activate_ai_chat",label:"Activate AI Chat",value:a.hasAiChat,onSwitch:e[8]||(e[8]=t=>a.hasAiChat=t),help:"If selected, the AI Chat will store the content of the chat messages."},null,8,["value"]),l(A,{id:"allow_ai_chat_campaigns",label:"Allow AI Chat Campaigns",value:a.allowAiChatCampaigns,onSwitch:e[9]||(e[9]=t=>a.allowAiChatCampaigns=t),disabled:!a.hasAiChat,help:`If selected, before to proceed with the chat the user will be
            request to accept the selected AI Campaigns`},null,8,["value","disabled"]),l(K,{id:"ai-chat-campaigns",class:"max-w-lg",label:"AI Chat Campaigns",options:v(n).map(t=>({label:t.title,value:t.id.toString()})),selectedOptions:a.aiChatCampaigns,disabled:!a.allowAiChatCampaigns||!a.hasAiChat,onSelectedOptions:e[10]||(e[10]=t=>a.aiChatCampaigns=t)},{default:p(()=>e[21]||(e[21]=[y(" Select the AI Chat campaigns that the user will be requested to accept before to proceed with the chat. "),i("a",{class:"text-blue-500 hover:text-blue-700",href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank"}," Create Campaign? ",-1)])),_:1},8,["options","selectedOptions","disabled"])]),i("section",null,[i("header",{class:S(["bg-white p-6 border rounded-t-xl border-gray-200",{"rounded-b-xl":!a.limitChat}])},[l(N,{id:"limit-chat",label:"Limit chat messages",value:a.limitChat,onChange:e[11]||(e[11]=t=>a.limitChat=t),help:"To avoid over expensive chat, or to drive the customer to an action, you can select this checkbox to limit the amount of messages of a chat"},null,8,["value"])],2),a.limitChat?(d(),E(D,{key:0,class:"border border-t-0 border-gray-200"},{default:p(()=>[l(_,{label:"Number of messages",type:"number",min:1,value:a.questionsLimit,help:"After this amount of messages will be shown the limit message.",onInput:e[12]||(e[12]=t=>a.questionsLimit=Number(t)),onEnter:e[13]||(e[13]=t=>a.questionsLimit=Number(t))},null,8,["value"]),l(M,{label:"Limit message",value:a.beforeFormMessage,help:"The message shown when the number of messages is reached.",size:"sm",onInput:e[14]||(e[14]=t=>a.beforeFormMessage=t)},null,8,["value"]),l(fe,{onContactForm:e[15]||(e[15]=t=>Y(t))})]),_:1})):O("",!0)]),i("div",null,[e[23]||(e[23]=i("p",{class:"font-light text-brand-gray-dark text-sm max-w-xl mb-4"}," After making any changes, don't forget to update the AiChatter by copying the shortcode below again or updating the AiChatter custom post type. ",-1)),i("div",ve,[i("code",we,w(v(o)),1),i("div",xe,[l(ie,{onClick:U},{default:p(()=>e[22]||(e[22]=[y(" Save and copy to clipboard ")])),_:1})])])])]),_:1})]))}});let J={};J=window.ai_chatter.data;const Ae=ee({setup(){ae("aiChatterData",J)},render:()=>te(ye)});Ae.mount("#main_ai_chatter");
