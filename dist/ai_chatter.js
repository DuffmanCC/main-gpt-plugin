import{d as k,r as F,c as g,o as p,n as M,e as l,h as Q,b as $,w as f,f as A,t as y,y as X,a as i,F as S,g as L,p as Z,z as tt,i as P,A as z,m as et,k as E,u as h,l as at,q as st,s as ot,x as lt}from"./style.js";import{a as it,b as nt,_ as rt,c as I}from"./a-text.vue_vue_type_script_setup_true_lang.js";import{a as V,_ as dt,s as mt}from"./a-select.vue_vue_type_script_setup_true_lang.js";import{_ as N}from"./a-checkbox.vue_vue_type_script_setup_true_lang.js";import{a as K,m as T,_ as ut}from"./metabox-body.js";import{_ as O}from"./a-textarea.vue_vue_type_script_setup_true_lang.js";import{v as j,a as _}from"./tools.js";const ct=["id","name","disabled","aria-errormessage"],pt=["value"],wt=["id"],ht=["id"],G=k({__name:"a-select-multi",props:{options:{type:Array,default:()=>[{label:"",value:""}]},selectedOptions:{type:Array,default:()=>[]},label:{type:String,default:""},id:{type:String,default:""},help:{type:String,default:""},disabled:{type:Boolean,default:!1},atLeastOne:{type:Boolean,default:!1}},emits:["selected-options"],setup(r,{emit:b}){const c=r,C=b,m=F(c.selectedOptions),o=F(""),w=n=>{const s=n.target,u=Array.from(s.selectedOptions);c.atLeastOne&&u.length===0?o.value="Please select at least one option":o.value="",m.value=u.map(x=>parseInt(x.value)),C("selected-options",m.value)};return(n,s)=>(p(),g("label",{class:M(["tw:flex tw:flex-col tw:gap-2 tw:text-sm tw:relative tw:pb-6",{"tw:opacity-50 tw:cursor-not-allowed":r.disabled}])},[l(it,null,{default:f(()=>[A(y(r.label),1)]),_:1}),Q(i("select",{id:r.id,name:r.id,class:"tw:leading-normal! tw:w-full tw:border tw:border-gray-300! tw:rounded-md! tw:p-2! tw:shadow! tw:disabled:border-gray-200 tw:disabled:cursor-not-allowed","onUpdate:modelValue":s[0]||(s[0]=u=>m.value=u),multiple:"",disabled:r.disabled,onChange:w,"aria-errormessage":`${r.id}_error`},[(p(!0),g(S,null,L(r.options,u=>(p(),g("option",{key:u.value,value:u.value},y(u.label),9,pt))),128))],40,ct),[[X,m.value]]),r.help?(p(),g("div",{key:0,id:`${r.id}_help`,class:"tw:font-light tw:text-brand-gray-dark tw:text-sm tw:max-w-xl"},y(r.help),9,wt)):$("",!0),o.value?(p(),g("div",{key:1,id:`${r.id}_error`,class:"tw:text-red-500 tw:font-semibold tw:text-sm tw:absolute tw:bottom-0"},y(o.value),9,ht)):$("",!0)],2))}}),gt={class:"tw:relative tw:group"},ft=["disabled"],bt={class:"tw:relative tw:-top-px tw:uppercase"},vt=["id","name","value"],Ct={class:"tw:absolute tw:z-10 tw:p-2 tw:text-xs tw:bg-gray-100 tw:border tw:border-gray-100 tw:rounded-md tw:w-32 tw:bottom-10 tw:text-black tw:hidden tw:group-hover:block"},D=k({__name:"a-tooltip",props:{id:{type:String,default:""},value:Boolean,symbol:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["activateTooltip"],setup(r,{emit:b}){const c=r,C=b,m=F(c.value),o=()=>{m.value=!m.value,C("activateTooltip",m.value)};return(w,n)=>(p(),g("div",gt,[i("button",{class:M(["tw:flex tw:justify-center tw:items-center tw:text-xl tw:h-8 tw:w-8 tw:rounded-full tw:text-white tw:transition-all tw:duration-300 tw:disabled:cursor-not-allowed tw:disabled:opacity-30",{"tw:bg-green-500":m.value,"tw:bg-gray-500":!m.value}]),onClick:Z(o,["prevent"]),disabled:r.disabled},[i("span",bt,y(r.symbol),1),i("input",{type:"hidden",id:r.id,name:r.id,value:m.value,onInput:o},null,40,vt)],10,ft),i("div",Ct,[tt(w.$slots,"default")])]))}}),yt=i("p",{class:"tw:font-light tw:text-gray-700 tw:uppercase tw:text-sm tw:mb-2"}," Form Fields ",-1),xt={class:"tw:grid tw:grid-cols-3 tw:flex-col tw:gap-2 tw:max-w-xs tw:items-center"},_t=i("div",{class:"tw:uppercase"},"Active",-1),At=i("div",{class:"tw:uppercase"},"Mandatory",-1),Ft=i("div",{class:"tw:uppercase"},"Field name",-1),$t={class:"tw:flex tw:flex-col tw:gap-4"},St=i("a",{href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank",class:"tw:underline tw:text-brand-blue"},"Create Campaign?",-1),Ot=k({__name:"contact-form",emits:["contact-form"],setup(r,{emit:b}){const c=P("aiChatterData");if(!c)throw new Error("aiChatterData is undefined");const C=b;function m(w,n,s,u){o.formFields=[...o.formFields.map(x=>x.label===w?{label:w,type:n,active:s,required:u}:x)]}const o=z({formFields:c.aiChat.formFields,showContactForm:c.aiChat.showContactForm,allowAiContactCampaigns:c.aiChat.allowAiContactCampaigns,aiContactCampaigns:c.aiChat.aiContactCampaigns,afterFormMessageSuccess:c.aiChat.afterFormMessageSuccess,afterFormMessageError:c.aiChat.afterFormMessageError});return et(o,w=>C("contact-form",w)),(w,n)=>(p(),g("section",null,[i("header",{class:M(["tw:bg-white tw:p-6 tw:border tw:rounded-t-xl tw:border-gray-200",{"tw:rounded-b-xl":!o.showContactForm}])},[l(N,{label:"Show contact form",value:o.showContactForm,onChange:n[0]||(n[0]=s=>o.showContactForm=s),help:"If checked, after the limit message will be shown a contact form"},null,8,["value"])],2),o.showContactForm?(p(),E(T,{key:0,class:"tw:border tw:border-t-0 tw:border-gray-200"},{default:f(()=>[yt,i("div",xt,[_t,At,Ft,(p(!0),g(S,null,L(o.formFields,s=>(p(),g(S,{key:s.label},[l(K,{value:s.active,id:`active_${s.label}`,onSwitch:u=>m(s.label,s.type,u,s.required)},null,8,["value","id","onSwitch"]),l(N,{value:s.required,id:`required_${s.label}`,onChange:u=>m(s.label,s.type,s.active,u),disabled:!s.active},null,8,["value","id","onChange","disabled"]),i("div",null,y(s.label),1)],64))),128))]),i("div",$t,[l(D,{symbol:"g",id:"is_ai_contact_campaigns",onActivateTooltip:n[1]||(n[1]=s=>o.allowAiContactCampaigns=s),value:o.allowAiContactCampaigns},{default:f(()=>[A("if activated allow you to select a gpt leads gdpr campain")]),_:1},8,["value"]),l(G,{label:"AiContact Campaigns",id:"ai_contact_campaigns",class:"tw:max-w-lg",options:h(c).gdprCampaigns.map(s=>({label:s.title,value:s.id.toString()})),selectedOptions:o.aiContactCampaigns,disabled:!o.allowAiContactCampaigns,onSelectedOptions:n[2]||(n[2]=s=>o.aiContactCampaigns=s)},null,8,["options","selectedOptions","disabled"]),l(O,{label:"Success after message",value:o.afterFormMessageSuccess,help:"The message shown after the form has been submitted.",size:"sm",onInput:n[3]||(n[3]=s=>o.afterFormMessageSuccess=s)},null,8,["value"]),l(O,{label:"Error after message",value:o.afterFormMessageError,help:"The message shown after the form failed to submit.",size:"sm",onInput:n[4]||(n[4]=s=>o.afterFormMessageError=s)},null,8,["value"]),St])]),_:1})):$("",!0)]))}}),kt={class:"tw:font-arboria"},Mt=["name","value"],It={class:"tw:flex tw:flex-col tw:gap-4"},Et={class:"tw:flex tw:gap-4 tw:items-center"},Nt=i("a",{class:"tw:underline tw:text-blue-500",href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank"},"Create Campaign?",-1),Tt=i("p",{class:"tw:font-light tw:text-brand-gray-dark tw:text-sm tw:max-w-xl tw:mb-4"}," After making any changes, don't forget to update the AiChatter by copying the shortcode below again or updating the AiChatter custom post type. ",-1),Dt={class:"tw:flex tw:gap-4"},Lt={class:"tw:bg-gray-100 tw:rounded-xl tw:p-2! tw:text-center tw:w-96 tw:font-mono tw:text-base"},Bt={class:"tw:flex tw:items-center"},qt=k({__name:"ai-chatter",setup(r){const b=P("aiChatterData");if(!b)throw new Error("aiChatterData is undefined");const{fieldName:c,modelNameValues:C,aiMemoriesValues:m,gdprCampaigns:o,aiChat:w,gdprSemaphore:n,shortcode:s,ajaxUrl:u,ajaxAction:x,ajaxNonce:J,postId:U}=b,v=F([]),a=z(w);async function Y(){const d=j(a,n);if(d.length>0){d.forEach(t=>{_(v,"error",t,0)});return}const e=await mt(u,x,J,JSON.stringify(a),U);e.success?(_(v,"success",e.data.message),navigator.clipboard.writeText(s),_(v,"success","Shortcode copied to clipboard")):_(v,"error",e.error,0)}function W(d){a.showContactForm=d.showContactForm,a.formFields=d.formFields,a.allowAiContactCampaigns=d.allowAiContactCampaigns,a.aiContactCampaigns=d.aiContactCampaigns,a.afterFormMessageSuccess=d.afterFormMessageSuccess,a.afterFormMessageError=d.afterFormMessageError}function B(d,e){return d==="never"?!1:d==="always"?!0:e}at(()=>{const d=document.getElementById("publish");d&&d.addEventListener("click",function(e){const t=j(a,n);t.length>0&&(e.preventDefault(),t.forEach(q=>{_(v,"error",q,0)}))})});function H(d){v.value=v.value.filter(e=>e.id!==d)}return(d,e)=>(p(),g("div",kt,[i("input",{type:"hidden",name:h(c),value:JSON.stringify(a)},null,8,Mt),l(ut,{title:"AI Chatter"}),l(T,null,{default:f(()=>[l(nt,{class:"tw:top-2"},{default:f(()=>[(p(!0),g(S,null,L(v.value,t=>(p(),E(rt,{key:t.id,type:t.type,message:t.message,time:t.time,onClose:q=>H(t.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),l(K,{label:"Is active",id:"is-active",value:a.isActive,help:"Activate the chatter in the frontend.",onSwitch:e[0]||(e[0]=t=>a.isActive=t)},null,8,["value"]),l(V,{label:"Open AI model",class:"tw:max-w-lg",id:"model",options:h(C).map(t=>({label:t,value:t})),selectedOption:a.modelName,onSelectOption:e[1]||(e[1]=t=>a.modelName=t)},null,8,["options","selectedOption"]),l(V,{label:"AI memory",class:"tw:max-w-lg",options:h(m).map(t=>({label:t.name,value:t.name})),selectedOption:a.pineconeIndex,help:"One of your trained database indexes created in Pinecone.",onSelectOption:e[2]||(e[2]=t=>a.pineconeIndex=t)},null,8,["options","selectedOption"]),l(I,{label:"TopK",type:"number",class:"tw:max-w-lg",value:a.topK,help:"The number of most similar responses to retrieve from the vector database for each query.",onInput:e[3]||(e[3]=t=>a.topK=Number(t)),onEnter:e[4]||(e[4]=t=>a.topK=Number(t))},null,8,["value"]),l(O,{label:"Primer prompt",class:"tw:max-w-lg",value:a.primerPrompt,help:"Your prompt to start the conversation.",onInput:e[5]||(e[5]=t=>a.primerPrompt=t)},null,8,["value"]),l(I,{label:"Initail message",class:"tw:max-w-lg",value:a.initMessage,help:"Your initial message.",onInput:e[6]||(e[6]=t=>a.initMessage=t),onEnter:e[7]||(e[7]=t=>a.initMessage=t)},null,8,["value"]),i("div",It,[i("div",Et,[l(D,{symbol:"h",onActivateTooltip:e[8]||(e[8]=t=>a.hasAiChat=t),value:a.hasAiChat},{default:f(()=>[A("If selected, the AiChat will store the content of the messages")]),_:1},8,["value"]),l(D,{symbol:"g",onActivateTooltip:e[9]||(e[9]=t=>a.allowAiChatCampaigns=t),value:B(h(n),a.allowAiChatCampaigns),disabled:h(n)==="never"||h(n)==="always"},{default:f(()=>[A("If selected, before to proceed with the chat the user will be request to accept the selected AI GDPR Campaigns")]),_:1},8,["value","disabled"])]),l(G,{id:"ai-chat-campaigns",class:"tw:max-w-lg",label:"Gdpr campaigns",options:h(o).map(t=>({label:t.title,value:t.id.toString()})),selectedOptions:a.aiChatCampaigns,disabled:!B(h(n),a.allowAiChatCampaigns),atLeastOne:h(n)==="always",help:"Select the GDPR campaigns that the user will be requested to accept before to proceed with the chat.",onSelectedOptions:e[10]||(e[10]=t=>a.aiChatCampaigns=t)},null,8,["options","selectedOptions","disabled","atLeastOne"]),Nt]),i("section",null,[i("header",{class:M(["tw:bg-white tw:p-6 tw:border tw:rounded-t-xl tw:border-gray-200",{"tw:rounded-b-xl":!a.limitChat}])},[l(N,{label:"Limit chat messages",value:a.limitChat,onChange:e[11]||(e[11]=t=>a.limitChat=t),help:"To avoid over expensive chat, or to drive the customer to an action, you can select this checkbox to limit the amount of messages of a chat"},null,8,["value"])],2),a.limitChat?(p(),E(T,{key:0,class:"tw:border tw:border-t-0 tw:border-gray-200"},{default:f(()=>[l(I,{label:"Number of messages",type:"number",min:1,value:a.questionsLimit,help:"After this amount of messages will be shown the limit message.",onInput:e[12]||(e[12]=t=>a.questionsLimit=Number(t)),onEnter:e[13]||(e[13]=t=>a.questionsLimit=Number(t))},null,8,["value"]),l(O,{label:"Limit message",value:a.beforeFormMessage,help:"The message shown when the number of messages is reached.",size:"sm",onInput:e[14]||(e[14]=t=>a.beforeFormMessage=t)},null,8,["value"]),l(Ot,{onContactForm:e[15]||(e[15]=t=>W(t))})]),_:1})):$("",!0)]),i("div",null,[Tt,i("div",Dt,[i("code",Lt,y(h(s)),1),i("div",Bt,[l(dt,{onClick:Y},{default:f(()=>[A("Save and copy to clipboard")]),_:1})])])])]),_:1})]))}});let R={};R=window.ai_chatter.data;const Vt=st({setup(){lt("aiChatterData",R)},render:()=>ot(qt)});Vt.mount("#main_ai_chatter");
