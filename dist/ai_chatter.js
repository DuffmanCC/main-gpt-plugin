import{d as k,r as $,c,o as u,n as M,e as i,h as Q,b as F,w as b,f as A,t as C,y as X,a as n,F as O,g as L,p as Z,z as tt,i as P,A as z,m as et,k as E,u as g,l as at,q as st,s as ot,x as lt}from"./style.js";import{a as it,b as nt,_ as rt,c as I}from"./a-text.vue_vue_type_script_setup_true_lang.js";import{a as V,_ as dt,s as mt}from"./a-select.vue_vue_type_script_setup_true_lang.js";import{_ as N}from"./a-checkbox.vue_vue_type_script_setup_true_lang.js";import{_ as K}from"./a-switch.vue_vue_type_script_setup_true_lang.js";import{_ as S}from"./a-textarea.vue_vue_type_script_setup_true_lang.js";import{m as T,_ as ut}from"./metabox-body.js";import{v as j,a as x}from"./tools.js";const pt=["id","name","disabled","aria-errormessage"],wt=["value"],ct=["id"],gt=["id"],G=k({__name:"a-select-multi",props:{options:{default:()=>[{label:"",value:""}]},selectedOptions:{default:()=>[]},label:{default:""},id:{default:""},help:{default:""},disabled:{type:Boolean,default:!1},atLeastOne:{type:Boolean,default:!1}},emits:["selected-options"],setup(y,{emit:h}){const p=h,m=$(y.selectedOptions),w=$(""),l=r=>{const o=r.target,a=Array.from(o.selectedOptions);y.atLeastOne&&a.length===0?w.value="Please select at least one option":w.value="",m.value=a.map(f=>parseInt(f.value)),p("selected-options",m.value)};return(r,o)=>(u(),c("label",{class:M(["tw:flex tw:flex-col tw:gap-2 tw:text-sm tw:relative tw:pb-6",{"tw:opacity-50 tw:cursor-not-allowed":r.disabled}])},[i(it,null,{default:b(()=>[A(C(r.label),1)]),_:1}),Q(n("select",{id:r.id,name:r.id,class:"tw:leading-normal! tw:w-full tw:border tw:border-gray-300! tw:rounded-md! tw:p-2! tw:shadow! tw:disabled:border-gray-200 tw:disabled:cursor-not-allowed","onUpdate:modelValue":o[0]||(o[0]=a=>m.value=a),multiple:"",disabled:r.disabled,onChange:l,"aria-errormessage":`${r.id}_error`},[(u(!0),c(O,null,L(r.options,a=>(u(),c("option",{key:a.value,value:a.value},C(a.label),9,wt))),128))],40,pt),[[X,m.value]]),r.help?(u(),c("div",{key:0,id:`${r.id}_help`,class:"tw:font-light tw:text-brand-gray-dark tw:text-sm tw:max-w-xl"},C(r.help),9,ct)):F("",!0),w.value?(u(),c("div",{key:1,id:`${r.id}_error`,class:"tw:text-red-500 tw:font-semibold tw:text-sm tw:absolute tw:bottom-0"},C(w.value),9,gt)):F("",!0)],2))}}),ft={class:"tw:relative tw:group"},bt=["disabled"],ht={key:0,class:"tw:relative tw:-top-px tw:uppercase"},vt=["id","name","value"],Ct={class:"tw:absolute tw:z-10 tw:p-2 tw:text-xs tw:bg-gray-100 tw:border tw:border-gray-100 tw:rounded-md tw:w-32 tw:bottom-10 tw:text-black tw:hidden tw:group-hover:block"},D=k({__name:"a-tooltip",props:{id:{},value:{type:Boolean,default:!1},symbol:{},disabled:{type:Boolean,default:!1}},emits:["activateTooltip"],setup(y,{emit:h}){const p=h,m=$(y.value),w=()=>{m.value=!m.value,p("activateTooltip",m.value)};return(l,r)=>(u(),c("div",ft,[n("button",{class:M(["tw:cursor-pointer tw:flex tw:justify-center tw:items-center tw:text-xl tw:h-8 tw:w-8 tw:rounded-full tw:text-white tw:transition-all tw:duration-300 tw:disabled:cursor-not-allowed tw:disabled:opacity-30",{"tw:bg-green-500":m.value,"tw:bg-gray-500":!m.value}]),onClick:Z(w,["prevent"]),disabled:l.disabled},[l.symbol?(u(),c("span",ht,C(l.symbol),1)):F("",!0),n("input",{type:"hidden",id:l.id,name:l.id,value:m.value,onInput:w},null,40,vt)],10,bt),n("div",Ct,[tt(l.$slots,"default")])]))}}),yt={class:"tw:grid tw:grid-cols-3 tw:flex-col tw:gap-2 tw:max-w-xs tw:items-center"},xt={class:"tw:flex tw:flex-col tw:gap-4"},At=k({__name:"contact-form",emits:["contact-form"],setup(y,{emit:h}){const p=P("aiChatterData");if(!p)throw new Error("aiChatterData is undefined");const m=h;function w(r,o,a,f){l.formFields=[...l.formFields.map(_=>_.label===r?{label:r,type:o,active:a,required:f}:_)]}const l=z({formFields:p.aiChat.formFields,showContactForm:p.aiChat.showContactForm,allowAiContactCampaigns:p.aiChat.allowAiContactCampaigns,aiContactCampaigns:p.aiChat.aiContactCampaigns,afterFormMessageSuccess:p.aiChat.afterFormMessageSuccess,afterFormMessageError:p.aiChat.afterFormMessageError});return et(l,r=>m("contact-form",r)),(r,o)=>(u(),c("section",null,[n("header",{class:M(["tw:bg-white tw:p-6 tw:border tw:rounded-t-xl tw:border-gray-200",{"tw:rounded-b-xl":!l.showContactForm}])},[i(N,{id:"show-contact-form",label:"Show contact form",value:l.showContactForm,onChange:o[0]||(o[0]=a=>l.showContactForm=a),help:"If checked, after the limit message will be shown a contact form"},null,8,["value"])],2),l.showContactForm?(u(),E(T,{key:0,class:"tw:border tw:border-t-0 tw:border-gray-200"},{default:b(()=>[o[10]||(o[10]=n("p",{class:"tw:font-light tw:text-gray-700 tw:uppercase tw:text-sm tw:mb-2"}," Form Fields ",-1)),n("div",yt,[o[5]||(o[5]=n("div",{class:"tw:uppercase"},"Active",-1)),o[6]||(o[6]=n("div",{class:"tw:uppercase"},"Mandatory",-1)),o[7]||(o[7]=n("div",{class:"tw:uppercase"},"Field name",-1)),(u(!0),c(O,null,L(l.formFields,a=>(u(),c(O,{key:a.label},[i(K,{value:a.active,id:`active_${a.label}`,onSwitch:f=>w(a.label,a.type,f,a.required)},null,8,["value","id","onSwitch"]),i(N,{value:a.required,id:`required_${a.label}`,onChange:f=>w(a.label,a.type,a.active,f),disabled:!a.active},null,8,["value","id","onChange","disabled"]),n("div",null,C(a.label),1)],64))),128))]),n("div",xt,[i(D,{symbol:"g",id:"is_ai_contact_campaigns",onActivateTooltip:o[1]||(o[1]=a=>l.allowAiContactCampaigns=a),value:l.allowAiContactCampaigns},{default:b(()=>o[8]||(o[8]=[A(" if activated allow you to select a gpt leads gdpr campain ")])),_:1},8,["value"]),i(G,{label:"AiContact Campaigns",id:"ai_contact_campaigns",class:"tw:max-w-lg",options:g(p).gdprCampaigns.map(a=>({label:a.title,value:a.id.toString()})),selectedOptions:l.aiContactCampaigns,disabled:!l.allowAiContactCampaigns,onSelectedOptions:o[2]||(o[2]=a=>l.aiContactCampaigns=a)},null,8,["options","selectedOptions","disabled"]),i(S,{label:"Success after message",value:l.afterFormMessageSuccess,help:"The message shown after the form has been submitted.",size:"sm",onInput:o[3]||(o[3]=a=>l.afterFormMessageSuccess=a)},null,8,["value"]),i(S,{label:"Error after message",value:l.afterFormMessageError,help:"The message shown after the form failed to submit.",size:"sm",onInput:o[4]||(o[4]=a=>l.afterFormMessageError=a)},null,8,["value"]),o[9]||(o[9]=n("a",{href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank",class:"tw:underline tw:text-brand-blue"},"Create Campaign?",-1))])]),_:1})):F("",!0)]))}}),Ft={class:"tw:font-arboria"},_t=["name","value"],$t={class:"tw:flex tw:flex-col tw:gap-4"},Ot={class:"tw:flex tw:gap-4 tw:items-center"},St={class:"tw:flex tw:gap-4"},kt={class:"tw:bg-gray-100 tw:rounded-xl tw:p-2! tw:text-center tw:w-96 tw:font-mono tw:text-base"},Mt={class:"tw:flex tw:items-center"},It=k({__name:"ai-chatter",setup(y){const h=P("aiChatterData");if(!h)throw new Error("aiChatterData is undefined");const{fieldName:p,modelNameValues:m,aiMemoriesValues:w,gdprCampaigns:l,aiChat:r,gdprSemaphore:o,shortcode:a,ajaxUrl:f,ajaxAction:_,ajaxNonce:J,postId:U}=h,v=$([]),s=z(r);async function Y(){const d=j(s,o);if(d.length>0){d.forEach(e=>{x(v,"error",e,0)});return}const t=await mt(f,_,J,JSON.stringify(s),U);t.success?(x(v,"success",t.data.message),navigator.clipboard.writeText(a),x(v,"success","Shortcode copied to clipboard")):x(v,"error",t.error,0)}function W(d){s.showContactForm=d.showContactForm,s.formFields=d.formFields,s.allowAiContactCampaigns=d.allowAiContactCampaigns,s.aiContactCampaigns=d.aiContactCampaigns,s.afterFormMessageSuccess=d.afterFormMessageSuccess,s.afterFormMessageError=d.afterFormMessageError}function B(d,t){return d==="never"?!1:d==="always"?!0:t}at(()=>{const d=document.getElementById("publish");d&&d.addEventListener("click",function(t){const e=j(s,o);e.length>0&&(t.preventDefault(),e.forEach(q=>{x(v,"error",q,0)}))})});function H(d){v.value=v.value.filter(t=>t.id!==d)}return(d,t)=>(u(),c("div",Ft,[n("input",{type:"hidden",name:g(p),value:JSON.stringify(s)},null,8,_t),i(ut,{title:"AI Chatter"}),i(T,null,{default:b(()=>[i(nt,{class:"tw:top-2"},{default:b(()=>[(u(!0),c(O,null,L(v.value,e=>(u(),E(rt,{key:e.id,type:e.type,message:e.message,time:e.time,onClose:q=>H(e.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),i(K,{label:"Is active",id:"is-active",value:s.isActive,help:"Activate the chatter in the frontend.",onSwitch:t[0]||(t[0]=e=>s.isActive=e)},null,8,["value"]),i(V,{label:"Open AI model",class:"tw:max-w-lg",id:"model",options:g(m).map(e=>({label:e,value:e})),selectedOption:s.modelName,onSelectOption:t[1]||(t[1]=e=>s.modelName=e)},null,8,["options","selectedOption"]),i(V,{label:"AI memory",class:"tw:max-w-lg",options:g(w).map(e=>({label:e.name,value:e.name})),selectedOption:s.pineconeIndex,help:"One of your trained database indexes created in Pinecone.",onSelectOption:t[2]||(t[2]=e=>s.pineconeIndex=e)},null,8,["options","selectedOption"]),i(I,{label:"TopK",type:"number",class:"tw:max-w-lg",value:s.topK,help:"The number of most similar responses to retrieve from the vector database for each query.",onInput:t[3]||(t[3]=e=>s.topK=Number(e)),onEnter:t[4]||(t[4]=e=>s.topK=Number(e))},null,8,["value"]),i(S,{label:"Primer prompt",class:"tw:max-w-lg",value:s.primerPrompt,help:"Your prompt to start the conversation.",onInput:t[5]||(t[5]=e=>s.primerPrompt=e)},null,8,["value"]),i(I,{label:"Initail message",class:"tw:max-w-lg",value:s.initMessage,help:"Your initial message.",onInput:t[6]||(t[6]=e=>s.initMessage=e),onEnter:t[7]||(t[7]=e=>s.initMessage=e)},null,8,["value"]),n("div",$t,[n("div",Ot,[i(D,{symbol:"h",onActivateTooltip:t[8]||(t[8]=e=>s.hasAiChat=e),value:s.hasAiChat},{default:b(()=>t[16]||(t[16]=[A(" If selected, the AiChat will store the content of the messages ")])),_:1},8,["value"]),i(D,{symbol:"g",onActivateTooltip:t[9]||(t[9]=e=>s.allowAiChatCampaigns=e),value:B(g(o),s.allowAiChatCampaigns),disabled:g(o)==="never"||g(o)==="always"},{default:b(()=>t[17]||(t[17]=[A(" If selected, before to proceed with the chat the user will be request to accept the selected AI GDPR Campaigns ")])),_:1},8,["value","disabled"])]),i(G,{id:"ai-chat-campaigns",class:"tw:max-w-lg",label:"Gdpr campaigns",options:g(l).map(e=>({label:e.title,value:e.id.toString()})),selectedOptions:s.aiChatCampaigns,disabled:!B(g(o),s.allowAiChatCampaigns),atLeastOne:g(o)==="always",help:"Select the GDPR campaigns that the user will be requested to accept before to proceed with the chat.",onSelectedOptions:t[10]||(t[10]=e=>s.aiChatCampaigns=e)},null,8,["options","selectedOptions","disabled","atLeastOne"]),t[18]||(t[18]=n("a",{class:"tw:underline tw:text-blue-500",href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank"}," Create Campaign? ",-1))]),n("section",null,[n("header",{class:M(["tw:bg-white tw:p-6 tw:border tw:rounded-t-xl tw:border-gray-200",{"tw:rounded-b-xl":!s.limitChat}])},[i(N,{id:"limit-chat",label:"Limit chat messages",value:s.limitChat,onChange:t[11]||(t[11]=e=>s.limitChat=e),help:"To avoid over expensive chat, or to drive the customer to an action, you can select this checkbox to limit the amount of messages of a chat"},null,8,["value"])],2),s.limitChat?(u(),E(T,{key:0,class:"tw:border tw:border-t-0 tw:border-gray-200"},{default:b(()=>[i(I,{label:"Number of messages",type:"number",min:1,value:s.questionsLimit,help:"After this amount of messages will be shown the limit message.",onInput:t[12]||(t[12]=e=>s.questionsLimit=Number(e)),onEnter:t[13]||(t[13]=e=>s.questionsLimit=Number(e))},null,8,["value"]),i(S,{label:"Limit message",value:s.beforeFormMessage,help:"The message shown when the number of messages is reached.",size:"sm",onInput:t[14]||(t[14]=e=>s.beforeFormMessage=e)},null,8,["value"]),i(At,{onContactForm:t[15]||(t[15]=e=>W(e))})]),_:1})):F("",!0)]),n("div",null,[t[20]||(t[20]=n("p",{class:"tw:font-light tw:text-brand-gray-dark tw:text-sm tw:max-w-xl tw:mb-4"}," After making any changes, don't forget to update the AiChatter by copying the shortcode below again or updating the AiChatter custom post type. ",-1)),n("div",St,[n("code",kt,C(g(a)),1),n("div",Mt,[i(dt,{onClick:Y},{default:b(()=>t[19]||(t[19]=[A("Save and copy to clipboard")])),_:1})])])])]),_:1})]))}});let R={};R=window.ai_chatter.data;const Et=st({setup(){lt("aiChatterData",R)},render:()=>ot(It)});Et.mount("#main_ai_chatter");
