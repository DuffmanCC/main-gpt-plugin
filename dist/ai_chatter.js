import{d as N,r as M,c as p,o as d,n as D,e as l,h as W,b as I,w as v,f as j,t as w,y as G,a as r,F as S,g as q,i as V,z,m as H,k as $,u as C,l as Q,q as X,s as Z,x as ee}from"./style.js";import{a as ae,b as te,_ as se,c as O}from"./a-text.vue_vue_type_script_setup_true_lang.js";import{_ as oe,s as le}from"./requests.js";import{_ as k}from"./a-checkbox.vue_vue_type_script_setup_true_lang.js";import{_ as B}from"./a-select.vue_vue_type_script_setup_true_lang.js";import{_ as x}from"./a-switch.vue_vue_type_script_setup_true_lang.js";import{_}from"./a-textarea.vue_vue_type_script_setup_true_lang.js";import{m as E,_ as ie}from"./metabox-body.js";import{v as T,a as y}from"./tools.js";const ne=["id","name","disabled","aria-errormessage"],re=["value"],me=["id"],de=["id"],P=N({__name:"a-select-multi",props:{options:{default:()=>[{label:"",value:""}]},selectedOptions:{default:()=>[]},label:{default:""},id:{default:""},help:{default:""},disabled:{type:Boolean,default:!1},atLeastOne:{type:Boolean,default:!1}},emits:["selected-options"],setup(A,{emit:b}){const u=b,h=M(A.selectedOptions),c=M(""),i=n=>{const o=n.target,s=Array.from(o.selectedOptions);A.atLeastOne&&s.length===0?c.value="Please select at least one option":c.value="",h.value=s.map(g=>parseInt(g.value)),u("selected-options",h.value)};return(n,o)=>(d(),p("label",{class:D(["flex flex-col gap-2 text-sm relative pb-6",{"opacity-50 cursor-not-allowed":n.disabled}])},[l(ae,null,{default:v(()=>[j(w(n.label),1)]),_:1}),W(r("select",{id:n.id,name:n.id,class:"leading-normal! w-full border border-gray-300! rounded-md! p-2! shadow! disabled:border-gray-200 disabled:cursor-not-allowed","onUpdate:modelValue":o[0]||(o[0]=s=>h.value=s),multiple:"",disabled:n.disabled,onChange:i,"aria-errormessage":`${n.id}_error`},[(d(!0),p(S,null,q(n.options,s=>(d(),p("option",{key:s.value,value:s.value},w(s.label),9,re))),128))],40,ne),[[G,h.value]]),n.help?(d(),p("div",{key:0,id:`${n.id}_help`,class:"font-light text-brand-gray-dark text-sm max-w-xl"},w(n.help),9,me)):I("",!0),c.value?(d(),p("div",{key:1,id:`${n.id}_error`,class:"text-red-500 font-medium text-sm absolute bottom-0"},w(c.value),9,de)):I("",!0)],2))}}),ue={class:"grid grid-cols-3 flex-col gap-2 max-w-xs items-center"},pe={class:"flex flex-col gap-4"},ce=N({__name:"contact-form",emits:["contact-form"],setup(A,{emit:b}){const u=V("aiChatterData");if(!u)throw new Error("aiChatterData is undefined");const h=b;function c(n,o,s,g){i.formFields=[...i.formFields.map(F=>F.label===n?{label:n,type:o,active:s,required:g}:F)]}const i=z({formFields:u.aiChat.formFields,showContactForm:u.aiChat.showContactForm,allowAiContactCampaigns:u.aiChat.allowAiContactCampaigns,aiContactCampaigns:u.aiChat.aiContactCampaigns,afterFormMessageSuccess:u.aiChat.afterFormMessageSuccess,afterFormMessageError:u.aiChat.afterFormMessageError});return H(i,n=>h("contact-form",n)),(n,o)=>(d(),p("section",null,[r("header",{class:D(["bg-white p-6 border rounded-t-xl border-gray-200",{"rounded-b-xl":!i.showContactForm}])},[l(k,{id:"show-contact-form",label:"Show contact form",value:i.showContactForm,onChange:o[0]||(o[0]=s=>i.showContactForm=s),help:"If checked, after the limit message will be shown a contact form"},null,8,["value"])],2),i.showContactForm?(d(),$(E,{key:0,class:"border border-t-0 border-gray-200"},{default:v(()=>[o[9]||(o[9]=r("p",{class:"font-light text-gray-700 uppercase text-sm mb-2"},"Form Fields",-1)),r("div",ue,[o[5]||(o[5]=r("div",{class:"uppercase"},"Active",-1)),o[6]||(o[6]=r("div",{class:"uppercase"},"Mandatory",-1)),o[7]||(o[7]=r("div",{class:"uppercase"},"Field name",-1)),(d(!0),p(S,null,q(i.formFields,s=>(d(),p(S,{key:s.label},[l(x,{value:s.active,id:`active_${s.label}`,onSwitch:g=>c(s.label,s.type,g,s.required)},null,8,["value","id","onSwitch"]),l(k,{value:s.required,id:`required_${s.label}`,onChange:g=>c(s.label,s.type,s.active,g),disabled:!s.active},null,8,["value","id","onChange","disabled"]),r("div",null,w(s.label),1)],64))),128))]),r("div",pe,[l(x,{id:"allow_ai_contact_campaigns",label:"Allow AI Contact Campaigns",value:i.allowAiContactCampaigns,onSwitch:o[1]||(o[1]=s=>i.allowAiContactCampaigns=s),help:"If activated allow you to select a AI Campaigns for you AI Contact form"},null,8,["value"]),l(P,{label:"AI Contact Campaigns",id:"ai_contact_campaigns",class:"max-w-lg",options:C(u).gdprCampaigns.map(s=>({label:s.title,value:s.id.toString()})),selectedOptions:i.aiContactCampaigns,disabled:!i.allowAiContactCampaigns,onSelectedOptions:o[2]||(o[2]=s=>i.aiContactCampaigns=s)},null,8,["options","selectedOptions","disabled"]),l(_,{label:"Success after message",value:i.afterFormMessageSuccess,help:"The message shown after the form has been submitted.",size:"xs",onInput:o[3]||(o[3]=s=>i.afterFormMessageSuccess=s)},null,8,["value"]),l(_,{label:"Error after message",value:i.afterFormMessageError,help:"The message shown after the form failed to submit.",size:"xs",onInput:o[4]||(o[4]=s=>i.afterFormMessageError=s)},null,8,["value"]),o[8]||(o[8]=r("a",{href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank",class:"underline text-brand-blue"},"Create Campaign?",-1))])]),_:1})):I("",!0)]))}}),ge={class:"font-arboria"},he=["name","value"],fe={class:"flex flex-col gap-4"},be={class:"flex gap-4"},Ce={class:"bg-gray-100 rounded-xl px-4! py-2! font-mono text-lg! flex items-center justify-center"},ve={class:"flex items-center"},we=N({__name:"ai-chatter",setup(A){const b=V("aiChatterData");if(!b)throw new Error("aiChatterData is undefined");const{fieldName:u,modelNameValues:h,aiMemoriesValues:c,gdprCampaigns:i,aiChat:n,shortcode:o,ajaxUrl:s,ajaxAction:g,ajaxNonce:F,postId:J}=b,f=M([]),t=z(n);async function U(){const m=T(t);if(m.length>0){m.forEach(e=>{y(f,"error",e,0)});return}const a=await le(s,g,F,JSON.stringify(t),J);a.success?(y(f,"success",a.data.message),navigator.clipboard.writeText(o),y(f,"success","Shortcode copied to clipboard")):y(f,"error",a.error,0)}function Y(m){t.showContactForm=m.showContactForm,t.formFields=m.formFields,t.allowAiContactCampaigns=m.allowAiContactCampaigns,t.aiContactCampaigns=m.aiContactCampaigns,t.afterFormMessageSuccess=m.afterFormMessageSuccess,t.afterFormMessageError=m.afterFormMessageError}Q(()=>{const m=document.getElementById("publish");m&&m.addEventListener("click",function(a){const e=T(t);e.length>0&&(a.preventDefault(),e.forEach(L=>{y(f,"error",L,0)}))})});function R(m){f.value=f.value.filter(a=>a.id!==m)}return(m,a)=>(d(),p("div",ge,[r("input",{type:"hidden",name:C(u),value:JSON.stringify(t)},null,8,he),l(ie,{title:"AI Chatter"}),l(E,null,{default:v(()=>[l(te,{class:"top-2"},{default:v(()=>[(d(!0),p(S,null,q(f.value,e=>(d(),$(se,{key:e.id,type:e.type,message:e.message,time:e.time,onClose:L=>R(e.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),l(x,{label:"Is active",id:"is-active",value:t.isActive,help:"Activate the chatter in the frontend.",onSwitch:a[0]||(a[0]=e=>t.isActive=e)},null,8,["value"]),l(B,{label:"Open AI model",class:"max-w-lg",id:"model",options:C(h).map(e=>({label:e,value:e})),selectedOption:t.modelName,onSelectOption:a[1]||(a[1]=e=>t.modelName=e)},null,8,["options","selectedOption"]),l(B,{label:"AI memory",class:"max-w-lg",options:C(c).map(e=>({label:e.name,value:e.name})),selectedOption:t.pineconeIndex,help:"One of your trained database indexes created in Pinecone.",onSelectOption:a[2]||(a[2]=e=>t.pineconeIndex=e)},null,8,["options","selectedOption"]),l(O,{label:"TopK",type:"number",class:"max-w-lg",value:t.topK,help:"The number of most similar responses to retrieve from the vector database for each query.",onInput:a[3]||(a[3]=e=>t.topK=Number(e)),onEnter:a[4]||(a[4]=e=>t.topK=Number(e))},null,8,["value"]),l(_,{label:"Primer prompt",class:"max-w-lg",value:t.primerPrompt,help:"Your prompt to start the conversation.",onInput:a[5]||(a[5]=e=>t.primerPrompt=e)},null,8,["value"]),l(O,{label:"Initail message",class:"max-w-lg",value:t.initMessage,help:"Your initial message.",onInput:a[6]||(a[6]=e=>t.initMessage=e),onEnter:a[7]||(a[7]=e=>t.initMessage=e)},null,8,["value"]),r("div",fe,[l(x,{id:"activate_ai_chat",label:"Activate AI Chat",value:t.hasAiChat,onSwitch:a[8]||(a[8]=e=>t.hasAiChat=e),help:"If selected, the AI Chat will store the content of the chat messages."},null,8,["value"]),l(x,{id:"allow_ai_chat_campaigns",label:"Allow AI Chat Campaigns",value:t.allowAiChatCampaigns,onSwitch:a[9]||(a[9]=e=>t.allowAiChatCampaigns=e),disabled:!t.hasAiChat,help:`If selected, before to proceed with the chat the user will be
            request to accept the selected AI Campaigns`},null,8,["value","disabled"]),l(P,{id:"ai-chat-campaigns",class:"max-w-lg",label:"AI Chat Campaigns",options:C(i).map(e=>({label:e.title,value:e.id.toString()})),selectedOptions:t.aiChatCampaigns,disabled:!t.allowAiChatCampaigns||!t.hasAiChat,help:"Select the AI Chat campaigns that the user will be requested to accept before to proceed with the chat.",onSelectedOptions:a[10]||(a[10]=e=>t.aiChatCampaigns=e)},null,8,["options","selectedOptions","disabled"]),a[16]||(a[16]=r("a",{class:"underline text-blue-500",href:"/wp-admin/edit.php?post_type=main_ai_campaign",target:"_blank"}," Create Campaign? ",-1))]),r("section",null,[r("header",{class:D(["bg-white p-6 border rounded-t-xl border-gray-200",{"rounded-b-xl":!t.limitChat}])},[l(k,{id:"limit-chat",label:"Limit chat messages",value:t.limitChat,onChange:a[11]||(a[11]=e=>t.limitChat=e),help:"To avoid over expensive chat, or to drive the customer to an action, you can select this checkbox to limit the amount of messages of a chat"},null,8,["value"])],2),t.limitChat?(d(),$(E,{key:0,class:"border border-t-0 border-gray-200"},{default:v(()=>[l(O,{label:"Number of messages",type:"number",min:1,value:t.questionsLimit,help:"After this amount of messages will be shown the limit message.",onInput:a[12]||(a[12]=e=>t.questionsLimit=Number(e)),onEnter:a[13]||(a[13]=e=>t.questionsLimit=Number(e))},null,8,["value"]),l(_,{label:"Limit message",value:t.beforeFormMessage,help:"The message shown when the number of messages is reached.",size:"sm",onInput:a[14]||(a[14]=e=>t.beforeFormMessage=e)},null,8,["value"]),l(ce,{onContactForm:a[15]||(a[15]=e=>Y(e))})]),_:1})):I("",!0)]),r("div",null,[a[18]||(a[18]=r("p",{class:"font-light text-brand-gray-dark text-sm max-w-xl mb-4"}," After making any changes, don't forget to update the AiChatter by copying the shortcode below again or updating the AiChatter custom post type. ",-1)),r("div",be,[r("code",Ce,w(C(o)),1),r("div",ve,[l(oe,{onClick:U},{default:v(()=>a[17]||(a[17]=[j("Save and copy to clipboard")])),_:1})])])])]),_:1})]))}});let K={};K=window.ai_chatter.data;const ye=X({setup(){ee("aiChatterData",K)},render:()=>Z(we)});ye.mount("#main_ai_chatter");
